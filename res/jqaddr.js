(function(a){a.address=function(){var b=function(b){a(a.address).trigger(a.extend(a.Event(b),function(){var b={},c=a.address.parameterNames();for(var d=0,e=c.length;d<e;d++)b[c[d]]=a.address.parameter(c[d]);return{value:a.address.value(),path:a.address.path(),pathNames:a.address.pathNames(),parameterNames:c,parameters:b,queryString:a.address.queryString()}}.call(a.address)))},c=function(a){return Array.prototype.slice.call(a)},d=function(b,c,d){return a().bind.apply(a(a.address),Array.prototype.slice.call(arguments)),a.address},e=function(){return P.pushState&&I.state!==x},f=function(){return("/"+Q.pathname.replace(new RegExp(I.state),"")+Q.search+(g()?"#"+g():"")).replace(T,"/")},g=function(){var a=Q.href.indexOf("#");return a!=-1?l(Q.href.substr(a+1),H):""},h=function(){return e()?f():g()},i=function(){try{return top.document!==x?top:window}catch(a){return window}},j=function(){return"javascript"},k=function(a){return a=a.toString(),(I.strict&&a.substr(0,1)!="/"?"/":"")+a},l=function(a,b){return I.crawlable&&b?(a!==""?"!":"")+a:a.replace(/^\!/,"")},m=function(a,b){return parseInt(a.css(b),10)},n=function(){if(!ab){var a=h(),b=fb!=a;b&&(L&&K<7?Q.reload():(L&&!V&&I.history&&S(q,50),fb=a,o(H)))}},o=function(a){b(D),b(a?E:F),S(p,10)},p=function(){if(I.tracker!=="null"&&I.tracker!==null){var b=a.isFunction(I.tracker)?I.tracker:N[I.tracker],c=(Q.pathname+Q.search+(a.address&&!e()?a.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");a.isFunction(b)?b(c):a.isFunction(N.urchinTracker)?N.urchinTracker(c):N.pageTracker!==x&&a.isFunction(N.pageTracker._trackPageview)?N.pageTracker._trackPageview(c):N._gaq!==x&&a.isFunction(N._gaq.push)&&N._gaq.push(["_trackPageview",decodeURI(c)])}},q=function(){var a=j()+":"+H+";document.open();document.writeln('<html><head><title>"+O.title.replace(/\'/g,"\\'")+"</title><script>var "+z+' = "'+h()+(O.domain!=Q.hostname?'";document.domain="'+O.domain:"")+'";</'+"script></head></html>');document.close();";K<7?W.src=a:W.contentWindow.location.replace(a)},r=function(){if(Y&&Z!=-1){var a,b,c=Y.substr(Z+1).split("&");for(a=0;a<c.length;a++)b=c[a].split("="),/^(autoUpdate|crawlable|history|strict|wrap)$/.test(b[0])&&(I[b[0]]=isNaN(b[1])?/^(true|yes)$/i.test(b[1]):parseInt(b[1],10)!==0),/^(state|tracker)$/.test(b[0])&&(I[b[0]]=b[1]);Y=null}fb=h()},s=function(){if(!bb){bb=G,r();var c=function(){t.call(this),w.call(this)},d=a("body").ajaxComplete(c);c();if(I.wrap){var f=a("body > *").wrapAll('<div style="padding:'+(m(d,"marginTop")+m(d,"paddingTop"))+"px "+(m(d,"marginRight")+m(d,"paddingRight"))+"px "+(m(d,"marginBottom")+m(d,"paddingBottom"))+"px "+(m(d,"marginLeft")+m(d,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+z+'" style="height:100%;overflow:auto;position:relative;'+(M&&!window.statusbar.visible?"resize:both;":"")+'" />');a("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"}),M&&a('<style type="text/css" />').appendTo("head").text("#"+z+"::-webkit-resizer { background-color: #fff; }")}if(L&&!V){var g=O.getElementsByTagName("frameset")[0];W=O.createElement((g?"":"i")+"frame"),W.src=j()+":"+H,g?(g.insertAdjacentElement("beforeEnd",W),g[g.cols?"cols":"rows"]+=",0",W.noResize=G,W.frameBorder=W.frameSpacing=0):(W.style.display="none",W.style.width=W.style.height=0,W.tabIndex=-1,O.body.insertAdjacentElement("afterBegin",W)),S(function(){a(W).bind("load",function(){var a=W.contentWindow;fb=a[z]!==x?a[z]:"",fb!=h()&&(o(H),Q.hash=l(fb,G))}),W.contentWindow[z]===x&&q()},50)}S(function(){b("init"),o(H)},1),e()||(V?N.addEventListener?N.addEventListener(B,n,H):N.attachEvent&&N.attachEvent("on"+B,n):R(n,50)),"state"in window.history&&a(window).trigger("popstate")}},t=function(){var b,c=a("a"),d=c.size(),e=1,f=-1,g='[rel*="address:"]',h=function(){++f!=d&&(b=a(c.get(f)),b.is(g)&&b.address(g),S(h,e))};S(h,e)},u=function(){fb!=h()&&(fb=h(),o(H))},v=function(){N.removeEventListener?N.removeEventListener(B,n,H):N.detachEvent&&N.detachEvent("on"+B,n)},w=function(){if(I.crawlable){var b=Q.pathname.replace(/\/$/,""),c="_escaped_fragment_";a("body").html().indexOf(c)!=-1&&a('a[href]:not([href^=http]), a[href*="'+document.domain+'"]').each(function(){var d=a(this).attr("href").replace(/^http:/,"").replace(new RegExp(b+"/?$"),"");(d===""||d.indexOf(c)!=-1)&&a(this).attr("href","#"+encodeURI(decodeURIComponent(d.replace(new RegExp("/(.*)\\?"+c+"=(.*)$"),"!$2"))))})}},x,y=null,z="jQueryAddress",A="string",B="hashchange",C="init",D="change",E="internalChange",F="externalChange",G=!0,H=!1,I={autoUpdate:G,crawlable:H,history:G,strict:G,wrap:H},J=a.browser,K=parseFloat(J.version),L=!a.support.opacity,M=J.webkit||J.safari,N=i(),O=N.document,P=N.history,Q=N.location,R=setInterval,S=setTimeout,T=/\/{2,9}/g,U=navigator.userAgent,V="on"+B in N,W,X,Y=a("script:last").attr("src"),Z=Y?Y.indexOf("?"):-1,_=O.title,ab=H,bb=H,cb=G,db=H,eb={},fb=h();if(L){K=parseFloat(U.substr(U.indexOf("MSIE")+4)),O.documentMode&&O.documentMode!=K&&(K=O.documentMode!=8?7:8);var gb=O.onpropertychange;O.onpropertychange=function(){gb&&gb.call(O),O.title!=_&&O.title.indexOf("#"+h())!=-1&&(O.title=_)}}P.navigationMode&&(P.navigationMode="compatible");if(document.readyState=="complete")var hb=setInterval(function(){a.address&&(s(),clearInterval(hb))},50);else r(),a(s);return a(window).bind("popstate",u).bind("unload",v),{bind:function(a,b,e){return d.apply(this,c(arguments))},init:function(a,b){return d.apply(this,[C].concat(c(arguments)))},change:function(a,b){return d.apply(this,[D].concat(c(arguments)))},internalChange:function(a,b){return d.apply(this,[E].concat(c(arguments)))},externalChange:function(a,b){return d.apply(this,[F].concat(c(arguments)))},baseURL:function(){var a=Q.href;return a.indexOf("#")!=-1&&(a=a.substr(0,a.indexOf("#"))),/\/$/.test(a)&&(a=a.substr(0,a.length-1)),a},autoUpdate:function(a){return a!==x?(I.autoUpdate=a,this):I.autoUpdate},crawlable:function(a){return a!==x?(I.crawlable=a,this):I.crawlable},history:function(a){return a!==x?(I.history=a,this):I.history},state:function(a){if(a!==x){I.state=a;var b=f();return I.state!==x&&(P.pushState?b.substr(0,3)=="/#/"&&Q.replace(I.state.replace(/^\/$/,"")+b.substr(2)):b!="/"&&b.replace(/^\/#/,"")!=g()&&S(function(){Q.replace(I.state.replace(/^\/$/,"")+"/#"+b)},1)),this}return I.state},strict:function(a){return a!==x?(I.strict=a,this):I.strict},tracker:function(a){return a!==x?(I.tracker=a,this):I.tracker},wrap:function(a){return a!==x?(I.wrap=a,this):I.wrap},update:function(){return db=G,this.value(fb),db=H,this},title:function(a){return a!==x?(S(function(){_=O.title=a,cb&&W&&W.contentWindow&&W.contentWindow.document&&(W.contentWindow.document.title=a,cb=H)},50),this):O.title},value:function(a){if(a!==x){a=k(a),a=="/"&&(a="");if(fb==a&&!db)return;fb=a;if(I.autoUpdate||db)o(G),e()?P[I.history?"pushState":"replaceState"]({},"",I.state.replace(/\/$/,"")+(fb===""?"/":fb)):(ab=G,M?I.history?Q.hash="#"+l(fb,G):Q.replace("#"+l(fb,G)):fb!=h()&&(I.history?Q.hash="#"+l(fb,G):Q.replace("#"+l(fb,G))),L&&!V&&I.history&&S(q,50),M?S(function(){ab=H},1):ab=H);return this}return k(fb)},path:function(a){if(a!==x){var b=this.queryString(),c=this.hash();return this.value(a+(b?"?"+b:"")+(c?"#"+c:"")),this}return k(fb).split("#")[0].split("?")[0]},pathNames:function(){var a=this.path(),b=a.replace(T,"/").split("/");return(a.substr(0,1)=="/"||a.length===0)&&b.splice(0,1),a.substr(a.length-1,1)=="/"&&b.splice(b.length-1,1),b},queryString:function(a){if(a!==x){var b=this.hash();return this.value(this.path()+(a?"?"+a:"")+(b?"#"+b:"")),this}var c=fb.split("?");return c.slice(1,c.length).join("?").split("#")[0]},parameter:function(b,c,d){var e,f;if(c!==x){var g=this.parameterNames();f=[],c=c===x||c===null?"":c.toString();for(e=0;e<g.length;e++){var h=g[e],i=this.parameter(h);typeof i==A&&(i=[i]),h==b&&(i=c===null||c===""?[]:d?i.concat([c]):[c]);for(var j=0;j<i.length;j++)f.push(h+"="+i[j])}return a.inArray(b,g)==-1&&c!==null&&c!==""&&f.push(b+"="+c),this.queryString(f.join("&")),this}c=this.queryString();if(c){var k=[];f=c.split("&");for(e=0;e<f.length;e++){var l=f[e].split("=");l[0]==b&&k.push(l.slice(1).join("="))}if(k.length!==0)return k.length!=1?k:k[0]}},parameterNames:function(){var b=this.queryString(),c=[];if(b&&b.indexOf("=")!=-1){var d=b.split("&");for(var e=0;e<d.length;e++){var f=d[e].split("=")[0];a.inArray(f,c)==-1&&c.push(f)}}return c},hash:function(a){if(a!==x)return this.value(fb.split("#")[0]+(a?"#"+a:"")),this;var b=fb.split("#");return b.slice(1,b.length).join("#")}}}(),a.fn.address=function(b){var c;typeof b=="string"&&(c=b,b=undefined);if(!a(this).attr("address")){var d=function(c){if(c.shiftKey||c.ctrlKey||c.metaKey||c.which==2)return!0;if(a(this).is("a")){c.preventDefault();var d=b?b.call(this):/address:/.test(a(this).attr("rel"))?a(this).attr("rel").split("address:")[1].split(" ")[0]:a.address.state()!==undefined&&!/^\/?$/.test(a.address.state())?a(this).attr("href").replace(new RegExp("^(.*"+a.address.state()+"|\\.)"),""):a(this).attr("href").replace(/^(#\!?|\.)/,"");a.address.value(d)}};a(c?c:this).live("click",d).live("submit",function(c){if(a(this).is("form")){c.preventDefault();var d=a(this).attr("action"),e=b?b.call(this):(d.indexOf("?")!=-1?d.replace(/&$/,""):d+"?")+a(this).serialize();a.address.value(e)}}).attr("address",!0)}return this}})(jQuery)