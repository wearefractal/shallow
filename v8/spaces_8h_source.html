<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>V8 API Reference Guide: /home/codex/apps/v8/src/spaces.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="logo.jpg"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">V8 API Reference Guide
   
   </div>
   <div id="projectbrief">If this is out of date tweet @Contra</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('spaces_8h.html','');
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/home/codex/apps/v8/src/spaces.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="spaces_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Copyright 2011 the V8 project authors. All rights reserved.</span>
<a name="l00002"></a>00002 <span class="comment">// Redistribution and use in source and binary forms, with or without</span>
<a name="l00003"></a>00003 <span class="comment">// modification, are permitted provided that the following conditions are</span>
<a name="l00004"></a>00004 <span class="comment">// met:</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">//     * Redistributions of source code must retain the above copyright</span>
<a name="l00007"></a>00007 <span class="comment">//       notice, this list of conditions and the following disclaimer.</span>
<a name="l00008"></a>00008 <span class="comment">//     * Redistributions in binary form must reproduce the above</span>
<a name="l00009"></a>00009 <span class="comment">//       copyright notice, this list of conditions and the following</span>
<a name="l00010"></a>00010 <span class="comment">//       disclaimer in the documentation and/or other materials provided</span>
<a name="l00011"></a>00011 <span class="comment">//       with the distribution.</span>
<a name="l00012"></a>00012 <span class="comment">//     * Neither the name of Google Inc. nor the names of its</span>
<a name="l00013"></a>00013 <span class="comment">//       contributors may be used to endorse or promote products derived</span>
<a name="l00014"></a>00014 <span class="comment">//       from this software without specific prior written permission.</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00017"></a>00017 <span class="comment">// &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00018"></a>00018 <span class="comment">// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00019"></a>00019 <span class="comment">// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00020"></a>00020 <span class="comment">// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00021"></a>00021 <span class="comment">// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00022"></a>00022 <span class="comment">// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00023"></a>00023 <span class="comment">// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00024"></a>00024 <span class="comment">// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00025"></a>00025 <span class="comment">// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00026"></a>00026 <span class="comment">// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#ifndef V8_SPACES_H_</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#define V8_SPACES_H_</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="allocation_8h.html">allocation.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="hashmap_8h.html">hashmap.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="list_8h.html">list.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="log_8h.html">log.h</a>&quot;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="keyword">namespace </span>v8 {
<a name="l00037"></a>00037 <span class="keyword">namespace </span>internal {
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="keyword">class </span>Isolate;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l00042"></a>00042 <span class="comment">// Heap structures:</span>
<a name="l00043"></a>00043 <span class="comment">//</span>
<a name="l00044"></a>00044 <span class="comment">// A JS heap consists of a young generation, an old generation, and a large</span>
<a name="l00045"></a>00045 <span class="comment">// object space. The young generation is divided into two semispaces. A</span>
<a name="l00046"></a>00046 <span class="comment">// scavenger implements Cheney&#39;s copying algorithm. The old generation is</span>
<a name="l00047"></a>00047 <span class="comment">// separated into a map space and an old object space. The map space contains</span>
<a name="l00048"></a>00048 <span class="comment">// all (and only) map objects, the rest of old objects go into the old space.</span>
<a name="l00049"></a>00049 <span class="comment">// The old generation is collected by a mark-sweep-compact collector.</span>
<a name="l00050"></a>00050 <span class="comment">//</span>
<a name="l00051"></a>00051 <span class="comment">// The semispaces of the young generation are contiguous.  The old and map</span>
<a name="l00052"></a>00052 <span class="comment">// spaces consists of a list of pages. A page has a page header and an object</span>
<a name="l00053"></a>00053 <span class="comment">// area.</span>
<a name="l00054"></a>00054 <span class="comment">//</span>
<a name="l00055"></a>00055 <span class="comment">// There is a separate large object space for objects larger than</span>
<a name="l00056"></a>00056 <span class="comment">// Page::kMaxHeapObjectSize, so that they do not have to move during</span>
<a name="l00057"></a>00057 <span class="comment">// collection. The large object space is paged. Pages in large object space</span>
<a name="l00058"></a>00058 <span class="comment">// may be larger than the page size.</span>
<a name="l00059"></a>00059 <span class="comment">//</span>
<a name="l00060"></a>00060 <span class="comment">// A store-buffer based write barrier is used to keep track of intergenerational</span>
<a name="l00061"></a>00061 <span class="comment">// references.  See store-buffer.h.</span>
<a name="l00062"></a>00062 <span class="comment">//</span>
<a name="l00063"></a>00063 <span class="comment">// During scavenges and mark-sweep collections we sometimes (after a store</span>
<a name="l00064"></a>00064 <span class="comment">// buffer overflow) iterate intergenerational pointers without decoding heap</span>
<a name="l00065"></a>00065 <span class="comment">// object maps so if the page belongs to old pointer space or large object</span>
<a name="l00066"></a>00066 <span class="comment">// space it is essential to guarantee that the page does not contain any</span>
<a name="l00067"></a>00067 <span class="comment">// garbage pointers to new space: every pointer aligned word which satisfies</span>
<a name="l00068"></a>00068 <span class="comment">// the Heap::InNewSpace() predicate must be a pointer to a live heap object in</span>
<a name="l00069"></a>00069 <span class="comment">// new space. Thus objects in old pointer and large object spaces should have a</span>
<a name="l00070"></a>00070 <span class="comment">// special layout (e.g. no bare integer fields). This requirement does not</span>
<a name="l00071"></a>00071 <span class="comment">// apply to map space which is iterated in a special fashion. However we still</span>
<a name="l00072"></a>00072 <span class="comment">// require pointer fields of dead maps to be cleaned.</span>
<a name="l00073"></a>00073 <span class="comment">//</span>
<a name="l00074"></a>00074 <span class="comment">// To enable lazy cleaning of old space pages we can mark chunks of the page</span>
<a name="l00075"></a>00075 <span class="comment">// as being garbage.  Garbage sections are marked with a special map.  These</span>
<a name="l00076"></a>00076 <span class="comment">// sections are skipped when scanning the page, even if we are otherwise</span>
<a name="l00077"></a>00077 <span class="comment">// scanning without regard for object boundaries.  Garbage sections are chained</span>
<a name="l00078"></a>00078 <span class="comment">// together to form a free list after a GC.  Garbage sections created outside</span>
<a name="l00079"></a>00079 <span class="comment">// of GCs by object trunctation etc. may not be in the free list chain.  Very</span>
<a name="l00080"></a>00080 <span class="comment">// small free spaces are ignored, they need only be cleaned of bogus pointers</span>
<a name="l00081"></a>00081 <span class="comment">// into new space.</span>
<a name="l00082"></a>00082 <span class="comment">//</span>
<a name="l00083"></a>00083 <span class="comment">// Each page may have up to one special garbage section.  The start of this</span>
<a name="l00084"></a>00084 <span class="comment">// section is denoted by the top field in the space.  The end of the section</span>
<a name="l00085"></a>00085 <span class="comment">// is denoted by the limit field in the space.  This special garbage section</span>
<a name="l00086"></a>00086 <span class="comment">// is not marked with a free space map in the data.  The point of this section</span>
<a name="l00087"></a>00087 <span class="comment">// is to enable linear allocation without having to constantly update the byte</span>
<a name="l00088"></a>00088 <span class="comment">// array every time the top field is updated and a new object is created.  The</span>
<a name="l00089"></a>00089 <span class="comment">// special garbage section is not in the chain of garbage sections.</span>
<a name="l00090"></a>00090 <span class="comment">//</span>
<a name="l00091"></a>00091 <span class="comment">// Since the top and limit fields are in the space, not the page, only one page</span>
<a name="l00092"></a>00092 <span class="comment">// has a special garbage section, and if the top and limit are equal then there</span>
<a name="l00093"></a>00093 <span class="comment">// is no special garbage section.</span>
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">// Some assertion macros used in the debugging mode.</span>
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="spaces_8h.html#a297aad923d9bdd1f6d4b261a56b33d7b">00097</a> <span class="preprocessor">#define ASSERT_PAGE_ALIGNED(address)                                           \</span>
<a name="l00098"></a>00098 <span class="preprocessor">  ASSERT((OffsetFrom(address) &amp; Page::kPageAlignmentMask) == 0)</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span>
<a name="l00100"></a><a class="code" href="spaces_8h.html#a99e4e224f24c6d613c3836b3c8be1f38">00100</a> <span class="preprocessor">#define ASSERT_OBJECT_ALIGNED(address)                                         \</span>
<a name="l00101"></a>00101 <span class="preprocessor">  ASSERT((OffsetFrom(address) &amp; kObjectAlignmentMask) == 0)</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>
<a name="l00103"></a><a class="code" href="spaces_8h.html#ac372d026224d48e867b2b336e2b6d6e7">00103</a> <span class="preprocessor">#define ASSERT_MAP_ALIGNED(address)                                            \</span>
<a name="l00104"></a>00104 <span class="preprocessor">  ASSERT((OffsetFrom(address) &amp; kMapAlignmentMask) == 0)</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span>
<a name="l00106"></a><a class="code" href="spaces_8h.html#a6e47014aa97128a9248bbc85933701c0">00106</a> <span class="preprocessor">#define ASSERT_OBJECT_SIZE(size)                                               \</span>
<a name="l00107"></a>00107 <span class="preprocessor">  ASSERT((0 &lt; size) &amp;&amp; (size &lt;= Page::kMaxNonCodeHeapObjectSize))</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span>
<a name="l00109"></a><a class="code" href="spaces_8h.html#adf94377cff5bd1c9cddd6cff8f9446b2">00109</a> <span class="preprocessor">#define ASSERT_PAGE_OFFSET(offset)                                             \</span>
<a name="l00110"></a>00110 <span class="preprocessor">  ASSERT((Page::kObjectStartOffset &lt;= offset)                                  \</span>
<a name="l00111"></a>00111 <span class="preprocessor">      &amp;&amp; (offset &lt;= Page::kPageSize))</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span>
<a name="l00113"></a><a class="code" href="spaces_8h.html#a86d309f20514db3b1fff12b0cde8f8ea">00113</a> <span class="preprocessor">#define ASSERT_MAP_PAGE_INDEX(index)                                           \</span>
<a name="l00114"></a>00114 <span class="preprocessor">  ASSERT((0 &lt;= index) &amp;&amp; (index &lt;= MapSpace::kMaxMapPageIndex))</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span>
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 <span class="keyword">class </span>PagedSpace;
<a name="l00118"></a>00118 <span class="keyword">class </span>MemoryAllocator;
<a name="l00119"></a>00119 <span class="keyword">class </span>AllocationInfo;
<a name="l00120"></a>00120 <span class="keyword">class </span>Space;
<a name="l00121"></a>00121 <span class="keyword">class </span>FreeList;
<a name="l00122"></a>00122 <span class="keyword">class </span>MemoryChunk;
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="classv8_1_1internal_1_1_mark_bit.html">00124</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> {
<a name="l00125"></a>00125  <span class="keyword">public</span>:
<a name="l00126"></a><a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a05d951ad2b52f7096758d8c3cbf15ac3">00126</a>   <span class="keyword">typedef</span> uint32_t <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a05d951ad2b52f7096758d8c3cbf15ac3">CellType</a>;
<a name="l00127"></a>00127 
<a name="l00128"></a><a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a872cca849b4790af8391bd977d714bf6">00128</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a872cca849b4790af8391bd977d714bf6">MarkBit</a>(<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a05d951ad2b52f7096758d8c3cbf15ac3">CellType</a>* <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a9cac031508486151e3cb30731f8d8a67">cell</a>, <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a05d951ad2b52f7096758d8c3cbf15ac3">CellType</a> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a8accee6a39ea07c3737b77c86d5b9b19">mask</a>, <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a415df6758c14aa4e611ba0b89f2e3f31">data_only</a>)
<a name="l00129"></a>00129       : cell_(cell), mask_(mask), data_only_(data_only) { }
<a name="l00130"></a>00130 
<a name="l00131"></a><a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a9cac031508486151e3cb30731f8d8a67">00131</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a05d951ad2b52f7096758d8c3cbf15ac3">CellType</a>* <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a9cac031508486151e3cb30731f8d8a67">cell</a>() { <span class="keywordflow">return</span> cell_; }
<a name="l00132"></a><a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a8accee6a39ea07c3737b77c86d5b9b19">00132</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a05d951ad2b52f7096758d8c3cbf15ac3">CellType</a> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a8accee6a39ea07c3737b77c86d5b9b19">mask</a>() { <span class="keywordflow">return</span> mask_; }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>  <span class="keywordtype">bool</span> operator==(<span class="keyword">const</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a>&amp; other) {
<a name="l00136"></a>00136     <span class="keywordflow">return</span> cell_ == other.cell_ &amp;&amp; mask_ == other.mask_;
<a name="l00137"></a>00137   }
<a name="l00138"></a>00138 <span class="preprocessor">#endif</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>
<a name="l00140"></a><a class="code" href="classv8_1_1internal_1_1_mark_bit.html#adda04986b25426477243ca94a756600c">00140</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#adda04986b25426477243ca94a756600c">Set</a>() { *cell_ |= mask_; }
<a name="l00141"></a><a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a23f900f77547dd64ec77ef413607a0e5">00141</a>   <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a23f900f77547dd64ec77ef413607a0e5">Get</a>() { <span class="keywordflow">return</span> (*cell_ &amp; mask_) != 0; }
<a name="l00142"></a><a class="code" href="classv8_1_1internal_1_1_mark_bit.html#ae957b539a0baa239a7dba09508735227">00142</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#ae957b539a0baa239a7dba09508735227">Clear</a>() { *cell_ &amp;= ~mask_; }
<a name="l00143"></a>00143 
<a name="l00144"></a><a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a415df6758c14aa4e611ba0b89f2e3f31">00144</a>   <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a415df6758c14aa4e611ba0b89f2e3f31">data_only</a>() { <span class="keywordflow">return</span> data_only_; }
<a name="l00145"></a>00145 
<a name="l00146"></a><a class="code" href="classv8_1_1internal_1_1_mark_bit.html#abbf1fd5c72d8abc1e4063e1adca84965">00146</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#abbf1fd5c72d8abc1e4063e1adca84965">Next</a>() {
<a name="l00147"></a>00147     <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a05d951ad2b52f7096758d8c3cbf15ac3">CellType</a> new_mask = mask_ &lt;&lt; 1;
<a name="l00148"></a>00148     <span class="keywordflow">if</span> (new_mask == 0) {
<a name="l00149"></a>00149       <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a872cca849b4790af8391bd977d714bf6">MarkBit</a>(cell_ + 1, 1, data_only_);
<a name="l00150"></a>00150     } <span class="keywordflow">else</span> {
<a name="l00151"></a>00151       <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a872cca849b4790af8391bd977d714bf6">MarkBit</a>(cell_, new_mask, data_only_);
<a name="l00152"></a>00152     }
<a name="l00153"></a>00153   }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155  <span class="keyword">private</span>:
<a name="l00156"></a>00156   <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a05d951ad2b52f7096758d8c3cbf15ac3">CellType</a>* cell_;
<a name="l00157"></a>00157   <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a05d951ad2b52f7096758d8c3cbf15ac3">CellType</a> mask_;
<a name="l00158"></a>00158   <span class="comment">// This boolean indicates that the object is in a data-only space with no</span>
<a name="l00159"></a>00159   <span class="comment">// pointers.  This enables some optimizations when marking.</span>
<a name="l00160"></a>00160   <span class="comment">// It is expected that this field is inlined and turned into control flow</span>
<a name="l00161"></a>00161   <span class="comment">// at the place where the MarkBit object is created.</span>
<a name="l00162"></a>00162   <span class="keywordtype">bool</span> data_only_;
<a name="l00163"></a>00163 };
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="comment">// Bitmap is a sequence of cells each containing fixed number of bits.</span>
<a name="l00167"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html">00167</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_bitmap.html">Bitmap</a> {
<a name="l00168"></a>00168  <span class="keyword">public</span>:
<a name="l00169"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#ae863e06b48d36390b61adb7a17cf3b8a">00169</a>   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ae863e06b48d36390b61adb7a17cf3b8a">kBitsPerCell</a> = 32;
<a name="l00170"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#ac36de25dc5fe77ac7d032806046f8b7a">00170</a>   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ac36de25dc5fe77ac7d032806046f8b7a">kBitsPerCellLog2</a> = 5;
<a name="l00171"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#ab1aa75c88deb4ec9719b36f43b72ddff">00171</a>   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ab1aa75c88deb4ec9719b36f43b72ddff">kBitIndexMask</a> = <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ae863e06b48d36390b61adb7a17cf3b8a">kBitsPerCell</a> - 1;
<a name="l00172"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#a080e9299f086ebfb682fbc658845faf9">00172</a>   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t <a class="code" href="classv8_1_1internal_1_1_bitmap.html#a080e9299f086ebfb682fbc658845faf9">kBytesPerCell</a> = <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ae863e06b48d36390b61adb7a17cf3b8a">kBitsPerCell</a> / <a class="code" href="namespacev8_1_1internal.html#ab900ca9160d18f01efd941a662044669">kBitsPerByte</a>;
<a name="l00173"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#a3c76e7d38fe4a2c25b7f973ebdd9ae64">00173</a>   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t <a class="code" href="classv8_1_1internal_1_1_bitmap.html#a3c76e7d38fe4a2c25b7f973ebdd9ae64">kBytesPerCellLog2</a> = <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ac36de25dc5fe77ac7d032806046f8b7a">kBitsPerCellLog2</a> - <a class="code" href="namespacev8_1_1internal.html#a86aa8c7a0106fb69bd40ac6a36eff548">kBitsPerByteLog2</a>;
<a name="l00174"></a>00174 
<a name="l00175"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#a7767d3d50dcd1efdc3c5427dcb62168e">00175</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code" href="classv8_1_1internal_1_1_bitmap.html#a7767d3d50dcd1efdc3c5427dcb62168e">kLength</a> =
<a name="l00176"></a>00176     (1 &lt;&lt; <a class="code" href="namespacev8_1_1internal.html#ae235e28650afe77e4b99a9b02e705a2f">kPageSizeBits</a>) &gt;&gt; (<a class="code" href="namespacev8_1_1internal.html#a601740e70a85facf0b9567aa303a7e5f">kPointerSizeLog2</a>);
<a name="l00177"></a>00177 
<a name="l00178"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#aace66f0559638e54076e0d27b8d9ecc3">00178</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code" href="classv8_1_1internal_1_1_bitmap.html#aace66f0559638e54076e0d27b8d9ecc3">kSize</a> =
<a name="l00179"></a>00179     (1 &lt;&lt; <a class="code" href="namespacev8_1_1internal.html#ae235e28650afe77e4b99a9b02e705a2f">kPageSizeBits</a>) &gt;&gt; (<a class="code" href="namespacev8_1_1internal.html#a601740e70a85facf0b9567aa303a7e5f">kPointerSizeLog2</a> + <a class="code" href="namespacev8_1_1internal.html#a86aa8c7a0106fb69bd40ac6a36eff548">kBitsPerByteLog2</a>);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 
<a name="l00182"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#ad66f6785ba1628091c2b57b00b039d28">00182</a>   <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ad66f6785ba1628091c2b57b00b039d28">CellsForLength</a>(<span class="keywordtype">int</span> length) {
<a name="l00183"></a>00183     <span class="keywordflow">return</span> (length + <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ae863e06b48d36390b61adb7a17cf3b8a">kBitsPerCell</a> - 1) &gt;&gt; <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ac36de25dc5fe77ac7d032806046f8b7a">kBitsPerCellLog2</a>;
<a name="l00184"></a>00184   }
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#af6f993e843f40bdb1cc71e3243ee0fc4">00186</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_bitmap.html#af6f993e843f40bdb1cc71e3243ee0fc4">CellsCount</a>() {
<a name="l00187"></a>00187     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ad66f6785ba1628091c2b57b00b039d28">CellsForLength</a>(<a class="code" href="classv8_1_1internal_1_1_bitmap.html#a7767d3d50dcd1efdc3c5427dcb62168e">kLength</a>);
<a name="l00188"></a>00188   }
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#acb5b3a62207cb6a9d98bd932d539b171">00190</a>   <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_bitmap.html#acb5b3a62207cb6a9d98bd932d539b171">SizeFor</a>(<span class="keywordtype">int</span> cells_count) {
<a name="l00191"></a>00191     <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a05d951ad2b52f7096758d8c3cbf15ac3">MarkBit::CellType</a>) * cells_count;
<a name="l00192"></a>00192   }
<a name="l00193"></a>00193 
<a name="l00194"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#a295790dbd4bcdff9c673eaa170af9dcc">00194</a>   <a class="code" href="classv8_1_1internal_1_1_bitmap.html#a295790dbd4bcdff9c673eaa170af9dcc">INLINE</a>(<span class="keyword">static</span> uint32_t IndexToCell(uint32_t index)) {
<a name="l00195"></a>00195     <span class="keywordflow">return</span> index &gt;&gt; <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ac36de25dc5fe77ac7d032806046f8b7a">kBitsPerCellLog2</a>;
<a name="l00196"></a>00196   }
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#accb0ca9debbb8ff3d1b44805a9c51ea3">00198</a>   <a class="code" href="classv8_1_1internal_1_1_bitmap.html#accb0ca9debbb8ff3d1b44805a9c51ea3">INLINE</a>(<span class="keyword">static</span> uint32_t CellToIndex(uint32_t index)) {
<a name="l00199"></a>00199     <span class="keywordflow">return</span> index &lt;&lt; <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ac36de25dc5fe77ac7d032806046f8b7a">kBitsPerCellLog2</a>;
<a name="l00200"></a>00200   }
<a name="l00201"></a>00201 
<a name="l00202"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#a8c1030c7b12f029caf6abf1de575597d">00202</a>   <a class="code" href="classv8_1_1internal_1_1_bitmap.html#a8c1030c7b12f029caf6abf1de575597d">INLINE</a>(<span class="keyword">static</span> uint32_t CellAlignIndex(uint32_t index)) {
<a name="l00203"></a>00203     <span class="keywordflow">return</span> (index + <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ab1aa75c88deb4ec9719b36f43b72ddff">kBitIndexMask</a>) &amp; ~<a class="code" href="classv8_1_1internal_1_1_bitmap.html#ab1aa75c88deb4ec9719b36f43b72ddff">kBitIndexMask</a>;
<a name="l00204"></a>00204   }
<a name="l00205"></a>00205 
<a name="l00206"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#aefc479b56a25e4f0ce76a952ae691647">00206</a>   <a class="code" href="classv8_1_1internal_1_1_bitmap.html#aefc479b56a25e4f0ce76a952ae691647">INLINE</a>(<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a05d951ad2b52f7096758d8c3cbf15ac3">MarkBit::CellType</a>* cells()) {
<a name="l00207"></a>00207     <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a05d951ad2b52f7096758d8c3cbf15ac3">MarkBit::CellType</a>*<span class="keyword">&gt;</span>(<span class="keyword">this</span>);
<a name="l00208"></a>00208   }
<a name="l00209"></a>00209 
<a name="l00210"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#a0f849d35afc1121773e26526422b4c44">00210</a>   <a class="code" href="classv8_1_1internal_1_1_bitmap.html#a0f849d35afc1121773e26526422b4c44">INLINE</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> address()) {
<a name="l00211"></a>00211     <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a><span class="keyword">&gt;</span>(<span class="keyword">this</span>);
<a name="l00212"></a>00212   }
<a name="l00213"></a>00213 
<a name="l00214"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#a1f558dd2d322cf9760b16a93b2c9a631">00214</a>   <a class="code" href="classv8_1_1internal_1_1_bitmap.html#a1f558dd2d322cf9760b16a93b2c9a631">INLINE</a>(<span class="keyword">static</span> <a class="code" href="classv8_1_1internal_1_1_bitmap.html">Bitmap</a>* FromAddress(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr)) {
<a name="l00215"></a>00215     <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classv8_1_1internal_1_1_bitmap.html">Bitmap</a>*<span class="keyword">&gt;</span>(addr);
<a name="l00216"></a>00216   }
<a name="l00217"></a>00217 
<a name="l00218"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#a3311afdd785fab7301d1f5bfe6ffbe6a">00218</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> <a class="code" href="classv8_1_1internal_1_1_bitmap.html#a3311afdd785fab7301d1f5bfe6ffbe6a">MarkBitFromIndex</a>(uint32_t index, <span class="keywordtype">bool</span> data_only = <span class="keyword">false</span>) {
<a name="l00219"></a>00219     <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a05d951ad2b52f7096758d8c3cbf15ac3">MarkBit::CellType</a> mask = 1 &lt;&lt; (index &amp; <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ab1aa75c88deb4ec9719b36f43b72ddff">kBitIndexMask</a>);
<a name="l00220"></a>00220     <a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a05d951ad2b52f7096758d8c3cbf15ac3">MarkBit::CellType</a>* cell = this-&gt;cells() + (index &gt;&gt; <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ac36de25dc5fe77ac7d032806046f8b7a">kBitsPerCellLog2</a>);
<a name="l00221"></a>00221     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a>(cell, mask, data_only);
<a name="l00222"></a>00222   }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ad36b4f298f747f2519508bbb6bde884c">Clear</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* chunk);
<a name="l00225"></a>00225 
<a name="l00226"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#a17e5795fbb9cd31a552594c987863390">00226</a>   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_bitmap.html#a17e5795fbb9cd31a552594c987863390">PrintWord</a>(uint32_t word, uint32_t himask = 0) {
<a name="l00227"></a>00227     <span class="keywordflow">for</span> (uint32_t mask = 1; mask != 0; mask &lt;&lt;= 1) {
<a name="l00228"></a>00228       <span class="keywordflow">if</span> ((mask &amp; himask) != 0) <a class="code" href="namespacev8_1_1internal.html#a983357dee691fc08ce75ee9b0c132ca7">PrintF</a>(<span class="stringliteral">&quot;[&quot;</span>);
<a name="l00229"></a>00229       <a class="code" href="namespacev8_1_1internal.html#a983357dee691fc08ce75ee9b0c132ca7">PrintF</a>((mask &amp; word) ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00230"></a>00230       <span class="keywordflow">if</span> ((mask &amp; himask) != 0) <a class="code" href="namespacev8_1_1internal.html#a983357dee691fc08ce75ee9b0c132ca7">PrintF</a>(<span class="stringliteral">&quot;]&quot;</span>);
<a name="l00231"></a>00231     }
<a name="l00232"></a>00232   }
<a name="l00233"></a>00233 
<a name="l00234"></a><a class="code" href="classv8_1_1internal_1_1_bitmap_1_1_cell_printer.html">00234</a>   <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_bitmap_1_1_cell_printer.html">CellPrinter</a> {
<a name="l00235"></a>00235    <span class="keyword">public</span>:
<a name="l00236"></a><a class="code" href="classv8_1_1internal_1_1_bitmap_1_1_cell_printer.html#a1567efff7efbb00eb126f2f5689fb29a">00236</a>     <a class="code" href="classv8_1_1internal_1_1_bitmap_1_1_cell_printer.html#a1567efff7efbb00eb126f2f5689fb29a">CellPrinter</a>() : seq_start(0), seq_type(0), seq_length(0) { }
<a name="l00237"></a>00237 
<a name="l00238"></a><a class="code" href="classv8_1_1internal_1_1_bitmap_1_1_cell_printer.html#aa62cfa9df2609d8bd5c8959c267fa91b">00238</a>     <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_bitmap_1_1_cell_printer.html#aa62cfa9df2609d8bd5c8959c267fa91b">Print</a>(uint32_t pos, uint32_t cell) {
<a name="l00239"></a>00239       <span class="keywordflow">if</span> (cell == seq_type) {
<a name="l00240"></a>00240         seq_length++;
<a name="l00241"></a>00241         <span class="keywordflow">return</span>;
<a name="l00242"></a>00242       }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244       <a class="code" href="classv8_1_1internal_1_1_bitmap_1_1_cell_printer.html#a4a7caff1c02b90a3219d0f92a0ca2cb0">Flush</a>();
<a name="l00245"></a>00245 
<a name="l00246"></a>00246       <span class="keywordflow">if</span> (<a class="code" href="classv8_1_1internal_1_1_bitmap_1_1_cell_printer.html#abeada4db062f6d55f6e6dfa54f53f6a8">IsSeq</a>(cell)) {
<a name="l00247"></a>00247         seq_start = pos;
<a name="l00248"></a>00248         seq_length = 0;
<a name="l00249"></a>00249         seq_type = cell;
<a name="l00250"></a>00250         <span class="keywordflow">return</span>;
<a name="l00251"></a>00251       }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253       <a class="code" href="namespacev8_1_1internal.html#a983357dee691fc08ce75ee9b0c132ca7">PrintF</a>(<span class="stringliteral">&quot;%d: &quot;</span>, pos);
<a name="l00254"></a>00254       <a class="code" href="classv8_1_1internal_1_1_bitmap.html#a17e5795fbb9cd31a552594c987863390">PrintWord</a>(cell);
<a name="l00255"></a>00255       <a class="code" href="namespacev8_1_1internal.html#a983357dee691fc08ce75ee9b0c132ca7">PrintF</a>(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00256"></a>00256     }
<a name="l00257"></a>00257 
<a name="l00258"></a><a class="code" href="classv8_1_1internal_1_1_bitmap_1_1_cell_printer.html#a4a7caff1c02b90a3219d0f92a0ca2cb0">00258</a>     <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_bitmap_1_1_cell_printer.html#a4a7caff1c02b90a3219d0f92a0ca2cb0">Flush</a>() {
<a name="l00259"></a>00259       <span class="keywordflow">if</span> (seq_length &gt; 0) {
<a name="l00260"></a>00260         <a class="code" href="namespacev8_1_1internal.html#a983357dee691fc08ce75ee9b0c132ca7">PrintF</a>(<span class="stringliteral">&quot;%d: %dx%d\n&quot;</span>,
<a name="l00261"></a>00261                seq_start,
<a name="l00262"></a>00262                seq_type == 0 ? 0 : 1,
<a name="l00263"></a>00263                seq_length * <a class="code" href="classv8_1_1internal_1_1_bitmap.html#ae863e06b48d36390b61adb7a17cf3b8a">kBitsPerCell</a>);
<a name="l00264"></a>00264         seq_length = 0;
<a name="l00265"></a>00265       }
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267 
<a name="l00268"></a><a class="code" href="classv8_1_1internal_1_1_bitmap_1_1_cell_printer.html#abeada4db062f6d55f6e6dfa54f53f6a8">00268</a>     <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_bitmap_1_1_cell_printer.html#abeada4db062f6d55f6e6dfa54f53f6a8">IsSeq</a>(uint32_t cell) { <span class="keywordflow">return</span> cell == 0 || cell == 0xFFFFFFFF; }
<a name="l00269"></a>00269 
<a name="l00270"></a>00270    <span class="keyword">private</span>:
<a name="l00271"></a>00271     uint32_t seq_start;
<a name="l00272"></a>00272     uint32_t seq_type;
<a name="l00273"></a>00273     uint32_t seq_length;
<a name="l00274"></a>00274   };
<a name="l00275"></a>00275 
<a name="l00276"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#a62cecf8d8ab89f87fc4db5555b10b6b0">00276</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_bitmap.html#a62cecf8d8ab89f87fc4db5555b10b6b0">Print</a>() {
<a name="l00277"></a>00277     <a class="code" href="classv8_1_1internal_1_1_bitmap_1_1_cell_printer.html">CellPrinter</a> printer;
<a name="l00278"></a>00278     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classv8_1_1internal_1_1_bitmap.html#af6f993e843f40bdb1cc71e3243ee0fc4">CellsCount</a>(); i++) {
<a name="l00279"></a>00279       printer.<a class="code" href="classv8_1_1internal_1_1_bitmap_1_1_cell_printer.html#aa62cfa9df2609d8bd5c8959c267fa91b">Print</a>(i, cells()[i]);
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281     printer.<a class="code" href="classv8_1_1internal_1_1_bitmap_1_1_cell_printer.html#a4a7caff1c02b90a3219d0f92a0ca2cb0">Flush</a>();
<a name="l00282"></a>00282     <a class="code" href="namespacev8_1_1internal.html#a983357dee691fc08ce75ee9b0c132ca7">PrintF</a>(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00283"></a>00283   }
<a name="l00284"></a>00284 
<a name="l00285"></a><a class="code" href="classv8_1_1internal_1_1_bitmap.html#adcc903a3d3788b077a87977dc06122ff">00285</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_bitmap.html#adcc903a3d3788b077a87977dc06122ff">IsClean</a>() {
<a name="l00286"></a>00286     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classv8_1_1internal_1_1_bitmap.html#af6f993e843f40bdb1cc71e3243ee0fc4">CellsCount</a>(); i++) {
<a name="l00287"></a>00287       <span class="keywordflow">if</span> (cells()[i] != 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00288"></a>00288     }
<a name="l00289"></a>00289     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00290"></a>00290   }
<a name="l00291"></a>00291 };
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 
<a name="l00294"></a>00294 <span class="keyword">class </span>SkipList;
<a name="l00295"></a>00295 <span class="keyword">class </span>SlotsBuffer;
<a name="l00296"></a>00296 
<a name="l00297"></a>00297 <span class="comment">// MemoryChunk represents a memory region owned by a specific space.</span>
<a name="l00298"></a>00298 <span class="comment">// It is divided into the header and the body. Chunk start is always</span>
<a name="l00299"></a>00299 <span class="comment">// 1MB aligned. Start of the body is aligned so it can accommodate</span>
<a name="l00300"></a>00300 <span class="comment">// any heap object.</span>
<a name="l00301"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">00301</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a> {
<a name="l00302"></a>00302  <span class="keyword">public</span>:
<a name="l00303"></a>00303   <span class="comment">// Only works if the pointer is in the first kPageSize of the MemoryChunk.</span>
<a name="l00304"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa085e1ca88c6b66f52e3f12dc4c89195">00304</a>   <span class="keyword">static</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa085e1ca88c6b66f52e3f12dc4c89195">FromAddress</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> a) {
<a name="l00305"></a>00305     <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>*<span class="keyword">&gt;</span>(<a class="code" href="namespacev8_1_1internal.html#aefd9bd49976aa2276ada1b562f1c6cbb">OffsetFrom</a>(a) &amp; ~<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aacbc80f7e6ca4f243c9b31dc2d5fd6e8">kAlignmentMask</a>);
<a name="l00306"></a>00306   }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308   <span class="comment">// Only works for addresses in pointer spaces, not data or code spaces.</span>
<a name="l00309"></a>00309   <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a09ed36ce9e262e9d51b081b149cf0460">FromAnyPointerAddress</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr);
<a name="l00310"></a>00310 
<a name="l00311"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae2a42f2abeb57a8206eee9ff85a07ec6">00311</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae2a42f2abeb57a8206eee9ff85a07ec6">address</a>() { <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a><span class="keyword">&gt;</span>(<span class="keyword">this</span>); }
<a name="l00312"></a>00312 
<a name="l00313"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a72d7cd1ec809de2aefaa75087250c76e">00313</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a72d7cd1ec809de2aefaa75087250c76e">is_valid</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae2a42f2abeb57a8206eee9ff85a07ec6">address</a>() != <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>; }
<a name="l00314"></a>00314 
<a name="l00315"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a487f8c05109d4b1d31c788f7327c0ca8">00315</a>   <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a487f8c05109d4b1d31c788f7327c0ca8">next_chunk</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0e085f89e88f22f0b62d3b63a19a7e2d">next_chunk_</a>; }
<a name="l00316"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae356e1e0334211a3d760ab67535a0a82">00316</a>   <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae356e1e0334211a3d760ab67535a0a82">prev_chunk</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad45b962ed5ed46492a4e90afa2e7cd7d">prev_chunk_</a>; }
<a name="l00317"></a>00317 
<a name="l00318"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a33680f5d5cd36e8094c38e0ff43ffe82">00318</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a33680f5d5cd36e8094c38e0ff43ffe82">set_next_chunk</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* next) { <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0e085f89e88f22f0b62d3b63a19a7e2d">next_chunk_</a> = next; }
<a name="l00319"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a76397898a99e742c97e27cfe0d254407">00319</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a76397898a99e742c97e27cfe0d254407">set_prev_chunk</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* prev) { <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad45b962ed5ed46492a4e90afa2e7cd7d">prev_chunk_</a> = prev; }
<a name="l00320"></a>00320 
<a name="l00321"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3e6f1fb7b24f1662eed90feefb5152ad">00321</a>   <a class="code" href="classv8_1_1internal_1_1_space.html">Space</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3e6f1fb7b24f1662eed90feefb5152ad">owner</a>()<span class="keyword"> const </span>{
<a name="l00322"></a>00322     <span class="keywordflow">if</span> ((reinterpret_cast&lt;intptr_t&gt;(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aca081334cd06102fecc638fdd2f92bff">owner_</a>) &amp; <a class="code" href="namespacev8_1_1internal.html#a1e1abd4b38553bb5bd3733b907ab184a">kFailureTagMask</a>) ==
<a name="l00323"></a>00323         <a class="code" href="namespacev8_1_1internal.html#aacc4c01e6f026fa5af8ca8975acc6113">kFailureTag</a>) {
<a name="l00324"></a>00324       <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classv8_1_1internal_1_1_space.html">Space</a>*<span class="keyword">&gt;</span>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aca081334cd06102fecc638fdd2f92bff">owner_</a> - <a class="code" href="namespacev8_1_1internal.html#aacc4c01e6f026fa5af8ca8975acc6113">kFailureTag</a>);
<a name="l00325"></a>00325     } <span class="keywordflow">else</span> {
<a name="l00326"></a>00326       <span class="keywordflow">return</span> <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>;
<a name="l00327"></a>00327     }
<a name="l00328"></a>00328   }
<a name="l00329"></a>00329 
<a name="l00330"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0a951759d40cf006e441bf25aa5f6463">00330</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0a951759d40cf006e441bf25aa5f6463">set_owner</a>(<a class="code" href="classv8_1_1internal_1_1_space.html">Space</a>* space) {
<a name="l00331"></a>00331     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>((reinterpret_cast&lt;intptr_t&gt;(space) &amp; <a class="code" href="namespacev8_1_1internal.html#a1e1abd4b38553bb5bd3733b907ab184a">kFailureTagMask</a>) == 0);
<a name="l00332"></a>00332     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aca081334cd06102fecc638fdd2f92bff">owner_</a> = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a><span class="keyword">&gt;</span>(space) + <a class="code" href="namespacev8_1_1internal.html#aacc4c01e6f026fa5af8ca8975acc6113">kFailureTag</a>;
<a name="l00333"></a>00333     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>((reinterpret_cast&lt;intptr_t&gt;(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aca081334cd06102fecc638fdd2f92bff">owner_</a>) &amp; kFailureTagMask) ==
<a name="l00334"></a>00334            <a class="code" href="namespacev8_1_1internal.html#aacc4c01e6f026fa5af8ca8975acc6113">kFailureTag</a>);
<a name="l00335"></a>00335   }
<a name="l00336"></a>00336 
<a name="l00337"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7b17b7fe9cb3486dbf4fc49dadb5992a">00337</a>   <a class="code" href="classv8_1_1internal_1_1_virtual_memory.html">VirtualMemory</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7b17b7fe9cb3486dbf4fc49dadb5992a">reserved_memory</a>() {
<a name="l00338"></a>00338     <span class="keywordflow">return</span> &amp;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a404397b274b9d25be3555c1e2f61a3f0">reservation_</a>;
<a name="l00339"></a>00339   }
<a name="l00340"></a>00340 
<a name="l00341"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a67d9059f8db73364276d6ab010470ba6">00341</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a67d9059f8db73364276d6ab010470ba6">InitializeReservedMemory</a>() {
<a name="l00342"></a>00342     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a404397b274b9d25be3555c1e2f61a3f0">reservation_</a>.<a class="code" href="classv8_1_1internal_1_1_virtual_memory.html#aacdcb5f689db1e7346aa047b27637c00">Reset</a>();
<a name="l00343"></a>00343   }
<a name="l00344"></a>00344 
<a name="l00345"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac92db97e7d92b9c6973d867eb0f96602">00345</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac92db97e7d92b9c6973d867eb0f96602">set_reserved_memory</a>(<a class="code" href="classv8_1_1internal_1_1_virtual_memory.html">VirtualMemory</a>* reservation) {
<a name="l00346"></a>00346     <a class="code" href="checks_8h.html#aa49e13f06cb6965b35c085c0497e2bf7">ASSERT_NOT_NULL</a>(reservation);
<a name="l00347"></a>00347     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a404397b274b9d25be3555c1e2f61a3f0">reservation_</a>.<a class="code" href="classv8_1_1internal_1_1_virtual_memory.html#ad1b618904a13169cb168de8a31b5ce70">TakeControl</a>(reservation);
<a name="l00348"></a>00348   }
<a name="l00349"></a>00349 
<a name="l00350"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a35800483957953094f449c7508553545">00350</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a35800483957953094f449c7508553545">scan_on_scavenge</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a01e5775f7047a3ff75f0c24afabb6e96">IsFlagSet</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78ae6c7b8ad5f683947a839841f6daa569b">SCAN_ON_SCAVENGE</a>); }
<a name="l00351"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a055ab116de5876c0b2e8418a2ed299aa">00351</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a055ab116de5876c0b2e8418a2ed299aa">initialize_scan_on_scavenge</a>(<span class="keywordtype">bool</span> scan) {
<a name="l00352"></a>00352     <span class="keywordflow">if</span> (scan) {
<a name="l00353"></a>00353       <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a79b86e423956219c0a048b3dbcff6abb">SetFlag</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78ae6c7b8ad5f683947a839841f6daa569b">SCAN_ON_SCAVENGE</a>);
<a name="l00354"></a>00354     } <span class="keywordflow">else</span> {
<a name="l00355"></a>00355       <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#adb4258f348c4ca8d6fd5e0dc962046b3">ClearFlag</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78ae6c7b8ad5f683947a839841f6daa569b">SCAN_ON_SCAVENGE</a>);
<a name="l00356"></a>00356     }
<a name="l00357"></a>00357   }
<a name="l00358"></a>00358   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a4e934d91b3ead93680bb0535766ea7ed">set_scan_on_scavenge</a>(<span class="keywordtype">bool</span> scan);
<a name="l00359"></a>00359 
<a name="l00360"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3a753ba29a787cfb94aa526c33e33831">00360</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3a753ba29a787cfb94aa526c33e33831">store_buffer_counter</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#afb8aa3f7dfbdf1024ab30c8eacb8c7d8">store_buffer_counter_</a>; }
<a name="l00361"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a67c1654c7e9297d8f34a648675d7d187">00361</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a67c1654c7e9297d8f34a648675d7d187">set_store_buffer_counter</a>(<span class="keywordtype">int</span> counter) {
<a name="l00362"></a>00362     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#afb8aa3f7dfbdf1024ab30c8eacb8c7d8">store_buffer_counter_</a> = counter;
<a name="l00363"></a>00363   }
<a name="l00364"></a>00364 
<a name="l00365"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a1c39761f226a79df38a27e8c6e80d17d">00365</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a1c39761f226a79df38a27e8c6e80d17d">Contains</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr) {
<a name="l00366"></a>00366     <span class="keywordflow">return</span> addr &gt;= <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a8992f4ee6a39c4c82eb82e0b3e33e9fa">area_start</a>() &amp;&amp; addr &lt; <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad3898b428d291ef457bc87c2999ff18d">area_end</a>();
<a name="l00367"></a>00367   }
<a name="l00368"></a>00368 
<a name="l00369"></a>00369   <span class="comment">// Checks whether addr can be a limit of addresses in this page.</span>
<a name="l00370"></a>00370   <span class="comment">// It&#39;s a limit if it&#39;s in the page, or if it&#39;s just after the</span>
<a name="l00371"></a>00371   <span class="comment">// last byte of the page.</span>
<a name="l00372"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3c63106e1a91ed8f9ae53fdda7a475f0">00372</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3c63106e1a91ed8f9ae53fdda7a475f0">ContainsLimit</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr) {
<a name="l00373"></a>00373     <span class="keywordflow">return</span> addr &gt;= <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a8992f4ee6a39c4c82eb82e0b3e33e9fa">area_start</a>() &amp;&amp; addr &lt;= <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad3898b428d291ef457bc87c2999ff18d">area_end</a>();
<a name="l00374"></a>00374   }
<a name="l00375"></a>00375 
<a name="l00376"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78">00376</a>   <span class="keyword">enum</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78">MemoryChunkFlags</a> {
<a name="l00377"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78adf40869b808cdb4df42933e6402fcf93">00377</a>     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78adf40869b808cdb4df42933e6402fcf93">IS_EXECUTABLE</a>,
<a name="l00378"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a134cb59f36d15cc552b2e5fb6065d69d">00378</a>     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a134cb59f36d15cc552b2e5fb6065d69d">ABOUT_TO_BE_FREED</a>,
<a name="l00379"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78af2b142e3c0d80b4f4b2cb082a3b06988">00379</a>     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78af2b142e3c0d80b4f4b2cb082a3b06988">POINTERS_TO_HERE_ARE_INTERESTING</a>,
<a name="l00380"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a17af3b9a7543d3eb8051801107209d64">00380</a>     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a17af3b9a7543d3eb8051801107209d64">POINTERS_FROM_HERE_ARE_INTERESTING</a>,
<a name="l00381"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78ae6c7b8ad5f683947a839841f6daa569b">00381</a>     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78ae6c7b8ad5f683947a839841f6daa569b">SCAN_ON_SCAVENGE</a>,
<a name="l00382"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aa408ee11091f95fd8f99029fa9518b3c">00382</a>     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aa408ee11091f95fd8f99029fa9518b3c">IN_FROM_SPACE</a>,  <span class="comment">// Mutually exclusive with IN_TO_SPACE.</span>
<a name="l00383"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aee1c28de56468284306cbcc64c6f62c6">00383</a>     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aee1c28de56468284306cbcc64c6f62c6">IN_TO_SPACE</a>,    <span class="comment">// All pages in new space has one of these two set.</span>
<a name="l00384"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a52355ebc3f9187c7c354eab4cf842072">00384</a>     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a52355ebc3f9187c7c354eab4cf842072">NEW_SPACE_BELOW_AGE_MARK</a>,
<a name="l00385"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78ad3f4841afb5344315f99126788645abd">00385</a>     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78ad3f4841afb5344315f99126788645abd">CONTAINS_ONLY_DATA</a>,
<a name="l00386"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aca1f36af6a87bdc5837fec5646a83880">00386</a>     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aca1f36af6a87bdc5837fec5646a83880">EVACUATION_CANDIDATE</a>,
<a name="l00387"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a03d3c648f27f66bfc8c521871d04a443">00387</a>     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a03d3c648f27f66bfc8c521871d04a443">RESCAN_ON_EVACUATION</a>,
<a name="l00388"></a>00388 
<a name="l00389"></a>00389     <span class="comment">// Pages swept precisely can be iterated, hitting only the live objects.</span>
<a name="l00390"></a>00390     <span class="comment">// Whereas those swept conservatively cannot be iterated over. Both flags</span>
<a name="l00391"></a>00391     <span class="comment">// indicate that marking bits have been cleared by the sweeper, otherwise</span>
<a name="l00392"></a>00392     <span class="comment">// marking bits are still intact.</span>
<a name="l00393"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a1e741332f4c96d72fc51fc95e1f00a2a">00393</a>     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a1e741332f4c96d72fc51fc95e1f00a2a">WAS_SWEPT_PRECISELY</a>,
<a name="l00394"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aefde1ea3690020ae2b738a9a3b87a94d">00394</a>     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aefde1ea3690020ae2b738a9a3b87a94d">WAS_SWEPT_CONSERVATIVELY</a>,
<a name="l00395"></a>00395 
<a name="l00396"></a>00396     <span class="comment">// Last flag, keep at bottom.</span>
<a name="l00397"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78ade6396cf8a52e139b2201a2b69ffbb06">00397</a>     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78ade6396cf8a52e139b2201a2b69ffbb06">NUM_MEMORY_CHUNK_FLAGS</a>
<a name="l00398"></a>00398   };
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 
<a name="l00401"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ab722b79056ded5db4f9444e40ce4e38d">00401</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ab722b79056ded5db4f9444e40ce4e38d">kPointersToHereAreInterestingMask</a> =
<a name="l00402"></a>00402       1 &lt;&lt; <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78af2b142e3c0d80b4f4b2cb082a3b06988">POINTERS_TO_HERE_ARE_INTERESTING</a>;
<a name="l00403"></a>00403 
<a name="l00404"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a095d7d0bdc2f42edd3615fb0367df1a5">00404</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a095d7d0bdc2f42edd3615fb0367df1a5">kPointersFromHereAreInterestingMask</a> =
<a name="l00405"></a>00405       1 &lt;&lt; <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a17af3b9a7543d3eb8051801107209d64">POINTERS_FROM_HERE_ARE_INTERESTING</a>;
<a name="l00406"></a>00406 
<a name="l00407"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3351831113c80aaa9f987bb46d0c2bf5">00407</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3351831113c80aaa9f987bb46d0c2bf5">kEvacuationCandidateMask</a> =
<a name="l00408"></a>00408       1 &lt;&lt; <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aca1f36af6a87bdc5837fec5646a83880">EVACUATION_CANDIDATE</a>;
<a name="l00409"></a>00409 
<a name="l00410"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac21cadcf39d0971633fd4d18b92969a8">00410</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac21cadcf39d0971633fd4d18b92969a8">kSkipEvacuationSlotsRecordingMask</a> =
<a name="l00411"></a>00411       (1 &lt;&lt; <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aca1f36af6a87bdc5837fec5646a83880">EVACUATION_CANDIDATE</a>) |
<a name="l00412"></a>00412       (1 &lt;&lt; <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a03d3c648f27f66bfc8c521871d04a443">RESCAN_ON_EVACUATION</a>) |
<a name="l00413"></a>00413       (1 &lt;&lt; <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aa408ee11091f95fd8f99029fa9518b3c">IN_FROM_SPACE</a>) |
<a name="l00414"></a>00414       (1 &lt;&lt; <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aee1c28de56468284306cbcc64c6f62c6">IN_TO_SPACE</a>);
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 
<a name="l00417"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a79b86e423956219c0a048b3dbcff6abb">00417</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a79b86e423956219c0a048b3dbcff6abb">SetFlag</a>(<span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#af66616b6f81f11570470384b6a4826a3">flag</a>) {
<a name="l00418"></a>00418     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3ae16f5082dad9677e41dbef85078336">flags_</a> |= <span class="keyword">static_cast&lt;</span>uintptr_t<span class="keyword">&gt;</span>(1) &lt;&lt; flag;
<a name="l00419"></a>00419   }
<a name="l00420"></a>00420 
<a name="l00421"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#adb4258f348c4ca8d6fd5e0dc962046b3">00421</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#adb4258f348c4ca8d6fd5e0dc962046b3">ClearFlag</a>(<span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#af66616b6f81f11570470384b6a4826a3">flag</a>) {
<a name="l00422"></a>00422     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3ae16f5082dad9677e41dbef85078336">flags_</a> &amp;= ~(<span class="keyword">static_cast&lt;</span>uintptr_t<span class="keyword">&gt;</span>(1) &lt;&lt; flag);
<a name="l00423"></a>00423   }
<a name="l00424"></a>00424 
<a name="l00425"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a6b84287173dcdd26e904d501bbd5d667">00425</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a6b84287173dcdd26e904d501bbd5d667">SetFlagTo</a>(<span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#af66616b6f81f11570470384b6a4826a3">flag</a>, <span class="keywordtype">bool</span> value) {
<a name="l00426"></a>00426     <span class="keywordflow">if</span> (value) {
<a name="l00427"></a>00427       <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a79b86e423956219c0a048b3dbcff6abb">SetFlag</a>(flag);
<a name="l00428"></a>00428     } <span class="keywordflow">else</span> {
<a name="l00429"></a>00429       <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#adb4258f348c4ca8d6fd5e0dc962046b3">ClearFlag</a>(flag);
<a name="l00430"></a>00430     }
<a name="l00431"></a>00431   }
<a name="l00432"></a>00432 
<a name="l00433"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a01e5775f7047a3ff75f0c24afabb6e96">00433</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a01e5775f7047a3ff75f0c24afabb6e96">IsFlagSet</a>(<span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#af66616b6f81f11570470384b6a4826a3">flag</a>) {
<a name="l00434"></a>00434     <span class="keywordflow">return</span> (<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3ae16f5082dad9677e41dbef85078336">flags_</a> &amp; (static_cast&lt;uintptr_t&gt;(1) &lt;&lt; flag)) != 0;
<a name="l00435"></a>00435   }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437   <span class="comment">// Set or clear multiple flags at a time. The flags in the mask</span>
<a name="l00438"></a>00438   <span class="comment">// are set to the value in &quot;flags&quot;, the rest retain the current value</span>
<a name="l00439"></a>00439   <span class="comment">// in flags_.</span>
<a name="l00440"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a21cd4531eb88e68db9a9805460824816">00440</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a21cd4531eb88e68db9a9805460824816">SetFlags</a>(intptr_t <a class="code" href="namespacev8_1_1internal.html#a9b4b1c68517c9a42918bc7079187ec70">flags</a>, intptr_t mask) {
<a name="l00441"></a>00441     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3ae16f5082dad9677e41dbef85078336">flags_</a> = (<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3ae16f5082dad9677e41dbef85078336">flags_</a> &amp; ~mask) | (flags &amp; mask);
<a name="l00442"></a>00442   }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444   <span class="comment">// Return all current flags.</span>
<a name="l00445"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac57eac8426605f97ed215ddf886d75b4">00445</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac57eac8426605f97ed215ddf886d75b4">GetFlags</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3ae16f5082dad9677e41dbef85078336">flags_</a>; }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447   <span class="comment">// Manage live byte count (count of bytes known to be live,</span>
<a name="l00448"></a>00448   <span class="comment">// because they are marked black).</span>
<a name="l00449"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a8ef1d427e8915eed249457382e562a0a">00449</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a8ef1d427e8915eed249457382e562a0a">ResetLiveBytes</a>() {
<a name="l00450"></a>00450     <span class="keywordflow">if</span> (FLAG_gc_verbose) {
<a name="l00451"></a>00451       <a class="code" href="namespacev8_1_1internal.html#a983357dee691fc08ce75ee9b0c132ca7">PrintF</a>(<span class="stringliteral">&quot;ResetLiveBytes:%p:%x-&gt;0\n&quot;</span>,
<a name="l00452"></a>00452              static_cast&lt;void*&gt;(<span class="keyword">this</span>), <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac36b325338acbe3ba00ade7ea9cd1b32">live_byte_count_</a>);
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac36b325338acbe3ba00ade7ea9cd1b32">live_byte_count_</a> = 0;
<a name="l00455"></a>00455   }
<a name="l00456"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a246e44a97d210359edeb434896f26b2b">00456</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a246e44a97d210359edeb434896f26b2b">IncrementLiveBytes</a>(<span class="keywordtype">int</span> by) {
<a name="l00457"></a>00457     <span class="keywordflow">if</span> (FLAG_gc_verbose) {
<a name="l00458"></a>00458       printf(<span class="stringliteral">&quot;UpdateLiveBytes:%p:%x%c=%x-&gt;%x\n&quot;</span>,
<a name="l00459"></a>00459              static_cast&lt;void*&gt;(<span class="keyword">this</span>), <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac36b325338acbe3ba00ade7ea9cd1b32">live_byte_count_</a>,
<a name="l00460"></a>00460              ((by &lt; 0) ? <span class="charliteral">&#39;-&#39;</span> : <span class="charliteral">&#39;+&#39;</span>), ((by &lt; 0) ? -by : by),
<a name="l00461"></a>00461              <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac36b325338acbe3ba00ade7ea9cd1b32">live_byte_count_</a> + by);
<a name="l00462"></a>00462     }
<a name="l00463"></a>00463     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac36b325338acbe3ba00ade7ea9cd1b32">live_byte_count_</a> += by;
<a name="l00464"></a>00464     <a class="code" href="checks_8h.html#a5f2db7b7625d842511de66ae6055e1f6">ASSERT_LE</a>(static_cast&lt;unsigned&gt;(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac36b325338acbe3ba00ade7ea9cd1b32">live_byte_count_</a>), <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac05692e8f7065568047e69bd9b4ca36e">size_</a>);
<a name="l00465"></a>00465   }
<a name="l00466"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a1ee6cbf1d7466945aa5d8ae062ff602f">00466</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a1ee6cbf1d7466945aa5d8ae062ff602f">LiveBytes</a>() {
<a name="l00467"></a>00467     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(static_cast&lt;unsigned&gt;(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac36b325338acbe3ba00ade7ea9cd1b32">live_byte_count_</a>) &lt;= <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac05692e8f7065568047e69bd9b4ca36e">size_</a>);
<a name="l00468"></a>00468     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac36b325338acbe3ba00ade7ea9cd1b32">live_byte_count_</a>;
<a name="l00469"></a>00469   }
<a name="l00470"></a>00470 
<a name="l00471"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3c349f01d0fce3625ff9ce9cb6d6c272">00471</a>   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3c349f01d0fce3625ff9ce9cb6d6c272">IncrementLiveBytesFromGC</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae2a42f2abeb57a8206eee9ff85a07ec6">address</a>, <span class="keywordtype">int</span> by) {
<a name="l00472"></a>00472     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa085e1ca88c6b66f52e3f12dc4c89195">MemoryChunk::FromAddress</a>(address)-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a246e44a97d210359edeb434896f26b2b">IncrementLiveBytes</a>(by);
<a name="l00473"></a>00473   }
<a name="l00474"></a>00474 
<a name="l00475"></a>00475   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a22f1cb720fa403b143f3bfd04c14047b">IncrementLiveBytesFromMutator</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae2a42f2abeb57a8206eee9ff85a07ec6">address</a>, <span class="keywordtype">int</span> by);
<a name="l00476"></a>00476 
<a name="l00477"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aeb9f7807568ebb3077c7d89921fcfee2">00477</a>   <span class="keyword">static</span> <span class="keyword">const</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aeb9f7807568ebb3077c7d89921fcfee2">kAlignment</a> =
<a name="l00478"></a>00478       (<span class="keyword">static_cast&lt;</span>uintptr_t<span class="keyword">&gt;</span>(1) &lt;&lt; <a class="code" href="namespacev8_1_1internal.html#ae235e28650afe77e4b99a9b02e705a2f">kPageSizeBits</a>);
<a name="l00479"></a>00479 
<a name="l00480"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aacbc80f7e6ca4f243c9b31dc2d5fd6e8">00480</a>   <span class="keyword">static</span> <span class="keyword">const</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aacbc80f7e6ca4f243c9b31dc2d5fd6e8">kAlignmentMask</a> = <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aeb9f7807568ebb3077c7d89921fcfee2">kAlignment</a> - 1;
<a name="l00481"></a>00481 
<a name="l00482"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a92f3178835a10fa2ad862528a91f1e66">00482</a>   <span class="keyword">static</span> <span class="keyword">const</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a92f3178835a10fa2ad862528a91f1e66">kSizeOffset</a> = <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a> + <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a>;
<a name="l00483"></a>00483 
<a name="l00484"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad250a03190baf4dc4ddccf477d916d89">00484</a>   <span class="keyword">static</span> <span class="keyword">const</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad250a03190baf4dc4ddccf477d916d89">kLiveBytesOffset</a> =
<a name="l00485"></a>00485      <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a92f3178835a10fa2ad862528a91f1e66">kSizeOffset</a> + <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a> + <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a> + <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a> +
<a name="l00486"></a>00486      <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a> + <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a> +
<a name="l00487"></a>00487      <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a> + <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a> + <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a> + <a class="code" href="namespacev8_1_1internal.html#a9fecb8cec146ed2b369f0d1c6b798c91">kIntSize</a>;
<a name="l00488"></a>00488 
<a name="l00489"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aedb4b36d6b2ea47fc583c130139372bd">00489</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aedb4b36d6b2ea47fc583c130139372bd">kSlotsBufferOffset</a> = <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad250a03190baf4dc4ddccf477d916d89">kLiveBytesOffset</a> + <a class="code" href="namespacev8_1_1internal.html#a9fecb8cec146ed2b369f0d1c6b798c91">kIntSize</a>;
<a name="l00490"></a>00490 
<a name="l00491"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a9d854e2a69023012cd6c1f2a811ed3a2">00491</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a9d854e2a69023012cd6c1f2a811ed3a2">kHeaderSize</a> =
<a name="l00492"></a>00492       <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aedb4b36d6b2ea47fc583c130139372bd">kSlotsBufferOffset</a> + <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a> + <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a>;
<a name="l00493"></a>00493 
<a name="l00494"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7529c94094cfc0789acd79a2e439c6dd">00494</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7529c94094cfc0789acd79a2e439c6dd">kBodyOffset</a> =
<a name="l00495"></a>00495     <a class="code" href="v8globals_8h.html#a72e6767375b879a729688be502e971ad">CODE_POINTER_ALIGN</a>(<a class="code" href="v8globals_8h.html#ae2258e1c77d9b1b27ec6ee88b1ec5c4c">MAP_POINTER_ALIGN</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a9d854e2a69023012cd6c1f2a811ed3a2">kHeaderSize</a> + <a class="code" href="classv8_1_1internal_1_1_bitmap.html#aace66f0559638e54076e0d27b8d9ecc3">Bitmap::kSize</a>));
<a name="l00496"></a>00496 
<a name="l00497"></a>00497   <span class="comment">// The start offset of the object area in a page. Aligned to both maps and</span>
<a name="l00498"></a>00498   <span class="comment">// code alignment to be suitable for both.  Also aligned to 32 words because</span>
<a name="l00499"></a>00499   <span class="comment">// the marking bitmap is arranged in 32 bit chunks.</span>
<a name="l00500"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac2a0cdf9458acf5ae6483384a72b18c2">00500</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac2a0cdf9458acf5ae6483384a72b18c2">kObjectStartAlignment</a> = 32 * <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a>;
<a name="l00501"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a323d49bf8af911559723fa084503b6e7">00501</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a323d49bf8af911559723fa084503b6e7">kObjectStartOffset</a> = <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7529c94094cfc0789acd79a2e439c6dd">kBodyOffset</a> - 1 +
<a name="l00502"></a>00502       (<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac2a0cdf9458acf5ae6483384a72b18c2">kObjectStartAlignment</a> - (<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7529c94094cfc0789acd79a2e439c6dd">kBodyOffset</a> - 1) % <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac2a0cdf9458acf5ae6483384a72b18c2">kObjectStartAlignment</a>);
<a name="l00503"></a>00503 
<a name="l00504"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae23e3065f4ea40b54471563107ef07c9">00504</a>   <span class="keywordtype">size_t</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae23e3065f4ea40b54471563107ef07c9">size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac05692e8f7065568047e69bd9b4ca36e">size_</a>; }
<a name="l00505"></a>00505 
<a name="l00506"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aca1b8c21e6cb795a4c2613a9508ac64e">00506</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aca1b8c21e6cb795a4c2613a9508ac64e">set_size</a>(<span class="keywordtype">size_t</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae23e3065f4ea40b54471563107ef07c9">size</a>) {
<a name="l00507"></a>00507     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac05692e8f7065568047e69bd9b4ca36e">size_</a> = <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae23e3065f4ea40b54471563107ef07c9">size</a>;
<a name="l00508"></a>00508   }
<a name="l00509"></a>00509 
<a name="l00510"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad4c73f7dbb3bed79a1fa11bbd6668ace">00510</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad4c73f7dbb3bed79a1fa11bbd6668ace">SetArea</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a8992f4ee6a39c4c82eb82e0b3e33e9fa">area_start</a>, <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad3898b428d291ef457bc87c2999ff18d">area_end</a>) {
<a name="l00511"></a>00511     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#adfaa9c39f9046afddf0f2e279b2bad21">area_start_</a> = <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a8992f4ee6a39c4c82eb82e0b3e33e9fa">area_start</a>;
<a name="l00512"></a>00512     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a53745782f0f13117afa97ede9600eb19">area_end_</a> = <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad3898b428d291ef457bc87c2999ff18d">area_end</a>;
<a name="l00513"></a>00513   }
<a name="l00514"></a>00514 
<a name="l00515"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a09a81cd757b38893db3e4bef37dbdf0b">00515</a>   <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a09a81cd757b38893db3e4bef37dbdf0b">executable</a>() {
<a name="l00516"></a>00516     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a01e5775f7047a3ff75f0c24afabb6e96">IsFlagSet</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78adf40869b808cdb4df42933e6402fcf93">IS_EXECUTABLE</a>) ? <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093ad67a5bf240f74799913a3d5179715c22">EXECUTABLE</a> : <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093a1b9620a0e08f61037b76f280f98c6df8">NOT_EXECUTABLE</a>;
<a name="l00517"></a>00517   }
<a name="l00518"></a>00518 
<a name="l00519"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a91338b4ed71611368d0a5afeedabe549">00519</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a91338b4ed71611368d0a5afeedabe549">ContainsOnlyData</a>() {
<a name="l00520"></a>00520     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a01e5775f7047a3ff75f0c24afabb6e96">IsFlagSet</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78ad3f4841afb5344315f99126788645abd">CONTAINS_ONLY_DATA</a>);
<a name="l00521"></a>00521   }
<a name="l00522"></a>00522 
<a name="l00523"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a440a5fbf7b463a4762b6ee1e73224ac7">00523</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a440a5fbf7b463a4762b6ee1e73224ac7">InNewSpace</a>() {
<a name="l00524"></a>00524     <span class="keywordflow">return</span> (<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3ae16f5082dad9677e41dbef85078336">flags_</a> &amp; ((1 &lt;&lt; <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aa408ee11091f95fd8f99029fa9518b3c">IN_FROM_SPACE</a>) | (1 &lt;&lt; <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aee1c28de56468284306cbcc64c6f62c6">IN_TO_SPACE</a>))) != 0;
<a name="l00525"></a>00525   }
<a name="l00526"></a>00526 
<a name="l00527"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ab6ab9770e08a7a9c80a2e64a180ee98e">00527</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ab6ab9770e08a7a9c80a2e64a180ee98e">InToSpace</a>() {
<a name="l00528"></a>00528     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a01e5775f7047a3ff75f0c24afabb6e96">IsFlagSet</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aee1c28de56468284306cbcc64c6f62c6">IN_TO_SPACE</a>);
<a name="l00529"></a>00529   }
<a name="l00530"></a>00530 
<a name="l00531"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aab8369550d359793e8d5d1dd0389389a">00531</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aab8369550d359793e8d5d1dd0389389a">InFromSpace</a>() {
<a name="l00532"></a>00532     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a01e5775f7047a3ff75f0c24afabb6e96">IsFlagSet</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aa408ee11091f95fd8f99029fa9518b3c">IN_FROM_SPACE</a>);
<a name="l00533"></a>00533   }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535   <span class="comment">// ---------------------------------------------------------------------</span>
<a name="l00536"></a>00536   <span class="comment">// Markbits support</span>
<a name="l00537"></a>00537 
<a name="l00538"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ab24fe2fc15e5b41706c99c5be3e4282f">00538</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_bitmap.html">Bitmap</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ab24fe2fc15e5b41706c99c5be3e4282f">markbits</a>() {
<a name="l00539"></a>00539     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa085e1ca88c6b66f52e3f12dc4c89195">Bitmap::FromAddress</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae2a42f2abeb57a8206eee9ff85a07ec6">address</a>() + <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a9d854e2a69023012cd6c1f2a811ed3a2">kHeaderSize</a>);
<a name="l00540"></a>00540   }
<a name="l00541"></a>00541 
<a name="l00542"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a425f2a823238ce64db431053707772f6">00542</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a425f2a823238ce64db431053707772f6">PrintMarkbits</a>() { <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ab24fe2fc15e5b41706c99c5be3e4282f">markbits</a>()-&gt;<a class="code" href="classv8_1_1internal_1_1_bitmap.html#a62cecf8d8ab89f87fc4db5555b10b6b0">Print</a>(); }
<a name="l00543"></a>00543 
<a name="l00544"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ab5034cf79ef9bd456426b830aa87fd61">00544</a>   <span class="keyword">inline</span> uint32_t <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ab5034cf79ef9bd456426b830aa87fd61">AddressToMarkbitIndex</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr) {
<a name="l00545"></a>00545     <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(addr - this-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae2a42f2abeb57a8206eee9ff85a07ec6">address</a>()) &gt;&gt; <a class="code" href="namespacev8_1_1internal.html#a601740e70a85facf0b9567aa303a7e5f">kPointerSizeLog2</a>;
<a name="l00546"></a>00546   }
<a name="l00547"></a>00547 
<a name="l00548"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a4a2dc25d29e9097e52aaa2e918207d9c">00548</a>   <span class="keyword">inline</span> <span class="keyword">static</span> uint32_t <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a4a2dc25d29e9097e52aaa2e918207d9c">FastAddressToMarkbitIndex</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr) {
<a name="l00549"></a>00549     <span class="keyword">const</span> intptr_t offset =
<a name="l00550"></a>00550         <span class="keyword">reinterpret_cast&lt;</span>intptr_t<span class="keyword">&gt;</span>(addr) &amp; <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aacbc80f7e6ca4f243c9b31dc2d5fd6e8">kAlignmentMask</a>;
<a name="l00551"></a>00551 
<a name="l00552"></a>00552     <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(offset) &gt;&gt; <a class="code" href="namespacev8_1_1internal.html#a601740e70a85facf0b9567aa303a7e5f">kPointerSizeLog2</a>;
<a name="l00553"></a>00553   }
<a name="l00554"></a>00554 
<a name="l00555"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a5ee84229c5c4c3f06227682a94930cf1">00555</a>   <span class="keyword">inline</span> <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a5ee84229c5c4c3f06227682a94930cf1">MarkbitIndexToAddress</a>(uint32_t index) {
<a name="l00556"></a>00556     <span class="keywordflow">return</span> this-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae2a42f2abeb57a8206eee9ff85a07ec6">address</a>() + (index &lt;&lt; <a class="code" href="namespacev8_1_1internal.html#a601740e70a85facf0b9567aa303a7e5f">kPointerSizeLog2</a>);
<a name="l00557"></a>00557   }
<a name="l00558"></a>00558 
<a name="l00559"></a>00559   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#af0b353f3e62e150a748a2d7aef35a0ff">InsertAfter</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* other);
<a name="l00560"></a>00560   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a6567612ab1fca1a2bd3d97f9205f9eda">Unlink</a>();
<a name="l00561"></a>00561 
<a name="l00562"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0d2f4722858e958a80df90a287958581">00562</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0d2f4722858e958a80df90a287958581">heap</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a425822569500a696f4484f43692e02f5">heap_</a>; }
<a name="l00563"></a>00563 
<a name="l00564"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0c35166837018b627a22f6c8d8996fcc">00564</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0c35166837018b627a22f6c8d8996fcc">kFlagsOffset</a> = <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a> * 3;
<a name="l00565"></a>00565 
<a name="l00566"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa67b67fb53d38d2e88207679397c21ce">00566</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa67b67fb53d38d2e88207679397c21ce">IsEvacuationCandidate</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a01e5775f7047a3ff75f0c24afabb6e96">IsFlagSet</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aca1f36af6a87bdc5837fec5646a83880">EVACUATION_CANDIDATE</a>); }
<a name="l00567"></a>00567 
<a name="l00568"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac9b98d8975917d1442b834c8828d1eb3">00568</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac9b98d8975917d1442b834c8828d1eb3">ShouldSkipEvacuationSlotRecording</a>() {
<a name="l00569"></a>00569     <span class="keywordflow">return</span> (<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3ae16f5082dad9677e41dbef85078336">flags_</a> &amp; <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac21cadcf39d0971633fd4d18b92969a8">kSkipEvacuationSlotsRecordingMask</a>) != 0;
<a name="l00570"></a>00570   }
<a name="l00571"></a>00571 
<a name="l00572"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a07fa46d9e099b97dd2be1b9b35b9750a">00572</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_skip_list.html">SkipList</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a07fa46d9e099b97dd2be1b9b35b9750a">skip_list</a>() {
<a name="l00573"></a>00573     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0f375a7b0d832bbca116e0d208e14227">skip_list_</a>;
<a name="l00574"></a>00574   }
<a name="l00575"></a>00575 
<a name="l00576"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#abc9c19c1cc451e69db7ee628707b6047">00576</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#abc9c19c1cc451e69db7ee628707b6047">set_skip_list</a>(<a class="code" href="classv8_1_1internal_1_1_skip_list.html">SkipList</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a07fa46d9e099b97dd2be1b9b35b9750a">skip_list</a>) {
<a name="l00577"></a>00577     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0f375a7b0d832bbca116e0d208e14227">skip_list_</a> = <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a07fa46d9e099b97dd2be1b9b35b9750a">skip_list</a>;
<a name="l00578"></a>00578   }
<a name="l00579"></a>00579 
<a name="l00580"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac9aca916585841128fd0791f253b0cbb">00580</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac9aca916585841128fd0791f253b0cbb">slots_buffer</a>() {
<a name="l00581"></a>00581     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ab0ab014127b0a208ec81470d44d380d0">slots_buffer_</a>;
<a name="l00582"></a>00582   }
<a name="l00583"></a>00583 
<a name="l00584"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a1fce496e93c3d1e27c4df186f874fd7a">00584</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>** <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a1fce496e93c3d1e27c4df186f874fd7a">slots_buffer_address</a>() {
<a name="l00585"></a>00585     <span class="keywordflow">return</span> &amp;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ab0ab014127b0a208ec81470d44d380d0">slots_buffer_</a>;
<a name="l00586"></a>00586   }
<a name="l00587"></a>00587 
<a name="l00588"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3f8ec3cab140884941a6bcb3973dca49">00588</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3f8ec3cab140884941a6bcb3973dca49">MarkEvacuationCandidate</a>() {
<a name="l00589"></a>00589     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ab0ab014127b0a208ec81470d44d380d0">slots_buffer_</a> == <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>);
<a name="l00590"></a>00590     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a79b86e423956219c0a048b3dbcff6abb">SetFlag</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aca1f36af6a87bdc5837fec5646a83880">EVACUATION_CANDIDATE</a>);
<a name="l00591"></a>00591   }
<a name="l00592"></a>00592 
<a name="l00593"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aeb98d8bef24dbe7562ac6e8ca9dee860">00593</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aeb98d8bef24dbe7562ac6e8ca9dee860">ClearEvacuationCandidate</a>() {
<a name="l00594"></a>00594     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ab0ab014127b0a208ec81470d44d380d0">slots_buffer_</a> == <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>);
<a name="l00595"></a>00595     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#adb4258f348c4ca8d6fd5e0dc962046b3">ClearFlag</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aca1f36af6a87bdc5837fec5646a83880">EVACUATION_CANDIDATE</a>);
<a name="l00596"></a>00596   }
<a name="l00597"></a>00597 
<a name="l00598"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a8992f4ee6a39c4c82eb82e0b3e33e9fa">00598</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a8992f4ee6a39c4c82eb82e0b3e33e9fa">area_start</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#adfaa9c39f9046afddf0f2e279b2bad21">area_start_</a>; }
<a name="l00599"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad3898b428d291ef457bc87c2999ff18d">00599</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad3898b428d291ef457bc87c2999ff18d">area_end</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a53745782f0f13117afa97ede9600eb19">area_end_</a>; }
<a name="l00600"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ada395cf5efb11ccb21b0f084729f065c">00600</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ada395cf5efb11ccb21b0f084729f065c">area_size</a>() {
<a name="l00601"></a>00601     <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad3898b428d291ef457bc87c2999ff18d">area_end</a>() - <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a8992f4ee6a39c4c82eb82e0b3e33e9fa">area_start</a>());
<a name="l00602"></a>00602   }
<a name="l00603"></a>00603 
<a name="l00604"></a>00604  <span class="keyword">protected</span>:
<a name="l00605"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0e085f89e88f22f0b62d3b63a19a7e2d">00605</a>   <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0e085f89e88f22f0b62d3b63a19a7e2d">next_chunk_</a>;
<a name="l00606"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad45b962ed5ed46492a4e90afa2e7cd7d">00606</a>   <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad45b962ed5ed46492a4e90afa2e7cd7d">prev_chunk_</a>;
<a name="l00607"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac05692e8f7065568047e69bd9b4ca36e">00607</a>   <span class="keywordtype">size_t</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac05692e8f7065568047e69bd9b4ca36e">size_</a>;
<a name="l00608"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3ae16f5082dad9677e41dbef85078336">00608</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3ae16f5082dad9677e41dbef85078336">flags_</a>;
<a name="l00609"></a>00609 
<a name="l00610"></a>00610   <span class="comment">// Start and end of allocatable memory on this chunk.</span>
<a name="l00611"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#adfaa9c39f9046afddf0f2e279b2bad21">00611</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#adfaa9c39f9046afddf0f2e279b2bad21">area_start_</a>;
<a name="l00612"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a53745782f0f13117afa97ede9600eb19">00612</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a53745782f0f13117afa97ede9600eb19">area_end_</a>;
<a name="l00613"></a>00613 
<a name="l00614"></a>00614   <span class="comment">// If the chunk needs to remember its memory reservation, it is stored here.</span>
<a name="l00615"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a404397b274b9d25be3555c1e2f61a3f0">00615</a>   <a class="code" href="classv8_1_1internal_1_1_virtual_memory.html">VirtualMemory</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a404397b274b9d25be3555c1e2f61a3f0">reservation_</a>;
<a name="l00616"></a>00616   <span class="comment">// The identity of the owning space.  This is tagged as a failure pointer, but</span>
<a name="l00617"></a>00617   <span class="comment">// no failure can be in an object, so this can be distinguished from any entry</span>
<a name="l00618"></a>00618   <span class="comment">// in a fixed array.</span>
<a name="l00619"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aca081334cd06102fecc638fdd2f92bff">00619</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aca081334cd06102fecc638fdd2f92bff">owner_</a>;
<a name="l00620"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a425822569500a696f4484f43692e02f5">00620</a>   <a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a425822569500a696f4484f43692e02f5">heap_</a>;
<a name="l00621"></a>00621   <span class="comment">// Used by the store buffer to keep track of which pages to mark scan-on-</span>
<a name="l00622"></a>00622   <span class="comment">// scavenge.</span>
<a name="l00623"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#afb8aa3f7dfbdf1024ab30c8eacb8c7d8">00623</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#afb8aa3f7dfbdf1024ab30c8eacb8c7d8">store_buffer_counter_</a>;
<a name="l00624"></a>00624   <span class="comment">// Count of bytes marked black on page.</span>
<a name="l00625"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac36b325338acbe3ba00ade7ea9cd1b32">00625</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ac36b325338acbe3ba00ade7ea9cd1b32">live_byte_count_</a>;
<a name="l00626"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ab0ab014127b0a208ec81470d44d380d0">00626</a>   <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ab0ab014127b0a208ec81470d44d380d0">slots_buffer_</a>;
<a name="l00627"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0f375a7b0d832bbca116e0d208e14227">00627</a>   <a class="code" href="classv8_1_1internal_1_1_skip_list.html">SkipList</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0f375a7b0d832bbca116e0d208e14227">skip_list_</a>;
<a name="l00628"></a>00628 
<a name="l00629"></a>00629   <span class="keyword">static</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7f31723603ed539329f0c0852f78d7a8">Initialize</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0d2f4722858e958a80df90a287958581">heap</a>,
<a name="l00630"></a>00630                                  <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> base,
<a name="l00631"></a>00631                                  <span class="keywordtype">size_t</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae23e3065f4ea40b54471563107ef07c9">size</a>,
<a name="l00632"></a>00632                                  <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a8992f4ee6a39c4c82eb82e0b3e33e9fa">area_start</a>,
<a name="l00633"></a>00633                                  <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad3898b428d291ef457bc87c2999ff18d">area_end</a>,
<a name="l00634"></a>00634                                  <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a09a81cd757b38893db3e4bef37dbdf0b">executable</a>,
<a name="l00635"></a>00635                                  <a class="code" href="classv8_1_1internal_1_1_space.html">Space</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3e6f1fb7b24f1662eed90feefb5152ad">owner</a>);
<a name="l00636"></a>00636 
<a name="l00637"></a><a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aea1126d5a764b0d074d2d6edb5a09f23">00637</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_memory_allocator.html">MemoryAllocator</a>;
<a name="l00638"></a>00638 };
<a name="l00639"></a>00639 
<a name="l00640"></a>00640 
<a name="l00641"></a>00641 <a class="code" href="namespacev8_1_1internal.html#a478475eb268390f7e94ac23b9c4c1e5f">STATIC_CHECK</a>(<span class="keyword">sizeof</span>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>) &lt;= <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a9d854e2a69023012cd6c1f2a811ed3a2">MemoryChunk::kHeaderSize</a>);
<a name="l00642"></a>00642 
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l00645"></a>00645 <span class="comment">// A page is a memory chunk of a size 1MB. Large object pages may be larger.</span>
<a name="l00646"></a>00646 <span class="comment">//</span>
<a name="l00647"></a>00647 <span class="comment">// The only way to get a page pointer is by calling factory methods:</span>
<a name="l00648"></a>00648 <span class="comment">//   Page* p = Page::FromAddress(addr); or</span>
<a name="l00649"></a>00649 <span class="comment">//   Page* p = Page::FromAllocationTop(top);</span>
<a name="l00650"></a><a class="code" href="classv8_1_1internal_1_1_page.html">00650</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_page.html">Page</a> : <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a> {
<a name="l00651"></a>00651  <span class="keyword">public</span>:
<a name="l00652"></a>00652   <span class="comment">// Returns the page containing a given address. The address ranges</span>
<a name="l00653"></a>00653   <span class="comment">// from [page_addr .. page_addr + kPageSize[</span>
<a name="l00654"></a>00654   <span class="comment">// This only works if the object is in fact in a page.  See also MemoryChunk::</span>
<a name="l00655"></a>00655   <span class="comment">// FromAddress() and FromAnyAddress().</span>
<a name="l00656"></a><a class="code" href="classv8_1_1internal_1_1_page.html#aaa2123a194e5ac2215d4b88f871496d2">00656</a>   <a class="code" href="classv8_1_1internal_1_1_page.html#aaa2123a194e5ac2215d4b88f871496d2">INLINE</a>(<span class="keyword">static</span> <a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa085e1ca88c6b66f52e3f12dc4c89195">FromAddress</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> a)) {
<a name="l00657"></a>00657     <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>*<span class="keyword">&gt;</span>(<a class="code" href="namespacev8_1_1internal.html#aefd9bd49976aa2276ada1b562f1c6cbb">OffsetFrom</a>(a) &amp; ~<a class="code" href="classv8_1_1internal_1_1_page.html#a856e4e5c2ed9278569185cc42b7a645f">kPageAlignmentMask</a>);
<a name="l00658"></a>00658   }
<a name="l00659"></a>00659 
<a name="l00660"></a>00660   <span class="comment">// Returns the page containing an allocation top. Because an allocation</span>
<a name="l00661"></a>00661   <span class="comment">// top address can be the upper bound of the page, we need to subtract</span>
<a name="l00662"></a>00662   <span class="comment">// it with kPointerSize first. The address ranges from</span>
<a name="l00663"></a>00663   <span class="comment">// [page_addr + kObjectStartOffset .. page_addr + kPageSize].</span>
<a name="l00664"></a><a class="code" href="classv8_1_1internal_1_1_page.html#a6079755007fc42345657cae91ffa4327">00664</a>   <a class="code" href="classv8_1_1internal_1_1_page.html#a6079755007fc42345657cae91ffa4327">INLINE</a>(<span class="keyword">static</span> <a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* FromAllocationTop(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> top)) {
<a name="l00665"></a>00665     <a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* p = <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa085e1ca88c6b66f52e3f12dc4c89195">FromAddress</a>(top - <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a>);
<a name="l00666"></a>00666     <span class="keywordflow">return</span> p;
<a name="l00667"></a>00667   }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669   <span class="comment">// Returns the next page in the chain of pages owned by a space.</span>
<a name="l00670"></a>00670   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* <a class="code" href="classv8_1_1internal_1_1_page.html#ab834d7fc9300a94f86057ab689f0ec54">next_page</a>();
<a name="l00671"></a>00671   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* <a class="code" href="classv8_1_1internal_1_1_page.html#aec84549fbe37407ce4f79a4e0ab3c581">prev_page</a>();
<a name="l00672"></a>00672   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_page.html#a8d3fa6eded73758af00da19f8c50d36a">set_next_page</a>(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* page);
<a name="l00673"></a>00673   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_page.html#af7d1c024c6a89558e3163337727cab11">set_prev_page</a>(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* page);
<a name="l00674"></a>00674 
<a name="l00675"></a>00675   <span class="comment">// Checks whether an address is page aligned.</span>
<a name="l00676"></a><a class="code" href="classv8_1_1internal_1_1_page.html#aab20c57d6026c326a5422b1d776f4e28">00676</a>   <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_page.html#aab20c57d6026c326a5422b1d776f4e28">IsAlignedToPageSize</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> a) {
<a name="l00677"></a>00677     <span class="keywordflow">return</span> 0 == (<a class="code" href="namespacev8_1_1internal.html#aefd9bd49976aa2276ada1b562f1c6cbb">OffsetFrom</a>(a) &amp; <a class="code" href="classv8_1_1internal_1_1_page.html#a856e4e5c2ed9278569185cc42b7a645f">kPageAlignmentMask</a>);
<a name="l00678"></a>00678   }
<a name="l00679"></a>00679 
<a name="l00680"></a>00680   <span class="comment">// Returns the offset of a given address to this page.</span>
<a name="l00681"></a><a class="code" href="classv8_1_1internal_1_1_page.html#a3d1a7a068ff0c2affacc928d8233035b">00681</a>   <a class="code" href="classv8_1_1internal_1_1_page.html#a3d1a7a068ff0c2affacc928d8233035b">INLINE</a>(<span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#a34b2f9167dd96bb343a9c0877b8c61bea49a8f213e4f9a02ecb6630bc8b1436d2">Offset</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> a)) {
<a name="l00682"></a>00682     <span class="keywordtype">int</span> offset = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(a - <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae2a42f2abeb57a8206eee9ff85a07ec6">address</a>());
<a name="l00683"></a>00683     <span class="keywordflow">return</span> offset;
<a name="l00684"></a>00684   }
<a name="l00685"></a>00685 
<a name="l00686"></a>00686   <span class="comment">// Returns the address for a given offset to the this page.</span>
<a name="l00687"></a><a class="code" href="classv8_1_1internal_1_1_page.html#ad509ccd737af65973e04fe119d951d13">00687</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_page.html#ad509ccd737af65973e04fe119d951d13">OffsetToAddress</a>(<span class="keywordtype">int</span> offset) {
<a name="l00688"></a>00688     <a class="code" href="spaces_8h.html#adf94377cff5bd1c9cddd6cff8f9446b2">ASSERT_PAGE_OFFSET</a>(offset);
<a name="l00689"></a>00689     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae2a42f2abeb57a8206eee9ff85a07ec6">address</a>() + offset;
<a name="l00690"></a>00690   }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692   <span class="comment">// ---------------------------------------------------------------------</span>
<a name="l00693"></a>00693 
<a name="l00694"></a>00694   <span class="comment">// Page size in bytes.  This must be a multiple of the OS page size.</span>
<a name="l00695"></a><a class="code" href="classv8_1_1internal_1_1_page.html#a573b8add96a07f20176e2bab44f48c20">00695</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_page.html#a573b8add96a07f20176e2bab44f48c20">kPageSize</a> = 1 &lt;&lt; <a class="code" href="namespacev8_1_1internal.html#ae235e28650afe77e4b99a9b02e705a2f">kPageSizeBits</a>;
<a name="l00696"></a>00696 
<a name="l00697"></a>00697   <span class="comment">// Object area size in bytes.</span>
<a name="l00698"></a><a class="code" href="classv8_1_1internal_1_1_page.html#a8a6f72dc41510de01d1f0972b75451d0">00698</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_page.html#a8a6f72dc41510de01d1f0972b75451d0">kNonCodeObjectAreaSize</a> = <a class="code" href="classv8_1_1internal_1_1_page.html#a573b8add96a07f20176e2bab44f48c20">kPageSize</a> - <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a323d49bf8af911559723fa084503b6e7">kObjectStartOffset</a>;
<a name="l00699"></a>00699 
<a name="l00700"></a>00700   <span class="comment">// Maximum object size that fits in a page.</span>
<a name="l00701"></a><a class="code" href="classv8_1_1internal_1_1_page.html#a5bd856341644303601c503ab751703c0">00701</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_page.html#a5bd856341644303601c503ab751703c0">kMaxNonCodeHeapObjectSize</a> = <a class="code" href="classv8_1_1internal_1_1_page.html#a8a6f72dc41510de01d1f0972b75451d0">kNonCodeObjectAreaSize</a>;
<a name="l00702"></a>00702 
<a name="l00703"></a>00703   <span class="comment">// Page size mask.</span>
<a name="l00704"></a><a class="code" href="classv8_1_1internal_1_1_page.html#a856e4e5c2ed9278569185cc42b7a645f">00704</a>   <span class="keyword">static</span> <span class="keyword">const</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_page.html#a856e4e5c2ed9278569185cc42b7a645f">kPageAlignmentMask</a> = (1 &lt;&lt; <a class="code" href="namespacev8_1_1internal.html#ae235e28650afe77e4b99a9b02e705a2f">kPageSizeBits</a>) - 1;
<a name="l00705"></a>00705 
<a name="l00706"></a>00706   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_page.html#a9d92dcd01552648c22403e49799accc9">ClearGCFields</a>();
<a name="l00707"></a>00707 
<a name="l00708"></a>00708   <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* <a class="code" href="classv8_1_1internal_1_1_page.html#a8a30a457fa257c979df5d72cc6ba9446">Initialize</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0d2f4722858e958a80df90a287958581">heap</a>,
<a name="l00709"></a>00709                                  <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* chunk,
<a name="l00710"></a>00710                                  <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a09a81cd757b38893db3e4bef37dbdf0b">executable</a>,
<a name="l00711"></a>00711                                  <a class="code" href="classv8_1_1internal_1_1_paged_space.html">PagedSpace</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3e6f1fb7b24f1662eed90feefb5152ad">owner</a>);
<a name="l00712"></a>00712 
<a name="l00713"></a>00713   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_page.html#a68a0b4c311ebff8d305e6e9a9357958c">InitializeAsAnchor</a>(<a class="code" href="classv8_1_1internal_1_1_paged_space.html">PagedSpace</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3e6f1fb7b24f1662eed90feefb5152ad">owner</a>);
<a name="l00714"></a>00714 
<a name="l00715"></a><a class="code" href="classv8_1_1internal_1_1_page.html#a7a596a99d8ef42952634b7272d3dd4c7">00715</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_page.html#a7a596a99d8ef42952634b7272d3dd4c7">WasSweptPrecisely</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a01e5775f7047a3ff75f0c24afabb6e96">IsFlagSet</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a1e741332f4c96d72fc51fc95e1f00a2a">WAS_SWEPT_PRECISELY</a>); }
<a name="l00716"></a><a class="code" href="classv8_1_1internal_1_1_page.html#a66777cd2a02b677c8d2f4d75d395198d">00716</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_page.html#a66777cd2a02b677c8d2f4d75d395198d">WasSweptConservatively</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a01e5775f7047a3ff75f0c24afabb6e96">IsFlagSet</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aefde1ea3690020ae2b738a9a3b87a94d">WAS_SWEPT_CONSERVATIVELY</a>); }
<a name="l00717"></a><a class="code" href="classv8_1_1internal_1_1_page.html#a33e59082bcc75040d9d955ec72cc0271">00717</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_page.html#a33e59082bcc75040d9d955ec72cc0271">WasSwept</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_page.html#a7a596a99d8ef42952634b7272d3dd4c7">WasSweptPrecisely</a>() || <a class="code" href="classv8_1_1internal_1_1_page.html#a66777cd2a02b677c8d2f4d75d395198d">WasSweptConservatively</a>(); }
<a name="l00718"></a>00718 
<a name="l00719"></a><a class="code" href="classv8_1_1internal_1_1_page.html#a7ba11581c0a47c3029dbf1565143847c">00719</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_page.html#a7ba11581c0a47c3029dbf1565143847c">MarkSweptPrecisely</a>() { <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a79b86e423956219c0a048b3dbcff6abb">SetFlag</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a1e741332f4c96d72fc51fc95e1f00a2a">WAS_SWEPT_PRECISELY</a>); }
<a name="l00720"></a><a class="code" href="classv8_1_1internal_1_1_page.html#a7403f9882ffe954067dd09e2e0a82e6c">00720</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_page.html#a7403f9882ffe954067dd09e2e0a82e6c">MarkSweptConservatively</a>() { <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a79b86e423956219c0a048b3dbcff6abb">SetFlag</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aefde1ea3690020ae2b738a9a3b87a94d">WAS_SWEPT_CONSERVATIVELY</a>); }
<a name="l00721"></a>00721 
<a name="l00722"></a><a class="code" href="classv8_1_1internal_1_1_page.html#af4e4fc88bee9d95e81c238ac7f532dde">00722</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_page.html#af4e4fc88bee9d95e81c238ac7f532dde">ClearSweptPrecisely</a>() { <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#adb4258f348c4ca8d6fd5e0dc962046b3">ClearFlag</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a1e741332f4c96d72fc51fc95e1f00a2a">WAS_SWEPT_PRECISELY</a>); }
<a name="l00723"></a><a class="code" href="classv8_1_1internal_1_1_page.html#abfa558cac868f968b045c0bf452234b6">00723</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_page.html#abfa558cac868f968b045c0bf452234b6">ClearSweptConservatively</a>() { <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#adb4258f348c4ca8d6fd5e0dc962046b3">ClearFlag</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78aefde1ea3690020ae2b738a9a3b87a94d">WAS_SWEPT_CONSERVATIVELY</a>); }
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00726"></a>00726 <span class="preprocessor"></span>  <span class="keywordtype">void</span> <a class="code" href="lineprocessor_8cc.html#ae894408d53a5dd2fec4c3e7ea09d5d4b">Print</a>();
<a name="l00727"></a>00727 <span class="preprocessor">#endif  // DEBUG</span>
<a name="l00728"></a>00728 <span class="preprocessor"></span>
<a name="l00729"></a><a class="code" href="classv8_1_1internal_1_1_page.html#aea1126d5a764b0d074d2d6edb5a09f23">00729</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_memory_allocator.html">MemoryAllocator</a>;
<a name="l00730"></a>00730 };
<a name="l00731"></a>00731 
<a name="l00732"></a>00732 
<a name="l00733"></a>00733 <a class="code" href="namespacev8_1_1internal.html#a478475eb268390f7e94ac23b9c4c1e5f">STATIC_CHECK</a>(<span class="keyword">sizeof</span>(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>) &lt;= <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a9d854e2a69023012cd6c1f2a811ed3a2">MemoryChunk::kHeaderSize</a>);
<a name="l00734"></a>00734 
<a name="l00735"></a>00735 
<a name="l00736"></a><a class="code" href="classv8_1_1internal_1_1_large_page.html">00736</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_large_page.html">LargePage</a> : <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a> {
<a name="l00737"></a>00737  <span class="keyword">public</span>:
<a name="l00738"></a><a class="code" href="classv8_1_1internal_1_1_large_page.html#a026fc2be5e3555b093f226c43e36e93e">00738</a>   <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <a class="code" href="classv8_1_1internal_1_1_large_page.html#a026fc2be5e3555b093f226c43e36e93e">GetObject</a>() {
<a name="l00739"></a>00739     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa085e1ca88c6b66f52e3f12dc4c89195">HeapObject::FromAddress</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a8992f4ee6a39c4c82eb82e0b3e33e9fa">area_start</a>());
<a name="l00740"></a>00740   }
<a name="l00741"></a>00741 
<a name="l00742"></a><a class="code" href="classv8_1_1internal_1_1_large_page.html#a38b0db17d4982a87a4c6d8fcce1097c4">00742</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_large_page.html">LargePage</a>* <a class="code" href="classv8_1_1internal_1_1_large_page.html#a38b0db17d4982a87a4c6d8fcce1097c4">next_page</a>()<span class="keyword"> const </span>{
<a name="l00743"></a>00743     <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><a class="code" href="classv8_1_1internal_1_1_large_page.html">LargePage</a>*<span class="keyword">&gt;</span>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a487f8c05109d4b1d31c788f7327c0ca8">next_chunk</a>());
<a name="l00744"></a>00744   }
<a name="l00745"></a>00745 
<a name="l00746"></a><a class="code" href="classv8_1_1internal_1_1_large_page.html#adb319c31470cbbac208f8dd772b9d212">00746</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_large_page.html#adb319c31470cbbac208f8dd772b9d212">set_next_page</a>(<a class="code" href="classv8_1_1internal_1_1_large_page.html">LargePage</a>* page) {
<a name="l00747"></a>00747     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a33680f5d5cd36e8094c38e0ff43ffe82">set_next_chunk</a>(page);
<a name="l00748"></a>00748   }
<a name="l00749"></a>00749  <span class="keyword">private</span>:
<a name="l00750"></a>00750   <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_large_page.html">LargePage</a>* Initialize(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0d2f4722858e958a80df90a287958581">heap</a>, <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* chunk);
<a name="l00751"></a>00751 
<a name="l00752"></a><a class="code" href="classv8_1_1internal_1_1_large_page.html#aea1126d5a764b0d074d2d6edb5a09f23">00752</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_memory_allocator.html">MemoryAllocator</a>;
<a name="l00753"></a>00753 };
<a name="l00754"></a>00754 
<a name="l00755"></a>00755 <a class="code" href="namespacev8_1_1internal.html#a478475eb268390f7e94ac23b9c4c1e5f">STATIC_CHECK</a>(<span class="keyword">sizeof</span>(<a class="code" href="classv8_1_1internal_1_1_large_page.html">LargePage</a>) &lt;= <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a9d854e2a69023012cd6c1f2a811ed3a2">MemoryChunk::kHeaderSize</a>);
<a name="l00756"></a>00756 
<a name="l00757"></a>00757 <span class="comment">// ----------------------------------------------------------------------------</span>
<a name="l00758"></a>00758 <span class="comment">// Space is the abstract superclass for all allocation spaces.</span>
<a name="l00759"></a><a class="code" href="classv8_1_1internal_1_1_space.html">00759</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_space.html">Space</a> : <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_malloced.html">Malloced</a> {
<a name="l00760"></a>00760  <span class="keyword">public</span>:
<a name="l00761"></a><a class="code" href="classv8_1_1internal_1_1_space.html#a02da0d43509d048946769ac3221fa6d4">00761</a>   <a class="code" href="classv8_1_1internal_1_1_space.html#a02da0d43509d048946769ac3221fa6d4">Space</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_space.html#aa2434e21dfedab7d15316ce88f5ee1a2">heap</a>, <a class="code" href="namespacev8_1_1internal.html#aa131d4fd9972fd8dfbec01a9243d9fef">AllocationSpace</a> <span class="keywordtype">id</span>, <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> <a class="code" href="classv8_1_1internal_1_1_space.html#aac4582fa58547eaf2339efa4b39b656c">executable</a>)
<a name="l00762"></a>00762       : heap_(heap), id_(id), executable_(executable) {}
<a name="l00763"></a>00763 
<a name="l00764"></a><a class="code" href="classv8_1_1internal_1_1_space.html#a998c4b4cbadd772cceaea1c819601058">00764</a>   <span class="keyword">virtual</span> <a class="code" href="classv8_1_1internal_1_1_space.html#a998c4b4cbadd772cceaea1c819601058">~Space</a>() {}
<a name="l00765"></a>00765 
<a name="l00766"></a><a class="code" href="classv8_1_1internal_1_1_space.html#aa2434e21dfedab7d15316ce88f5ee1a2">00766</a>   <a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_space.html#aa2434e21dfedab7d15316ce88f5ee1a2">heap</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> heap_; }
<a name="l00767"></a>00767 
<a name="l00768"></a>00768   <span class="comment">// Does the space need executable memory?</span>
<a name="l00769"></a><a class="code" href="classv8_1_1internal_1_1_space.html#aac4582fa58547eaf2339efa4b39b656c">00769</a>   <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> <a class="code" href="classv8_1_1internal_1_1_space.html#aac4582fa58547eaf2339efa4b39b656c">executable</a>() { <span class="keywordflow">return</span> executable_; }
<a name="l00770"></a>00770 
<a name="l00771"></a>00771   <span class="comment">// Identity used in error reporting.</span>
<a name="l00772"></a><a class="code" href="classv8_1_1internal_1_1_space.html#a934a26e2755bc4f0d8060cfb3d051cdf">00772</a>   <a class="code" href="namespacev8_1_1internal.html#aa131d4fd9972fd8dfbec01a9243d9fef">AllocationSpace</a> <a class="code" href="classv8_1_1internal_1_1_space.html#a934a26e2755bc4f0d8060cfb3d051cdf">identity</a>() { <span class="keywordflow">return</span> id_; }
<a name="l00773"></a>00773 
<a name="l00774"></a>00774   <span class="comment">// Returns allocated size.</span>
<a name="l00775"></a>00775   <span class="keyword">virtual</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_space.html#a25fe1c34c782ee083846478f7e9191b1">Size</a>() = 0;
<a name="l00776"></a>00776 
<a name="l00777"></a>00777   <span class="comment">// Returns size of objects. Can differ from the allocated size</span>
<a name="l00778"></a>00778   <span class="comment">// (e.g. see LargeObjectSpace).</span>
<a name="l00779"></a><a class="code" href="classv8_1_1internal_1_1_space.html#a4aea0a53fc833a28da23de49fcff472d">00779</a>   <span class="keyword">virtual</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_space.html#a4aea0a53fc833a28da23de49fcff472d">SizeOfObjects</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_space.html#a25fe1c34c782ee083846478f7e9191b1">Size</a>(); }
<a name="l00780"></a>00780 
<a name="l00781"></a><a class="code" href="classv8_1_1internal_1_1_space.html#a34965d2c93d16a1fd062d17512193153">00781</a>   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_space.html#a34965d2c93d16a1fd062d17512193153">RoundSizeDownToObjectAlignment</a>(<span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>) {
<a name="l00782"></a>00782     <span class="keywordflow">if</span> (id_ == <a class="code" href="namespacev8_1_1internal.html#aa131d4fd9972fd8dfbec01a9243d9fefa7b3b52e8b8e6e29f82884e41bfe0f500">CODE_SPACE</a>) {
<a name="l00783"></a>00783       <span class="keywordflow">return</span> <a class="code" href="namespacev8_1_1internal.html#a62ab6b040688d278b36c6e932b7820a7">RoundDown</a>(size, <a class="code" href="namespacev8_1_1internal.html#a2d5cdc2af9c079d425f5d297bda088af">kCodeAlignment</a>);
<a name="l00784"></a>00784     } <span class="keywordflow">else</span> {
<a name="l00785"></a>00785       <span class="keywordflow">return</span> <a class="code" href="namespacev8_1_1internal.html#a62ab6b040688d278b36c6e932b7820a7">RoundDown</a>(size, <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a>);
<a name="l00786"></a>00786     }
<a name="l00787"></a>00787   }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00790"></a>00790 <span class="preprocessor"></span>  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="lineprocessor_8cc.html#ae894408d53a5dd2fec4c3e7ea09d5d4b">Print</a>() = 0;
<a name="l00791"></a>00791 <span class="preprocessor">#endif</span>
<a name="l00792"></a>00792 <span class="preprocessor"></span>
<a name="l00793"></a>00793   <span class="comment">// After calling this we can allocate a certain number of bytes using only</span>
<a name="l00794"></a>00794   <span class="comment">// linear allocation (with a LinearAllocationScope and an AlwaysAllocateScope)</span>
<a name="l00795"></a>00795   <span class="comment">// without using freelists or causing a GC.  This is used by partial</span>
<a name="l00796"></a>00796   <span class="comment">// snapshots.  It returns true of space was reserved or false if a GC is</span>
<a name="l00797"></a>00797   <span class="comment">// needed.  For paged spaces the space requested must include the space wasted</span>
<a name="l00798"></a>00798   <span class="comment">// at the end of each when allocating linearly.</span>
<a name="l00799"></a>00799   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_space.html#a842d1dcb6c1214eb856f80ff1dd2324e">ReserveSpace</a>(<span class="keywordtype">int</span> bytes) = 0;
<a name="l00800"></a>00800 
<a name="l00801"></a>00801  <span class="keyword">private</span>:
<a name="l00802"></a>00802   <a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* heap_;
<a name="l00803"></a>00803   <a class="code" href="namespacev8_1_1internal.html#aa131d4fd9972fd8dfbec01a9243d9fef">AllocationSpace</a> id_;
<a name="l00804"></a>00804   <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> executable_;
<a name="l00805"></a>00805 };
<a name="l00806"></a>00806 
<a name="l00807"></a>00807 
<a name="l00808"></a>00808 <span class="comment">// ----------------------------------------------------------------------------</span>
<a name="l00809"></a>00809 <span class="comment">// All heap objects containing executable code (code objects) must be allocated</span>
<a name="l00810"></a>00810 <span class="comment">// from a 2 GB range of memory, so that they can call each other using 32-bit</span>
<a name="l00811"></a>00811 <span class="comment">// displacements.  This happens automatically on 32-bit platforms, where 32-bit</span>
<a name="l00812"></a>00812 <span class="comment">// displacements cover the entire 4GB virtual address space.  On 64-bit</span>
<a name="l00813"></a>00813 <span class="comment">// platforms, we support this using the CodeRange object, which reserves and</span>
<a name="l00814"></a>00814 <span class="comment">// manages a range of virtual memory.</span>
<a name="l00815"></a><a class="code" href="classv8_1_1internal_1_1_code_range.html">00815</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_code_range.html">CodeRange</a> {
<a name="l00816"></a>00816  <span class="keyword">public</span>:
<a name="l00817"></a>00817   <span class="keyword">explicit</span> <a class="code" href="classv8_1_1internal_1_1_code_range.html#a2da59ac7ea807e47ff203a3ec0819f22">CodeRange</a>(<a class="code" href="classv8_1_1internal_1_1_isolate.html">Isolate</a>* isolate);
<a name="l00818"></a><a class="code" href="classv8_1_1internal_1_1_code_range.html#a0bc789b86f5f4b9bc5f4b66c146fbdb7">00818</a>   <a class="code" href="classv8_1_1internal_1_1_code_range.html#a0bc789b86f5f4b9bc5f4b66c146fbdb7">~CodeRange</a>() { <a class="code" href="classv8_1_1internal_1_1_code_range.html#a1c0a54e3aff48da76ebb4dea2b69ca37">TearDown</a>(); }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820   <span class="comment">// Reserves a range of virtual memory, but does not commit any of it.</span>
<a name="l00821"></a>00821   <span class="comment">// Can only be called once, at heap initialization time.</span>
<a name="l00822"></a>00822   <span class="comment">// Returns false on failure.</span>
<a name="l00823"></a>00823   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_code_range.html#ab52be200404e91d902984776849b845a">SetUp</a>(<span class="keyword">const</span> <span class="keywordtype">size_t</span> requested_size);
<a name="l00824"></a>00824 
<a name="l00825"></a>00825   <span class="comment">// Frees the range of virtual memory, and frees the data structures used to</span>
<a name="l00826"></a>00826   <span class="comment">// manage it.</span>
<a name="l00827"></a>00827   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_code_range.html#a1c0a54e3aff48da76ebb4dea2b69ca37">TearDown</a>();
<a name="l00828"></a>00828 
<a name="l00829"></a><a class="code" href="classv8_1_1internal_1_1_code_range.html#a4850a3fb7b1a97744507dadfb581e3c7">00829</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_code_range.html#a4850a3fb7b1a97744507dadfb581e3c7">exists</a>() { <span class="keywordflow">return</span> <span class="keyword">this</span> != <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a> &amp;&amp; code_range_ != <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>; }
<a name="l00830"></a><a class="code" href="classv8_1_1internal_1_1_code_range.html#a02dc5af7ad63aee79f0b772b255d7e09">00830</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_code_range.html#a02dc5af7ad63aee79f0b772b255d7e09">contains</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> address) {
<a name="l00831"></a>00831     <span class="keywordflow">if</span> (<span class="keyword">this</span> == <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a> || code_range_ == <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00832"></a>00832     <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a> = <span class="keyword">static_cast&lt;</span><a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a><span class="keyword">&gt;</span>(code_range_-&gt;<a class="code" href="classv8_1_1internal_1_1_virtual_memory.html#a363e8f118338b444ef75915747786fa9">address</a>());
<a name="l00833"></a>00833     <span class="keywordflow">return</span> start &lt;= address &amp;&amp; address &lt; start + code_range_-&gt;<a class="code" href="classv8_1_1internal_1_1_virtual_memory.html#adaca52bf2ef9a631dc18ca4079d5b4d0">size</a>();
<a name="l00834"></a>00834   }
<a name="l00835"></a>00835 
<a name="l00836"></a>00836   <span class="comment">// Allocates a chunk of memory from the large-object portion of</span>
<a name="l00837"></a>00837   <span class="comment">// the code range.  On platforms with no separate code range, should</span>
<a name="l00838"></a>00838   <span class="comment">// not be called.</span>
<a name="l00839"></a>00839   <a class="code" href="globals_8h.html#afefbce768b9d0df9c9ebc30dd6d13fed">MUST_USE_RESULT</a> <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_code_range.html#a798e2db9506b15e3883b661073e09995">AllocateRawMemory</a>(<span class="keyword">const</span> <span class="keywordtype">size_t</span> requested,
<a name="l00840"></a>00840                                             <span class="keywordtype">size_t</span>* allocated);
<a name="l00841"></a>00841   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_code_range.html#a1dbd30c12efca7e40cc0612e81515821">FreeRawMemory</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> buf, <span class="keywordtype">size_t</span> length);
<a name="l00842"></a>00842 
<a name="l00843"></a>00843  <span class="keyword">private</span>:
<a name="l00844"></a>00844   <a class="code" href="classv8_1_1internal_1_1_isolate.html">Isolate</a>* isolate_;
<a name="l00845"></a>00845 
<a name="l00846"></a>00846   <span class="comment">// The reserved range of virtual memory that all code objects are put in.</span>
<a name="l00847"></a>00847   <a class="code" href="classv8_1_1internal_1_1_virtual_memory.html">VirtualMemory</a>* code_range_;
<a name="l00848"></a>00848   <span class="comment">// Plain old data class, just a struct plus a constructor.</span>
<a name="l00849"></a>00849   <span class="keyword">class </span>FreeBlock {
<a name="l00850"></a>00850    <span class="keyword">public</span>:
<a name="l00851"></a>00851     FreeBlock(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> start_arg, <span class="keywordtype">size_t</span> size_arg)
<a name="l00852"></a>00852         : <a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>(start_arg), <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>(size_arg) {
<a name="l00853"></a>00853       <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(<a class="code" href="namespacev8_1_1internal.html#a0a13af70b3a41d097462e50ee0102fd7">IsAddressAligned</a>(<a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>, <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aeb9f7807568ebb3077c7d89921fcfee2">MemoryChunk::kAlignment</a>));
<a name="l00854"></a>00854       <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(<a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a> &gt;= static_cast&lt;size_t&gt;(<a class="code" href="classv8_1_1internal_1_1_page.html#a573b8add96a07f20176e2bab44f48c20">Page::kPageSize</a>));
<a name="l00855"></a>00855     }
<a name="l00856"></a>00856     FreeBlock(<span class="keywordtype">void</span>* start_arg, <span class="keywordtype">size_t</span> size_arg)
<a name="l00857"></a>00857         : <a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>(static_cast&lt;<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a>&gt;(start_arg)), <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>(size_arg) {
<a name="l00858"></a>00858       <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(<a class="code" href="namespacev8_1_1internal.html#a0a13af70b3a41d097462e50ee0102fd7">IsAddressAligned</a>(<a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>, <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aeb9f7807568ebb3077c7d89921fcfee2">MemoryChunk::kAlignment</a>));
<a name="l00859"></a>00859       <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(<a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a> &gt;= static_cast&lt;size_t&gt;(<a class="code" href="classv8_1_1internal_1_1_page.html#a573b8add96a07f20176e2bab44f48c20">Page::kPageSize</a>));
<a name="l00860"></a>00860     }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862     <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>;
<a name="l00863"></a>00863     <span class="keywordtype">size_t</span> <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>;
<a name="l00864"></a>00864   };
<a name="l00865"></a>00865 
<a name="l00866"></a>00866   <span class="comment">// Freed blocks of memory are added to the free list.  When the allocation</span>
<a name="l00867"></a>00867   <span class="comment">// list is exhausted, the free list is sorted and merged to make the new</span>
<a name="l00868"></a>00868   <span class="comment">// allocation list.</span>
<a name="l00869"></a>00869   List&lt;FreeBlock&gt; free_list_;
<a name="l00870"></a>00870   <span class="comment">// Memory is allocated from the free blocks on the allocation list.</span>
<a name="l00871"></a>00871   <span class="comment">// The block at current_allocation_block_index_ is the current block.</span>
<a name="l00872"></a>00872   List&lt;FreeBlock&gt; allocation_list_;
<a name="l00873"></a>00873   <span class="keywordtype">int</span> current_allocation_block_index_;
<a name="l00874"></a>00874 
<a name="l00875"></a>00875   <span class="comment">// Finds a block on the allocation list that contains at least the</span>
<a name="l00876"></a>00876   <span class="comment">// requested amount of memory.  If none is found, sorts and merges</span>
<a name="l00877"></a>00877   <span class="comment">// the existing free memory blocks, and searches again.</span>
<a name="l00878"></a>00878   <span class="comment">// If none can be found, terminates V8 with FatalProcessOutOfMemory.</span>
<a name="l00879"></a>00879   <span class="keywordtype">void</span> GetNextAllocationBlock(<span class="keywordtype">size_t</span> requested);
<a name="l00880"></a>00880   <span class="comment">// Compares the start addresses of two free blocks.</span>
<a name="l00881"></a>00881   <span class="keyword">static</span> <span class="keywordtype">int</span> CompareFreeBlockAddress(<span class="keyword">const</span> FreeBlock* left,
<a name="l00882"></a>00882                                      <span class="keyword">const</span> FreeBlock* right);
<a name="l00883"></a>00883 
<a name="l00884"></a>00884   DISALLOW_COPY_AND_ASSIGN(<a class="code" href="classv8_1_1internal_1_1_code_range.html#a2da59ac7ea807e47ff203a3ec0819f22">CodeRange</a>);
<a name="l00885"></a>00885 };
<a name="l00886"></a>00886 
<a name="l00887"></a>00887 
<a name="l00888"></a><a class="code" href="classv8_1_1internal_1_1_skip_list.html">00888</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_skip_list.html">SkipList</a> {
<a name="l00889"></a>00889  <span class="keyword">public</span>:
<a name="l00890"></a><a class="code" href="classv8_1_1internal_1_1_skip_list.html#af2232966bd0e4bd717e7720052acde35">00890</a>   <a class="code" href="classv8_1_1internal_1_1_skip_list.html#af2232966bd0e4bd717e7720052acde35">SkipList</a>() {
<a name="l00891"></a>00891     <a class="code" href="classv8_1_1internal_1_1_skip_list.html#aa7f250b2de572f5e46c9de704f0bf9e0">Clear</a>();
<a name="l00892"></a>00892   }
<a name="l00893"></a>00893 
<a name="l00894"></a><a class="code" href="classv8_1_1internal_1_1_skip_list.html#aa7f250b2de572f5e46c9de704f0bf9e0">00894</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_skip_list.html#aa7f250b2de572f5e46c9de704f0bf9e0">Clear</a>() {
<a name="l00895"></a>00895     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idx = 0; idx &lt; kSize; idx++) {
<a name="l00896"></a>00896       starts_[idx] = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a><span class="keyword">&gt;</span>(-1);
<a name="l00897"></a>00897     }
<a name="l00898"></a>00898   }
<a name="l00899"></a>00899 
<a name="l00900"></a><a class="code" href="classv8_1_1internal_1_1_skip_list.html#a0387ed9e1fea8f3c470fca611259dfe5">00900</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_skip_list.html#a0387ed9e1fea8f3c470fca611259dfe5">StartFor</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr) {
<a name="l00901"></a>00901     <span class="keywordflow">return</span> starts_[<a class="code" href="classv8_1_1internal_1_1_skip_list.html#aac6fce51cc7637ea622e4d47bff619fa">RegionNumber</a>(addr)];
<a name="l00902"></a>00902   }
<a name="l00903"></a>00903 
<a name="l00904"></a><a class="code" href="classv8_1_1internal_1_1_skip_list.html#a297e1c51c3d473727ae5748cf4b5536a">00904</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_skip_list.html#a297e1c51c3d473727ae5748cf4b5536a">AddObject</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr, <span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>) {
<a name="l00905"></a>00905     <span class="keywordtype">int</span> start_region = <a class="code" href="classv8_1_1internal_1_1_skip_list.html#aac6fce51cc7637ea622e4d47bff619fa">RegionNumber</a>(addr);
<a name="l00906"></a>00906     <span class="keywordtype">int</span> end_region = <a class="code" href="classv8_1_1internal_1_1_skip_list.html#aac6fce51cc7637ea622e4d47bff619fa">RegionNumber</a>(addr + size - <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a>);
<a name="l00907"></a>00907     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idx = start_region; idx &lt;= end_region; idx++) {
<a name="l00908"></a>00908       <span class="keywordflow">if</span> (starts_[idx] &gt; addr) starts_[idx] = addr;
<a name="l00909"></a>00909     }
<a name="l00910"></a>00910   }
<a name="l00911"></a>00911 
<a name="l00912"></a><a class="code" href="classv8_1_1internal_1_1_skip_list.html#aac6fce51cc7637ea622e4d47bff619fa">00912</a>   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_skip_list.html#aac6fce51cc7637ea622e4d47bff619fa">RegionNumber</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr) {
<a name="l00913"></a>00913     <span class="keywordflow">return</span> (<a class="code" href="namespacev8_1_1internal.html#aefd9bd49976aa2276ada1b562f1c6cbb">OffsetFrom</a>(addr) &amp; <a class="code" href="classv8_1_1internal_1_1_page.html#a856e4e5c2ed9278569185cc42b7a645f">Page::kPageAlignmentMask</a>) &gt;&gt; kRegionSizeLog2;
<a name="l00914"></a>00914   }
<a name="l00915"></a>00915 
<a name="l00916"></a><a class="code" href="classv8_1_1internal_1_1_skip_list.html#a3be6172846582899cd94eb989bbe0d06">00916</a>   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_skip_list.html#a3be6172846582899cd94eb989bbe0d06">Update</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr, <span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>) {
<a name="l00917"></a>00917     <a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* page = <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa085e1ca88c6b66f52e3f12dc4c89195">Page::FromAddress</a>(addr);
<a name="l00918"></a>00918     <a class="code" href="classv8_1_1internal_1_1_skip_list.html">SkipList</a>* list = page-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a07fa46d9e099b97dd2be1b9b35b9750a">skip_list</a>();
<a name="l00919"></a>00919     <span class="keywordflow">if</span> (list == <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>) {
<a name="l00920"></a>00920       list = <span class="keyword">new</span> <a class="code" href="classv8_1_1internal_1_1_skip_list.html#af2232966bd0e4bd717e7720052acde35">SkipList</a>();
<a name="l00921"></a>00921       page-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#abc9c19c1cc451e69db7ee628707b6047">set_skip_list</a>(list);
<a name="l00922"></a>00922     }
<a name="l00923"></a>00923 
<a name="l00924"></a>00924     list-&gt;<a class="code" href="classv8_1_1internal_1_1_skip_list.html#a297e1c51c3d473727ae5748cf4b5536a">AddObject</a>(addr, size);
<a name="l00925"></a>00925   }
<a name="l00926"></a>00926 
<a name="l00927"></a>00927  <span class="keyword">private</span>:
<a name="l00928"></a>00928   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kRegionSizeLog2 = 13;
<a name="l00929"></a>00929   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kRegionSize = 1 &lt;&lt; kRegionSizeLog2;
<a name="l00930"></a>00930   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kSize = <a class="code" href="classv8_1_1internal_1_1_page.html#a573b8add96a07f20176e2bab44f48c20">Page::kPageSize</a> / kRegionSize;
<a name="l00931"></a>00931 
<a name="l00932"></a>00932   STATIC_ASSERT(<a class="code" href="classv8_1_1internal_1_1_page.html#a573b8add96a07f20176e2bab44f48c20">Page::kPageSize</a> % kRegionSize == 0);
<a name="l00933"></a>00933 
<a name="l00934"></a>00934   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> starts_[kSize];
<a name="l00935"></a>00935 };
<a name="l00936"></a>00936 
<a name="l00937"></a>00937 
<a name="l00938"></a>00938 <span class="comment">// ----------------------------------------------------------------------------</span>
<a name="l00939"></a>00939 <span class="comment">// A space acquires chunks of memory from the operating system. The memory</span>
<a name="l00940"></a>00940 <span class="comment">// allocator allocated and deallocates pages for the paged heap spaces and large</span>
<a name="l00941"></a>00941 <span class="comment">// pages for large object space.</span>
<a name="l00942"></a>00942 <span class="comment">//</span>
<a name="l00943"></a>00943 <span class="comment">// Each space has to manage it&#39;s own pages.</span>
<a name="l00944"></a>00944 <span class="comment">//</span>
<a name="l00945"></a><a class="code" href="classv8_1_1internal_1_1_memory_allocator.html">00945</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_memory_allocator.html">MemoryAllocator</a> {
<a name="l00946"></a>00946  <span class="keyword">public</span>:
<a name="l00947"></a>00947   <span class="keyword">explicit</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#aac1c43eb76882f367bced94543164335">MemoryAllocator</a>(<a class="code" href="classv8_1_1internal_1_1_isolate.html">Isolate</a>* isolate);
<a name="l00948"></a>00948 
<a name="l00949"></a>00949   <span class="comment">// Initializes its internal bookkeeping structures.</span>
<a name="l00950"></a>00950   <span class="comment">// Max capacity of the total space and executable memory limit.</span>
<a name="l00951"></a>00951   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a524923b126e3a9a1accb6008ad6c85fc">SetUp</a>(intptr_t max_capacity, intptr_t capacity_executable);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a41d0347f476400e5b35fb9f40081471c">TearDown</a>();
<a name="l00954"></a>00954 
<a name="l00955"></a>00955   <a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#ae54c46ac74a9b1882887a0cd7af24d27">AllocatePage</a>(
<a name="l00956"></a>00956       intptr_t <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>, <a class="code" href="classv8_1_1internal_1_1_paged_space.html">PagedSpace</a>* owner, <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> executable);
<a name="l00957"></a>00957 
<a name="l00958"></a>00958   <a class="code" href="classv8_1_1internal_1_1_large_page.html">LargePage</a>* <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a0bb119611ab5de95c6d46a0549d91bba">AllocateLargePage</a>(
<a name="l00959"></a>00959       intptr_t object_size, <a class="code" href="classv8_1_1internal_1_1_space.html">Space</a>* owner, <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> executable);
<a name="l00960"></a>00960 
<a name="l00961"></a>00961   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a5ea4a200f5940fefc7728c2f6f5ee29e">Free</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* chunk);
<a name="l00962"></a>00962 
<a name="l00963"></a>00963   <span class="comment">// Returns the maximum available bytes of heaps.</span>
<a name="l00964"></a><a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a46c4c3bcc1674e7b1e8facb4e435998d">00964</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a46c4c3bcc1674e7b1e8facb4e435998d">Available</a>() { <span class="keywordflow">return</span> capacity_ &lt; size_ ? 0 : capacity_ - size_; }
<a name="l00965"></a>00965 
<a name="l00966"></a>00966   <span class="comment">// Returns allocated spaces in bytes.</span>
<a name="l00967"></a><a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a0e1e4827e1a7833c734af2d992c9b719">00967</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a0e1e4827e1a7833c734af2d992c9b719">Size</a>() { <span class="keywordflow">return</span> size_; }
<a name="l00968"></a>00968 
<a name="l00969"></a>00969   <span class="comment">// Returns the maximum available executable bytes of heaps.</span>
<a name="l00970"></a><a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#aa07c912f24a740e537533d67211233f3">00970</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#aa07c912f24a740e537533d67211233f3">AvailableExecutable</a>() {
<a name="l00971"></a>00971     <span class="keywordflow">if</span> (capacity_executable_ &lt; size_executable_) <span class="keywordflow">return</span> 0;
<a name="l00972"></a>00972     <span class="keywordflow">return</span> capacity_executable_ - size_executable_;
<a name="l00973"></a>00973   }
<a name="l00974"></a>00974 
<a name="l00975"></a>00975   <span class="comment">// Returns allocated executable spaces in bytes.</span>
<a name="l00976"></a><a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#ac1bd4519f35220f21ae1b299d95682b3">00976</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#ac1bd4519f35220f21ae1b299d95682b3">SizeExecutable</a>() { <span class="keywordflow">return</span> size_executable_; }
<a name="l00977"></a>00977 
<a name="l00978"></a>00978   <span class="comment">// Returns maximum available bytes that the old space can have.</span>
<a name="l00979"></a><a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#ae9a3874baee3a04e0d5a15fa48fb7a23">00979</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#ae9a3874baee3a04e0d5a15fa48fb7a23">MaxAvailable</a>() {
<a name="l00980"></a>00980     <span class="keywordflow">return</span> (<a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a46c4c3bcc1674e7b1e8facb4e435998d">Available</a>() / <a class="code" href="classv8_1_1internal_1_1_page.html#a573b8add96a07f20176e2bab44f48c20">Page::kPageSize</a>) * <a class="code" href="classv8_1_1internal_1_1_page.html#a5bd856341644303601c503ab751703c0">Page::kMaxNonCodeHeapObjectSize</a>;
<a name="l00981"></a>00981   }
<a name="l00982"></a>00982 
<a name="l00983"></a>00983 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00984"></a>00984 <span class="preprocessor"></span>  <span class="comment">// Reports statistic info of the space.</span>
<a name="l00985"></a>00985   <span class="keywordtype">void</span> ReportStatistics();
<a name="l00986"></a>00986 <span class="preprocessor">#endif</span>
<a name="l00987"></a>00987 <span class="preprocessor"></span>
<a name="l00988"></a>00988   <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#aa0ebc77d4f5e9d1d896b01bd0dff0c8a">AllocateChunk</a>(intptr_t body_size,
<a name="l00989"></a>00989                              <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> executable,
<a name="l00990"></a>00990                              <a class="code" href="classv8_1_1internal_1_1_space.html">Space</a>* space);
<a name="l00991"></a>00991 
<a name="l00992"></a>00992   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#afd6a13e3d5b8ca835eddae19c923b670">ReserveAlignedMemory</a>(<span class="keywordtype">size_t</span> requested,
<a name="l00993"></a>00993                                <span class="keywordtype">size_t</span> alignment,
<a name="l00994"></a>00994                                <a class="code" href="classv8_1_1internal_1_1_virtual_memory.html">VirtualMemory</a>* controller);
<a name="l00995"></a>00995   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a836622198881942bd4b30756f24abdde">AllocateAlignedMemory</a>(<span class="keywordtype">size_t</span> requested,
<a name="l00996"></a>00996                                 <span class="keywordtype">size_t</span> alignment,
<a name="l00997"></a>00997                                 <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> executable,
<a name="l00998"></a>00998                                 <a class="code" href="classv8_1_1internal_1_1_virtual_memory.html">VirtualMemory</a>* controller);
<a name="l00999"></a>00999 
<a name="l01000"></a>01000   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a42f155cfebf0d965678d9b9afdd39aec">FreeMemory</a>(<a class="code" href="classv8_1_1internal_1_1_virtual_memory.html">VirtualMemory</a>* reservation, <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> executable);
<a name="l01001"></a>01001   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a42f155cfebf0d965678d9b9afdd39aec">FreeMemory</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr, <span class="keywordtype">size_t</span> size, <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> executable);
<a name="l01002"></a>01002 
<a name="l01003"></a>01003   <span class="comment">// Commit a contiguous block of memory from the initial chunk.  Assumes that</span>
<a name="l01004"></a>01004   <span class="comment">// the address is not NULL, the size is greater than zero, and that the</span>
<a name="l01005"></a>01005   <span class="comment">// block is contained in the initial chunk.  Returns true if it succeeded</span>
<a name="l01006"></a>01006   <span class="comment">// and false otherwise.</span>
<a name="l01007"></a>01007   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#af61bfabd2135e51c98481350167da15d">CommitBlock</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>, <span class="keywordtype">size_t</span> size, <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> executable);
<a name="l01008"></a>01008 
<a name="l01009"></a>01009   <span class="comment">// Uncommit a contiguous block of memory [start..(start+size)[.</span>
<a name="l01010"></a>01010   <span class="comment">// start is not NULL, the size is greater than zero, and the</span>
<a name="l01011"></a>01011   <span class="comment">// block is contained in the initial chunk.  Returns true if it succeeded</span>
<a name="l01012"></a>01012   <span class="comment">// and false otherwise.</span>
<a name="l01013"></a>01013   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a29690b451bbe497371e041731a9d5057">UncommitBlock</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>, <span class="keywordtype">size_t</span> size);
<a name="l01014"></a>01014 
<a name="l01015"></a>01015   <span class="comment">// Zaps a contiguous block of memory [start..(start+size)[ thus</span>
<a name="l01016"></a>01016   <span class="comment">// filling it up with a recognizable non-NULL bit pattern.</span>
<a name="l01017"></a>01017   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a5eb45a18bdab6189ae18dc1df48d8005">ZapBlock</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>, <span class="keywordtype">size_t</span> size);
<a name="l01018"></a>01018 
<a name="l01019"></a>01019   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#ad432ef0063273e468da05b7f1c29d78b">PerformAllocationCallback</a>(<a class="code" href="namespacev8.html#ae7bc5b0bd1100e94d78de255daa8ebc3">ObjectSpace</a> space,
<a name="l01020"></a>01020                                  <a class="code" href="namespacev8.html#ae2b70dd2abba164d9ad9ffc9f757eca9">AllocationAction</a> <a class="code" href="namespacell__prof.html#ad0ab25e42792ba135795fbd242f53394">action</a>,
<a name="l01021"></a>01021                                  <span class="keywordtype">size_t</span> size);
<a name="l01022"></a>01022 
<a name="l01023"></a>01023   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#aefc9142ca4bdf32a06ef0eba318a656c">AddMemoryAllocationCallback</a>(<a class="code" href="namespacev8.html#a7b2f2578d863ff4239859053e6e29a41">MemoryAllocationCallback</a> callback,
<a name="l01024"></a>01024                                           <a class="code" href="namespacev8.html#ae7bc5b0bd1100e94d78de255daa8ebc3">ObjectSpace</a> space,
<a name="l01025"></a>01025                                           <a class="code" href="namespacev8.html#ae2b70dd2abba164d9ad9ffc9f757eca9">AllocationAction</a> <a class="code" href="namespacell__prof.html#ad0ab25e42792ba135795fbd242f53394">action</a>);
<a name="l01026"></a>01026 
<a name="l01027"></a>01027   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#adaec22ea2f91dbd2021093ab19305321">RemoveMemoryAllocationCallback</a>(
<a name="l01028"></a>01028       <a class="code" href="namespacev8.html#a7b2f2578d863ff4239859053e6e29a41">MemoryAllocationCallback</a> callback);
<a name="l01029"></a>01029 
<a name="l01030"></a>01030   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a1c2ad0f5d133bed2986f7ef40e60919a">MemoryAllocationCallbackRegistered</a>(
<a name="l01031"></a>01031       <a class="code" href="namespacev8.html#a7b2f2578d863ff4239859053e6e29a41">MemoryAllocationCallback</a> callback);
<a name="l01032"></a>01032 
<a name="l01033"></a>01033   <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#ad43cb45b7e648d7d94dd74569e7cdb14">CodePageGuardStartOffset</a>();
<a name="l01034"></a>01034 
<a name="l01035"></a>01035   <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a0590c1c4b4d8ee366b602d15e36836d8">CodePageGuardSize</a>();
<a name="l01036"></a>01036 
<a name="l01037"></a>01037   <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a6a6e23c9c65d7ca6d0d67b0928ca754b">CodePageAreaStartOffset</a>();
<a name="l01038"></a>01038 
<a name="l01039"></a>01039   <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a18785f4628e23735eff19578aecb7906">CodePageAreaEndOffset</a>();
<a name="l01040"></a>01040 
<a name="l01041"></a><a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a486888d82bb8401f97f88a192986bb4b">01041</a>   <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a486888d82bb8401f97f88a192986bb4b">CodePageAreaSize</a>() {
<a name="l01042"></a>01042     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a18785f4628e23735eff19578aecb7906">CodePageAreaEndOffset</a>() - <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a6a6e23c9c65d7ca6d0d67b0928ca754b">CodePageAreaStartOffset</a>();
<a name="l01043"></a>01043   }
<a name="l01044"></a>01044 
<a name="l01045"></a>01045   <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#a2b6e5f3f628aa512b1307840d4f7598c">CommitCodePage</a>(<a class="code" href="classv8_1_1internal_1_1_virtual_memory.html">VirtualMemory</a>* vm, <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>, <span class="keywordtype">size_t</span> size);
<a name="l01046"></a>01046 
<a name="l01047"></a>01047  <span class="keyword">private</span>:
<a name="l01048"></a>01048   <a class="code" href="classv8_1_1internal_1_1_isolate.html">Isolate</a>* isolate_;
<a name="l01049"></a>01049 
<a name="l01050"></a>01050   <span class="comment">// Maximum space size in bytes.</span>
<a name="l01051"></a>01051   <span class="keywordtype">size_t</span> capacity_;
<a name="l01052"></a>01052   <span class="comment">// Maximum subset of capacity_ that can be executable</span>
<a name="l01053"></a>01053   <span class="keywordtype">size_t</span> capacity_executable_;
<a name="l01054"></a>01054 
<a name="l01055"></a>01055   <span class="comment">// Allocated space size in bytes.</span>
<a name="l01056"></a>01056   <span class="keywordtype">size_t</span> size_;
<a name="l01057"></a>01057   <span class="comment">// Allocated executable space size in bytes.</span>
<a name="l01058"></a>01058   <span class="keywordtype">size_t</span> size_executable_;
<a name="l01059"></a>01059 
<a name="l01060"></a>01060   <span class="keyword">struct </span>MemoryAllocationCallbackRegistration {
<a name="l01061"></a>01061     MemoryAllocationCallbackRegistration(<a class="code" href="namespacev8.html#a7b2f2578d863ff4239859053e6e29a41">MemoryAllocationCallback</a> callback,
<a name="l01062"></a>01062                                          <a class="code" href="namespacev8.html#ae7bc5b0bd1100e94d78de255daa8ebc3">ObjectSpace</a> space,
<a name="l01063"></a>01063                                          <a class="code" href="namespacev8.html#ae2b70dd2abba164d9ad9ffc9f757eca9">AllocationAction</a> <a class="code" href="namespacell__prof.html#ad0ab25e42792ba135795fbd242f53394">action</a>)
<a name="l01064"></a>01064         : callback(callback), space(space), action(action) {
<a name="l01065"></a>01065     }
<a name="l01066"></a>01066     <a class="code" href="namespacev8.html#a7b2f2578d863ff4239859053e6e29a41">MemoryAllocationCallback</a> callback;
<a name="l01067"></a>01067     <a class="code" href="namespacev8.html#ae7bc5b0bd1100e94d78de255daa8ebc3">ObjectSpace</a> space;
<a name="l01068"></a>01068     <a class="code" href="namespacev8.html#ae2b70dd2abba164d9ad9ffc9f757eca9">AllocationAction</a> <a class="code" href="namespacell__prof.html#ad0ab25e42792ba135795fbd242f53394">action</a>;
<a name="l01069"></a>01069   };
<a name="l01070"></a>01070 
<a name="l01071"></a>01071   <span class="comment">// A List of callback that are triggered when memory is allocated or free&#39;d</span>
<a name="l01072"></a>01072   List&lt;MemoryAllocationCallbackRegistration&gt;
<a name="l01073"></a>01073       memory_allocation_callbacks_;
<a name="l01074"></a>01074 
<a name="l01075"></a>01075   <span class="comment">// Initializes pages in a chunk. Returns the first page address.</span>
<a name="l01076"></a>01076   <span class="comment">// This function and GetChunkId() are provided for the mark-compact</span>
<a name="l01077"></a>01077   <span class="comment">// collector to rebuild page headers in the from space, which is</span>
<a name="l01078"></a>01078   <span class="comment">// used as a marking stack and its page headers are destroyed.</span>
<a name="l01079"></a>01079   Page* InitializePagesInChunk(<span class="keywordtype">int</span> chunk_id, <span class="keywordtype">int</span> pages_in_chunk,
<a name="l01080"></a>01080                                PagedSpace* owner);
<a name="l01081"></a>01081 
<a name="l01082"></a>01082   DISALLOW_IMPLICIT_CONSTRUCTORS(<a class="code" href="classv8_1_1internal_1_1_memory_allocator.html#aac1c43eb76882f367bced94543164335">MemoryAllocator</a>);
<a name="l01083"></a>01083 };
<a name="l01084"></a>01084 
<a name="l01085"></a>01085 
<a name="l01086"></a>01086 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l01087"></a>01087 <span class="comment">// Interface for heap object iterator to be implemented by all object space</span>
<a name="l01088"></a>01088 <span class="comment">// object iterators.</span>
<a name="l01089"></a>01089 <span class="comment">//</span>
<a name="l01090"></a>01090 <span class="comment">// NOTE: The space specific object iterators also implements the own next()</span>
<a name="l01091"></a>01091 <span class="comment">//       method which is used to avoid using virtual functions</span>
<a name="l01092"></a>01092 <span class="comment">//       iterating a specific space.</span>
<a name="l01093"></a>01093 
<a name="l01094"></a><a class="code" href="classv8_1_1internal_1_1_object_iterator.html">01094</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_object_iterator.html">ObjectIterator</a> : <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_malloced.html">Malloced</a> {
<a name="l01095"></a>01095  <span class="keyword">public</span>:
<a name="l01096"></a><a class="code" href="classv8_1_1internal_1_1_object_iterator.html#aafc75c322bd8c2bcde0d2135e09238ea">01096</a>   <span class="keyword">virtual</span> <a class="code" href="classv8_1_1internal_1_1_object_iterator.html#aafc75c322bd8c2bcde0d2135e09238ea">~ObjectIterator</a>() { }
<a name="l01097"></a>01097 
<a name="l01098"></a>01098   <span class="keyword">virtual</span> <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <a class="code" href="classv8_1_1internal_1_1_object_iterator.html#ab988c2f88aa1170c77c04f647858c52e">next_object</a>() = 0;
<a name="l01099"></a>01099 };
<a name="l01100"></a>01100 
<a name="l01101"></a>01101 
<a name="l01102"></a>01102 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l01103"></a>01103 <span class="comment">// Heap object iterator in new/old/map spaces.</span>
<a name="l01104"></a>01104 <span class="comment">//</span>
<a name="l01105"></a>01105 <span class="comment">// A HeapObjectIterator iterates objects from the bottom of the given space</span>
<a name="l01106"></a>01106 <span class="comment">// to its top or from the bottom of the given page to its top.</span>
<a name="l01107"></a>01107 <span class="comment">//</span>
<a name="l01108"></a>01108 <span class="comment">// If objects are allocated in the page during iteration the iterator may</span>
<a name="l01109"></a>01109 <span class="comment">// or may not iterate over those objects.  The caller must create a new</span>
<a name="l01110"></a>01110 <span class="comment">// iterator in order to be sure to visit these new objects.</span>
<a name="l01111"></a><a class="code" href="classv8_1_1internal_1_1_heap_object_iterator.html">01111</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_heap_object_iterator.html">HeapObjectIterator</a>: <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_object_iterator.html">ObjectIterator</a> {
<a name="l01112"></a>01112  <span class="keyword">public</span>:
<a name="l01113"></a>01113   <span class="comment">// Creates a new object iterator in a given space.</span>
<a name="l01114"></a>01114   <span class="comment">// If the size function is not given, the iterator calls the default</span>
<a name="l01115"></a>01115   <span class="comment">// Object::Size().</span>
<a name="l01116"></a>01116   <span class="keyword">explicit</span> <a class="code" href="classv8_1_1internal_1_1_heap_object_iterator.html#acafe719dc17a39eeb032d27a928c81c1">HeapObjectIterator</a>(<a class="code" href="classv8_1_1internal_1_1_paged_space.html">PagedSpace</a>* space);
<a name="l01117"></a>01117   <a class="code" href="classv8_1_1internal_1_1_heap_object_iterator.html#acafe719dc17a39eeb032d27a928c81c1">HeapObjectIterator</a>(<a class="code" href="classv8_1_1internal_1_1_paged_space.html">PagedSpace</a>* space, <a class="code" href="namespacev8_1_1internal.html#a4664a14735f154f774c9130702904468">HeapObjectCallback</a> size_func);
<a name="l01118"></a>01118   <a class="code" href="classv8_1_1internal_1_1_heap_object_iterator.html#acafe719dc17a39eeb032d27a928c81c1">HeapObjectIterator</a>(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* page, <a class="code" href="namespacev8_1_1internal.html#a4664a14735f154f774c9130702904468">HeapObjectCallback</a> size_func);
<a name="l01119"></a>01119 
<a name="l01120"></a>01120   <span class="comment">// Advance to the next object, skipping free spaces and other fillers and</span>
<a name="l01121"></a>01121   <span class="comment">// skipping the special garbage section of which there is one per space.</span>
<a name="l01122"></a>01122   <span class="comment">// Returns NULL when the iteration has ended.</span>
<a name="l01123"></a><a class="code" href="classv8_1_1internal_1_1_heap_object_iterator.html#abed0cf57cb7dd01f381f0e699d94310a">01123</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <a class="code" href="classv8_1_1internal_1_1_heap_object_iterator.html#abed0cf57cb7dd01f381f0e699d94310a">Next</a>() {
<a name="l01124"></a>01124     <span class="keywordflow">do</span> {
<a name="l01125"></a>01125       <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* next_obj = FromCurrentPage();
<a name="l01126"></a>01126       <span class="keywordflow">if</span> (next_obj != <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>) <span class="keywordflow">return</span> next_obj;
<a name="l01127"></a>01127     } <span class="keywordflow">while</span> (AdvanceToNextPage());
<a name="l01128"></a>01128     <span class="keywordflow">return</span> <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>;
<a name="l01129"></a>01129   }
<a name="l01130"></a>01130 
<a name="l01131"></a><a class="code" href="classv8_1_1internal_1_1_heap_object_iterator.html#a710d3a7cee8e0246bbd37295c52c64f4">01131</a>   <span class="keyword">virtual</span> <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <a class="code" href="classv8_1_1internal_1_1_heap_object_iterator.html#a710d3a7cee8e0246bbd37295c52c64f4">next_object</a>() {
<a name="l01132"></a>01132     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_heap_object_iterator.html#abed0cf57cb7dd01f381f0e699d94310a">Next</a>();
<a name="l01133"></a>01133   }
<a name="l01134"></a>01134 
<a name="l01135"></a>01135  <span class="keyword">private</span>:
<a name="l01136"></a>01136   <span class="keyword">enum</span> PageMode { kOnePageOnly, kAllPagesInSpace };
<a name="l01137"></a>01137 
<a name="l01138"></a>01138   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> cur_addr_;  <span class="comment">// Current iteration point.</span>
<a name="l01139"></a>01139   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> cur_end_;   <span class="comment">// End iteration point.</span>
<a name="l01140"></a>01140   <a class="code" href="namespacev8_1_1internal.html#a4664a14735f154f774c9130702904468">HeapObjectCallback</a> size_func_;  <span class="comment">// Size function or NULL.</span>
<a name="l01141"></a>01141   PagedSpace* space_;
<a name="l01142"></a>01142   PageMode page_mode_;
<a name="l01143"></a>01143 
<a name="l01144"></a>01144   <span class="comment">// Fast (inlined) path of next().</span>
<a name="l01145"></a>01145   <span class="keyword">inline</span> HeapObject* FromCurrentPage();
<a name="l01146"></a>01146 
<a name="l01147"></a>01147   <span class="comment">// Slow path of next(), goes into the next page.  Returns false if the</span>
<a name="l01148"></a>01148   <span class="comment">// iteration has ended.</span>
<a name="l01149"></a>01149   <span class="keywordtype">bool</span> AdvanceToNextPage();
<a name="l01150"></a>01150 
<a name="l01151"></a>01151   <span class="comment">// Initializes fields.</span>
<a name="l01152"></a>01152   <span class="keyword">inline</span> <span class="keywordtype">void</span> Initialize(PagedSpace* owner,
<a name="l01153"></a>01153                          <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>,
<a name="l01154"></a>01154                          <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> end,
<a name="l01155"></a>01155                          PageMode mode,
<a name="l01156"></a>01156                          <a class="code" href="namespacev8_1_1internal.html#a4664a14735f154f774c9130702904468">HeapObjectCallback</a> size_func);
<a name="l01157"></a>01157 };
<a name="l01158"></a>01158 
<a name="l01159"></a>01159 
<a name="l01160"></a>01160 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l01161"></a>01161 <span class="comment">// A PageIterator iterates the pages in a paged space.</span>
<a name="l01162"></a>01162 
<a name="l01163"></a>01163 <span class="keyword">class </span>PageIterator <a class="code" href="allocation_8h.html#abab81306d90d0b82732d5bed93a0a588">BASE_EMBEDDED</a> {
<a name="l01164"></a>01164  <span class="keyword">public</span>:
<a name="l01165"></a>01165   <span class="keyword">explicit</span> <span class="keyword">inline</span> PageIterator(PagedSpace* space);
<a name="l01166"></a>01166 
<a name="l01167"></a>01167   <span class="keyword">inline</span> <span class="keywordtype">bool</span> has_next();
<a name="l01168"></a>01168   <span class="keyword">inline</span> Page* next();
<a name="l01169"></a>01169 
<a name="l01170"></a>01170  <span class="keyword">private</span>:
<a name="l01171"></a>01171   PagedSpace* space_;
<a name="l01172"></a>01172   Page* prev_page_;  <span class="comment">// Previous page returned.</span>
<a name="l01173"></a>01173   <span class="comment">// Next page that will be returned.  Cached here so that we can use this</span>
<a name="l01174"></a>01174   <span class="comment">// iterator for operations that deallocate pages.</span>
<a name="l01175"></a>01175   Page* next_page_;
<a name="l01176"></a>01176 };
<a name="l01177"></a>01177 
<a name="l01178"></a>01178 
<a name="l01179"></a>01179 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l01180"></a>01180 <span class="comment">// A space has a circular list of pages. The next page can be accessed via</span>
<a name="l01181"></a>01181 <span class="comment">// Page::next_page() call.</span>
<a name="l01182"></a>01182 
<a name="l01183"></a>01183 <span class="comment">// An abstraction of allocation and relocation pointers in a page-structured</span>
<a name="l01184"></a>01184 <span class="comment">// space.</span>
<a name="l01185"></a><a class="code" href="classv8_1_1internal_1_1_allocation_info.html">01185</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_allocation_info.html">AllocationInfo</a> {
<a name="l01186"></a>01186  <span class="keyword">public</span>:
<a name="l01187"></a><a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a7e99c7aecaf7b3387757b742914bb002">01187</a>   <a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a7e99c7aecaf7b3387757b742914bb002">AllocationInfo</a>() : <a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a891d3089101b9590fb5e10ba2815f364">top</a>(<a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>), <a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a58e65b9b6d456df7b1c74a0dfb6f5f6e">limit</a>(<a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>) {
<a name="l01188"></a>01188   }
<a name="l01189"></a>01189 
<a name="l01190"></a><a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a891d3089101b9590fb5e10ba2815f364">01190</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a891d3089101b9590fb5e10ba2815f364">top</a>;  <span class="comment">// Current allocation top.</span>
<a name="l01191"></a><a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a58e65b9b6d456df7b1c74a0dfb6f5f6e">01191</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a58e65b9b6d456df7b1c74a0dfb6f5f6e">limit</a>;  <span class="comment">// Current allocation limit.</span>
<a name="l01192"></a>01192 
<a name="l01193"></a>01193 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l01194"></a>01194 <span class="preprocessor"></span>  <span class="keywordtype">bool</span> VerifyPagedAllocation() {
<a name="l01195"></a>01195     <span class="keywordflow">return</span> (Page::FromAllocationTop(<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a891d3089101b9590fb5e10ba2815f364">top</a>) == Page::FromAllocationTop(<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a58e65b9b6d456df7b1c74a0dfb6f5f6e">limit</a>))
<a name="l01196"></a>01196         &amp;&amp; (<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a891d3089101b9590fb5e10ba2815f364">top</a> &lt;= <a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a58e65b9b6d456df7b1c74a0dfb6f5f6e">limit</a>);
<a name="l01197"></a>01197   }
<a name="l01198"></a>01198 <span class="preprocessor">#endif</span>
<a name="l01199"></a>01199 <span class="preprocessor"></span>};
<a name="l01200"></a>01200 
<a name="l01201"></a>01201 
<a name="l01202"></a>01202 <span class="comment">// An abstraction of the accounting statistics of a page-structured space.</span>
<a name="l01203"></a>01203 <span class="comment">// The &#39;capacity&#39; of a space is the number of object-area bytes (i.e., not</span>
<a name="l01204"></a>01204 <span class="comment">// including page bookkeeping structures) currently in the space. The &#39;size&#39;</span>
<a name="l01205"></a>01205 <span class="comment">// of a space is the number of allocated bytes, the &#39;waste&#39; in the space is</span>
<a name="l01206"></a>01206 <span class="comment">// the number of bytes that are not allocated and not available to</span>
<a name="l01207"></a>01207 <span class="comment">// allocation without reorganizing the space via a GC (e.g. small blocks due</span>
<a name="l01208"></a>01208 <span class="comment">// to internal fragmentation, top of page areas in map space), and the bytes</span>
<a name="l01209"></a>01209 <span class="comment">// &#39;available&#39; is the number of unallocated bytes that are not waste.  The</span>
<a name="l01210"></a>01210 <span class="comment">// capacity is the sum of size, waste, and available.</span>
<a name="l01211"></a>01211 <span class="comment">//</span>
<a name="l01212"></a>01212 <span class="comment">// The stats are only set by functions that ensure they stay balanced. These</span>
<a name="l01213"></a>01213 <span class="comment">// functions increase or decrease one of the non-capacity stats in</span>
<a name="l01214"></a>01214 <span class="comment">// conjunction with capacity, or else they always balance increases and</span>
<a name="l01215"></a>01215 <span class="comment">// decreases to the non-capacity stats.</span>
<a name="l01216"></a>01216 <span class="keyword">class </span>AllocationStats <a class="code" href="allocation_8h.html#abab81306d90d0b82732d5bed93a0a588">BASE_EMBEDDED</a> {
<a name="l01217"></a>01217  <span class="keyword">public</span>:
<a name="l01218"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#acab2129fa8035710e544ba845e3202e3">01218</a>   <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#acab2129fa8035710e544ba845e3202e3">AllocationStats</a>() { Clear(); }
<a name="l01219"></a>01219 
<a name="l01220"></a>01220   <span class="comment">// Zero out all the allocation statistics (i.e., no capacity).</span>
<a name="l01221"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#ac459434b795d52e3e98af829a58254ab">01221</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#ac459434b795d52e3e98af829a58254ab">Clear</a>() {
<a name="l01222"></a>01222     capacity_ = 0;
<a name="l01223"></a>01223     size_ = 0;
<a name="l01224"></a>01224     waste_ = 0;
<a name="l01225"></a>01225   }
<a name="l01226"></a>01226 
<a name="l01227"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#ae226509e7dc74c01d417ddf6659e3241">01227</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#ae226509e7dc74c01d417ddf6659e3241">ClearSizeWaste</a>() {
<a name="l01228"></a>01228     size_ = capacity_;
<a name="l01229"></a>01229     waste_ = 0;
<a name="l01230"></a>01230   }
<a name="l01231"></a>01231 
<a name="l01232"></a>01232   <span class="comment">// Reset the allocation statistics (i.e., available = capacity with no</span>
<a name="l01233"></a>01233   <span class="comment">// wasted or allocated bytes).</span>
<a name="l01234"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#aa6e0831165e93fd92107fd6b8f65d006">01234</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#aa6e0831165e93fd92107fd6b8f65d006">Reset</a>() {
<a name="l01235"></a>01235     size_ = 0;
<a name="l01236"></a>01236     waste_ = 0;
<a name="l01237"></a>01237   }
<a name="l01238"></a>01238 
<a name="l01239"></a>01239   <span class="comment">// Accessors for the allocation statistics.</span>
<a name="l01240"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a3b8590208e6018fe197932e582ff61ad">01240</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a3b8590208e6018fe197932e582ff61ad">Capacity</a>() { <span class="keywordflow">return</span> capacity_; }
<a name="l01241"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a5ab5f68ea1060d509191d6a4f117f5a9">01241</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a5ab5f68ea1060d509191d6a4f117f5a9">Size</a>() { <span class="keywordflow">return</span> size_; }
<a name="l01242"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a29d0e470e260f0ab0fc3e1ea205fdb35">01242</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a29d0e470e260f0ab0fc3e1ea205fdb35">Waste</a>() { <span class="keywordflow">return</span> waste_; }
<a name="l01243"></a>01243 
<a name="l01244"></a>01244   <span class="comment">// Grow the space by adding available bytes.  They are initially marked as</span>
<a name="l01245"></a>01245   <span class="comment">// being in use (part of the size), but will normally be immediately freed,</span>
<a name="l01246"></a>01246   <span class="comment">// putting them on the free list and removing them from size_.</span>
<a name="l01247"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a64ca78529882ba0aab77c0f5f257cd41">01247</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a64ca78529882ba0aab77c0f5f257cd41">ExpandSpace</a>(<span class="keywordtype">int</span> size_in_bytes) {
<a name="l01248"></a>01248     capacity_ += size_in_bytes;
<a name="l01249"></a>01249     size_ += size_in_bytes;
<a name="l01250"></a>01250     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(size_ &gt;= 0);
<a name="l01251"></a>01251   }
<a name="l01252"></a>01252 
<a name="l01253"></a>01253   <span class="comment">// Shrink the space by removing available bytes.  Since shrinking is done</span>
<a name="l01254"></a>01254   <span class="comment">// during sweeping, bytes have been marked as being in use (part of the size)</span>
<a name="l01255"></a>01255   <span class="comment">// and are hereby freed.</span>
<a name="l01256"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a7a9300f10d7f195bc8540536ae12cffb">01256</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a7a9300f10d7f195bc8540536ae12cffb">ShrinkSpace</a>(<span class="keywordtype">int</span> size_in_bytes) {
<a name="l01257"></a>01257     capacity_ -= size_in_bytes;
<a name="l01258"></a>01258     size_ -= size_in_bytes;
<a name="l01259"></a>01259     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(size_ &gt;= 0);
<a name="l01260"></a>01260   }
<a name="l01261"></a>01261 
<a name="l01262"></a>01262   <span class="comment">// Allocate from available bytes (available -&gt; size).</span>
<a name="l01263"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a42834ab5ebd36d36a709f9134534340b">01263</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a42834ab5ebd36d36a709f9134534340b">AllocateBytes</a>(intptr_t size_in_bytes) {
<a name="l01264"></a>01264     size_ += size_in_bytes;
<a name="l01265"></a>01265     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(size_ &gt;= 0);
<a name="l01266"></a>01266   }
<a name="l01267"></a>01267 
<a name="l01268"></a>01268   <span class="comment">// Free allocated bytes, making them available (size -&gt; available).</span>
<a name="l01269"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#adde3a8fb1b59057d89aed0f9f39bbadd">01269</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#adde3a8fb1b59057d89aed0f9f39bbadd">DeallocateBytes</a>(intptr_t size_in_bytes) {
<a name="l01270"></a>01270     size_ -= size_in_bytes;
<a name="l01271"></a>01271     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(size_ &gt;= 0);
<a name="l01272"></a>01272   }
<a name="l01273"></a>01273 
<a name="l01274"></a>01274   <span class="comment">// Waste free bytes (available -&gt; waste).</span>
<a name="l01275"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a51d9c5c33397ffbc9482f6299aed4c0c">01275</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a51d9c5c33397ffbc9482f6299aed4c0c">WasteBytes</a>(<span class="keywordtype">int</span> size_in_bytes) {
<a name="l01276"></a>01276     size_ -= size_in_bytes;
<a name="l01277"></a>01277     waste_ += size_in_bytes;
<a name="l01278"></a>01278     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(size_ &gt;= 0);
<a name="l01279"></a>01279   }
<a name="l01280"></a>01280 
<a name="l01281"></a>01281  <span class="keyword">private</span>:
<a name="l01282"></a>01282   intptr_t capacity_;
<a name="l01283"></a>01283   intptr_t size_;
<a name="l01284"></a>01284   intptr_t waste_;
<a name="l01285"></a>01285 };
<a name="l01286"></a>01286 
<a name="l01287"></a>01287 
<a name="l01288"></a>01288 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l01289"></a>01289 <span class="comment">// Free lists for old object spaces</span>
<a name="l01290"></a>01290 <span class="comment">//</span>
<a name="l01291"></a>01291 <span class="comment">// Free-list nodes are free blocks in the heap.  They look like heap objects</span>
<a name="l01292"></a>01292 <span class="comment">// (free-list node pointers have the heap object tag, and they have a map like</span>
<a name="l01293"></a>01293 <span class="comment">// a heap object).  They have a size and a next pointer.  The next pointer is</span>
<a name="l01294"></a>01294 <span class="comment">// the raw address of the next free list node (or NULL).</span>
<a name="l01295"></a><a class="code" href="classv8_1_1internal_1_1_free_list_node.html">01295</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>: <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a> {
<a name="l01296"></a>01296  <span class="keyword">public</span>:
<a name="l01297"></a>01297   <span class="comment">// Obtain a free-list node from a raw address.  This is not a cast because</span>
<a name="l01298"></a>01298   <span class="comment">// it does not check nor require that the first word at the address is a map</span>
<a name="l01299"></a>01299   <span class="comment">// pointer.</span>
<a name="l01300"></a><a class="code" href="classv8_1_1internal_1_1_free_list_node.html#a0a4e83c6d672cb777968f7c903e0de0f">01300</a>   <span class="keyword">static</span> <a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>* <a class="code" href="classv8_1_1internal_1_1_free_list_node.html#a0a4e83c6d672cb777968f7c903e0de0f">FromAddress</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_heap_object.html#a6969394bb5c9119fd1a23ec6bedda74d">address</a>) {
<a name="l01301"></a>01301     <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>*<span class="keyword">&gt;</span>(<a class="code" href="classv8_1_1internal_1_1_free_list_node.html#a0a4e83c6d672cb777968f7c903e0de0f">HeapObject::FromAddress</a>(address));
<a name="l01302"></a>01302   }
<a name="l01303"></a>01303 
<a name="l01304"></a>01304   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_free_list_node.html#a26d8232ca300d0225407ccd594973533">IsFreeListNode</a>(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <span class="keywordtype">object</span>);
<a name="l01305"></a>01305 
<a name="l01306"></a>01306   <span class="comment">// Set the size in bytes, which can be read with HeapObject::Size().  This</span>
<a name="l01307"></a>01307   <span class="comment">// function also writes a map to the first word of the block so that it</span>
<a name="l01308"></a>01308   <span class="comment">// looks like a heap object to the garbage collector and heap iteration</span>
<a name="l01309"></a>01309   <span class="comment">// functions.</span>
<a name="l01310"></a>01310   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_free_list_node.html#a4cd9f391e0ad277569cc0d5ce0b39180">set_size</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* heap, <span class="keywordtype">int</span> size_in_bytes);
<a name="l01311"></a>01311 
<a name="l01312"></a>01312   <span class="comment">// Accessors for the next field.</span>
<a name="l01313"></a>01313   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>* <a class="code" href="classv8_1_1internal_1_1_free_list_node.html#a9e6ddd33261e0885a6bf901c8ec9ae59">next</a>();
<a name="l01314"></a>01314   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>** <a class="code" href="classv8_1_1internal_1_1_free_list_node.html#aff3fb046b486e1703ce6c761129974fb">next_address</a>();
<a name="l01315"></a>01315   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_free_list_node.html#a1cfa2a7d1b7a19edc55ec16e2d2a0132">set_next</a>(<a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>* <a class="code" href="classv8_1_1internal_1_1_free_list_node.html#a9e6ddd33261e0885a6bf901c8ec9ae59">next</a>);
<a name="l01316"></a>01316 
<a name="l01317"></a>01317   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_free_list_node.html#aae794a9fd977c81e307551ec4cfd079c">Zap</a>();
<a name="l01318"></a>01318 
<a name="l01319"></a>01319  <span class="keyword">private</span>:
<a name="l01320"></a>01320   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kNextOffset = <a class="code" href="v8globals_8h.html#a94d672d4fa68c63cf5d7e3006fae440f">POINTER_SIZE_ALIGN</a>(<a class="code" href="classv8_1_1internal_1_1_free_space.html#aed2d0ffe285f32a2ec5bbc5d9821ba5e">FreeSpace::kHeaderSize</a>);
<a name="l01321"></a>01321 
<a name="l01322"></a>01322   DISALLOW_IMPLICIT_CONSTRUCTORS(<a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>);
<a name="l01323"></a>01323 };
<a name="l01324"></a>01324 
<a name="l01325"></a>01325 
<a name="l01326"></a>01326 <span class="comment">// The free list for the old space.  The free list is organized in such a way</span>
<a name="l01327"></a>01327 <span class="comment">// as to encourage objects allocated around the same time to be near each</span>
<a name="l01328"></a>01328 <span class="comment">// other.  The normal way to allocate is intended to be by bumping a &#39;top&#39;</span>
<a name="l01329"></a>01329 <span class="comment">// pointer until it hits a &#39;limit&#39; pointer.  When the limit is hit we need to</span>
<a name="l01330"></a>01330 <span class="comment">// find a new space to allocate from.  This is done with the free list, which</span>
<a name="l01331"></a>01331 <span class="comment">// is divided up into rough categories to cut down on waste.  Having finer</span>
<a name="l01332"></a>01332 <span class="comment">// categories would scatter allocation more.</span>
<a name="l01333"></a>01333 
<a name="l01334"></a>01334 <span class="comment">// The old space free list is organized in categories.</span>
<a name="l01335"></a>01335 <span class="comment">// 1-31 words:  Such small free areas are discarded for efficiency reasons.</span>
<a name="l01336"></a>01336 <span class="comment">//     They can be reclaimed by the compactor.  However the distance between top</span>
<a name="l01337"></a>01337 <span class="comment">//     and limit may be this small.</span>
<a name="l01338"></a>01338 <span class="comment">// 32-255 words: There is a list of spaces this large.  It is used for top and</span>
<a name="l01339"></a>01339 <span class="comment">//     limit when the object we need to allocate is 1-31 words in size.  These</span>
<a name="l01340"></a>01340 <span class="comment">//     spaces are called small.</span>
<a name="l01341"></a>01341 <span class="comment">// 256-2047 words: There is a list of spaces this large.  It is used for top and</span>
<a name="l01342"></a>01342 <span class="comment">//     limit when the object we need to allocate is 32-255 words in size.  These</span>
<a name="l01343"></a>01343 <span class="comment">//     spaces are called medium.</span>
<a name="l01344"></a>01344 <span class="comment">// 1048-16383 words: There is a list of spaces this large.  It is used for top</span>
<a name="l01345"></a>01345 <span class="comment">//     and limit when the object we need to allocate is 256-2047 words in size.</span>
<a name="l01346"></a>01346 <span class="comment">//     These spaces are call large.</span>
<a name="l01347"></a>01347 <span class="comment">// At least 16384 words.  This list is for objects of 2048 words or larger.</span>
<a name="l01348"></a>01348 <span class="comment">//     Empty pages are added to this list.  These spaces are called huge.</span>
<a name="l01349"></a>01349 <span class="keyword">class </span>FreeList <a class="code" href="allocation_8h.html#abab81306d90d0b82732d5bed93a0a588">BASE_EMBEDDED</a> {
<a name="l01350"></a>01350  <span class="keyword">public</span>:
<a name="l01351"></a>01351   <span class="keyword">explicit</span> FreeList(PagedSpace* owner);
<a name="l01352"></a>01352 
<a name="l01353"></a>01353   <span class="comment">// Clear the free list.</span>
<a name="l01354"></a>01354   <span class="keywordtype">void</span> <a class="code" href="namespacev8_1_1internal.html#aedbe4c9957c254b67bd760a57181a1b6">Reset</a>();
<a name="l01355"></a>01355 
<a name="l01356"></a>01356   <span class="comment">// Return the number of bytes available on the free list.</span>
<a name="l01357"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a33d85a70428df585811340ffd4549fe7">01357</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a33d85a70428df585811340ffd4549fe7">available</a>() { <span class="keywordflow">return</span> available_; }
<a name="l01358"></a>01358 
<a name="l01359"></a>01359   <span class="comment">// Place a node on the free list.  The block of size &#39;size_in_bytes&#39;</span>
<a name="l01360"></a>01360   <span class="comment">// starting at &#39;start&#39; is placed on the free list.  The return value is the</span>
<a name="l01361"></a>01361   <span class="comment">// number of bytes that have been lost due to internal fragmentation by</span>
<a name="l01362"></a>01362   <span class="comment">// freeing the block.  Bookkeeping information will be written to the block,</span>
<a name="l01363"></a>01363   <span class="comment">// i.e., its contents will be destroyed.  The start address should be word</span>
<a name="l01364"></a>01364   <span class="comment">// aligned, and the size should be a non-zero multiple of the word size.</span>
<a name="l01365"></a>01365   <span class="keywordtype">int</span> Free(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>, <span class="keywordtype">int</span> size_in_bytes);
<a name="l01366"></a>01366 
<a name="l01367"></a>01367   <span class="comment">// Allocate a block of size &#39;size_in_bytes&#39; from the free list.  The block</span>
<a name="l01368"></a>01368   <span class="comment">// is unitialized.  A failure is returned if no block is available.  The</span>
<a name="l01369"></a>01369   <span class="comment">// number of bytes lost to fragmentation is returned in the output parameter</span>
<a name="l01370"></a>01370   <span class="comment">// &#39;wasted_bytes&#39;.  The size should be a non-zero multiple of the word size.</span>
<a name="l01371"></a>01371   <a class="code" href="globals_8h.html#afefbce768b9d0df9c9ebc30dd6d13fed">MUST_USE_RESULT</a> <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* Allocate(<span class="keywordtype">int</span> size_in_bytes);
<a name="l01372"></a>01372 
<a name="l01373"></a>01373 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l01374"></a>01374 <span class="preprocessor"></span>  <span class="keywordtype">void</span> Zap();
<a name="l01375"></a>01375   <span class="keyword">static</span> intptr_t SumFreeList(<a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>* node);
<a name="l01376"></a>01376   <span class="keyword">static</span> <span class="keywordtype">int</span> FreeListLength(<a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>* cur);
<a name="l01377"></a>01377   intptr_t SumFreeLists();
<a name="l01378"></a>01378   <span class="keywordtype">bool</span> IsVeryLong();
<a name="l01379"></a>01379 <span class="preprocessor">#endif</span>
<a name="l01380"></a>01380 <span class="preprocessor"></span>
<a name="l01381"></a><a class="code" href="structv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d_1_1_size_stats.html">01381</a>   <span class="keyword">struct </span><a class="code" href="structv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d_1_1_size_stats.html">SizeStats</a> {
<a name="l01382"></a><a class="code" href="structv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d_1_1_size_stats.html#a20e4d657774e581e41dc87834f126b08">01382</a>     intptr_t <a class="code" href="structv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d_1_1_size_stats.html#a20e4d657774e581e41dc87834f126b08">Total</a>() {
<a name="l01383"></a>01383       <span class="keywordflow">return</span> small_size_ + medium_size_ + large_size_ + huge_size_;
<a name="l01384"></a>01384     }
<a name="l01385"></a>01385 
<a name="l01386"></a><a class="code" href="structv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d_1_1_size_stats.html#a6d004ed666541d0c2377f0464af1fb04">01386</a>     intptr_t <a class="code" href="structv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d_1_1_size_stats.html#a6d004ed666541d0c2377f0464af1fb04">small_size_</a>;
<a name="l01387"></a><a class="code" href="structv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d_1_1_size_stats.html#a92fc71db8e8ea0d78393d0c608bbec9b">01387</a>     intptr_t <a class="code" href="structv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d_1_1_size_stats.html#a92fc71db8e8ea0d78393d0c608bbec9b">medium_size_</a>;
<a name="l01388"></a><a class="code" href="structv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d_1_1_size_stats.html#a8654ff16da47be650cca9d418592a072">01388</a>     intptr_t <a class="code" href="structv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d_1_1_size_stats.html#a8654ff16da47be650cca9d418592a072">large_size_</a>;
<a name="l01389"></a><a class="code" href="structv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d_1_1_size_stats.html#a705045525723753e763536b5a8940e30">01389</a>     intptr_t <a class="code" href="structv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d_1_1_size_stats.html#a705045525723753e763536b5a8940e30">huge_size_</a>;
<a name="l01390"></a>01390   };
<a name="l01391"></a>01391 
<a name="l01392"></a>01392   <span class="keywordtype">void</span> CountFreeListItems(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* p, <a class="code" href="structv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d_1_1_size_stats.html">SizeStats</a>* sizes);
<a name="l01393"></a>01393 
<a name="l01394"></a>01394   intptr_t EvictFreeListItems(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* p);
<a name="l01395"></a>01395 
<a name="l01396"></a>01396  <span class="keyword">private</span>:
<a name="l01397"></a>01397   <span class="comment">// The size range of blocks, in bytes.</span>
<a name="l01398"></a>01398   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kMinBlockSize = 3 * <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a>;
<a name="l01399"></a>01399   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kMaxBlockSize = <a class="code" href="classv8_1_1internal_1_1_page.html#a5bd856341644303601c503ab751703c0">Page::kMaxNonCodeHeapObjectSize</a>;
<a name="l01400"></a>01400 
<a name="l01401"></a>01401   <a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>* PickNodeFromList(<a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>** list, <span class="keywordtype">int</span>* node_size);
<a name="l01402"></a>01402 
<a name="l01403"></a>01403   <a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>* FindNodeFor(<span class="keywordtype">int</span> size_in_bytes, <span class="keywordtype">int</span>* node_size);
<a name="l01404"></a>01404 
<a name="l01405"></a>01405   <a class="code" href="classv8_1_1internal_1_1_paged_space.html">PagedSpace</a>* owner_;
<a name="l01406"></a>01406   <a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* heap_;
<a name="l01407"></a>01407 
<a name="l01408"></a>01408   <span class="comment">// Total available bytes in all blocks on this free list.</span>
<a name="l01409"></a>01409   <span class="keywordtype">int</span> available_;
<a name="l01410"></a>01410 
<a name="l01411"></a>01411   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kSmallListMin = 0x20 * <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a>;
<a name="l01412"></a>01412   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kSmallListMax = 0xff * <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a>;
<a name="l01413"></a>01413   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kMediumListMax = 0x7ff * <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a>;
<a name="l01414"></a>01414   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kLargeListMax = 0x3fff * <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a>;
<a name="l01415"></a>01415   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kSmallAllocationMax = kSmallListMin - <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a>;
<a name="l01416"></a>01416   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kMediumAllocationMax = kSmallListMax;
<a name="l01417"></a>01417   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kLargeAllocationMax = kMediumListMax;
<a name="l01418"></a>01418   <a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>* small_list_;
<a name="l01419"></a>01419   <a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>* medium_list_;
<a name="l01420"></a>01420   <a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>* large_list_;
<a name="l01421"></a>01421   <a class="code" href="classv8_1_1internal_1_1_free_list_node.html">FreeListNode</a>* huge_list_;
<a name="l01422"></a>01422 
<a name="l01423"></a>01423   <a class="code" href="globals_8h.html#acfd97435e2829938f396946b00559b71">DISALLOW_IMPLICIT_CONSTRUCTORS</a>(FreeList);
<a name="l01424"></a>01424 };
<a name="l01425"></a>01425 
<a name="l01426"></a>01426 
<a name="l01427"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html">01427</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_paged_space.html">PagedSpace</a> : <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_space.html">Space</a> {
<a name="l01428"></a>01428  <span class="keyword">public</span>:
<a name="l01429"></a>01429   <span class="comment">// Creates a space with a maximum capacity, and an id.</span>
<a name="l01430"></a>01430   <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a8d6534e117585cdc70182e27e73c8619">PagedSpace</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_space.html#aa2434e21dfedab7d15316ce88f5ee1a2">heap</a>,
<a name="l01431"></a>01431              intptr_t max_capacity,
<a name="l01432"></a>01432              <a class="code" href="namespacev8_1_1internal.html#aa131d4fd9972fd8dfbec01a9243d9fef">AllocationSpace</a> <span class="keywordtype">id</span>,
<a name="l01433"></a>01433              <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> <a class="code" href="classv8_1_1internal_1_1_space.html#aac4582fa58547eaf2339efa4b39b656c">executable</a>);
<a name="l01434"></a>01434 
<a name="l01435"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a2a8ee46386e00cd8dcc407a5e9d59e81">01435</a>   <span class="keyword">virtual</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a2a8ee46386e00cd8dcc407a5e9d59e81">~PagedSpace</a>() {}
<a name="l01436"></a>01436 
<a name="l01437"></a>01437   <span class="comment">// Set up the space using the given address range of virtual memory (from</span>
<a name="l01438"></a>01438   <span class="comment">// the memory allocator&#39;s initial chunk) if possible.  If the block of</span>
<a name="l01439"></a>01439   <span class="comment">// addresses is not big enough to contain a single page-aligned page, a</span>
<a name="l01440"></a>01440   <span class="comment">// fresh chunk will be allocated.</span>
<a name="l01441"></a>01441   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#af8ba36c892e14fc7888d6d8945382e2a">SetUp</a>();
<a name="l01442"></a>01442 
<a name="l01443"></a>01443   <span class="comment">// Returns true if the space has been successfully set up and not</span>
<a name="l01444"></a>01444   <span class="comment">// subsequently torn down.</span>
<a name="l01445"></a>01445   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a92d5ccd0071a8d300f87347775bffe7b">HasBeenSetUp</a>();
<a name="l01446"></a>01446 
<a name="l01447"></a>01447   <span class="comment">// Cleans up the space, frees all pages in this space except those belonging</span>
<a name="l01448"></a>01448   <span class="comment">// to the initial chunk, uncommits addresses in the initial chunk.</span>
<a name="l01449"></a>01449   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#aff48f83009c4b8429f3e3263d2b3da32">TearDown</a>();
<a name="l01450"></a>01450 
<a name="l01451"></a>01451   <span class="comment">// Checks whether an object/address is in this space.</span>
<a name="l01452"></a>01452   <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a036e435d35992934e04555cafc9862f3">Contains</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> a);
<a name="l01453"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a9a0cc5292cb132c1fff35d5060c3f260">01453</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a9a0cc5292cb132c1fff35d5060c3f260">Contains</a>(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* o) { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a9a0cc5292cb132c1fff35d5060c3f260">Contains</a>(o-&gt;<a class="code" href="classv8_1_1internal_1_1_heap_object.html#a6969394bb5c9119fd1a23ec6bedda74d">address</a>()); }
<a name="l01454"></a>01454 
<a name="l01455"></a>01455   <span class="comment">// Given an address occupied by a live object, return that object if it is</span>
<a name="l01456"></a>01456   <span class="comment">// in this space, or Failure::Exception() if it is not. The implementation</span>
<a name="l01457"></a>01457   <span class="comment">// iterates over objects in the page containing the address, the cost is</span>
<a name="l01458"></a>01458   <span class="comment">// linear in the number of objects in the page. It may be slow.</span>
<a name="l01459"></a>01459   <a class="code" href="globals_8h.html#afefbce768b9d0df9c9ebc30dd6d13fed">MUST_USE_RESULT</a> MaybeObject* <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a350309a5c0e32b3a690bc57d3fccd3f4">FindObject</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr);
<a name="l01460"></a>01460 
<a name="l01461"></a>01461   <span class="comment">// Prepares for a mark-compact GC.</span>
<a name="l01462"></a>01462   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a89fdc3ca159cf2f174fe1d4750af1fd0">PrepareForMarkCompact</a>();
<a name="l01463"></a>01463 
<a name="l01464"></a>01464   <span class="comment">// Current capacity without growing (Size() + Available()).</span>
<a name="l01465"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a6dcbd9c05a216bb0bb79510a23f66574">01465</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a6dcbd9c05a216bb0bb79510a23f66574">Capacity</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a90f22415397f27568bfb7193630406d6">accounting_stats_</a>.Capacity(); }
<a name="l01466"></a>01466 
<a name="l01467"></a>01467   <span class="comment">// Total amount of memory committed for this space.  For paged</span>
<a name="l01468"></a>01468   <span class="comment">// spaces this equals the capacity.</span>
<a name="l01469"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a105223546814bda3f1fdc55cf9569838">01469</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a105223546814bda3f1fdc55cf9569838">CommittedMemory</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a6dcbd9c05a216bb0bb79510a23f66574">Capacity</a>(); }
<a name="l01470"></a>01470 
<a name="l01471"></a>01471   <span class="comment">// Sets the capacity, the available space and the wasted space to zero.</span>
<a name="l01472"></a>01472   <span class="comment">// The stats are rebuilt during sweeping by adding each page to the</span>
<a name="l01473"></a>01473   <span class="comment">// capacity and the size when it is encountered.  As free spaces are</span>
<a name="l01474"></a>01474   <span class="comment">// discovered during the sweeping they are subtracted from the size and added</span>
<a name="l01475"></a>01475   <span class="comment">// to the available and wasted totals.</span>
<a name="l01476"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#ab3bc3fb5a62e54da60ac8d6f84246287">01476</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#ab3bc3fb5a62e54da60ac8d6f84246287">ClearStats</a>() {
<a name="l01477"></a>01477     <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a90f22415397f27568bfb7193630406d6">accounting_stats_</a>.ClearSizeWaste();
<a name="l01478"></a>01478   }
<a name="l01479"></a>01479 
<a name="l01480"></a>01480   <span class="comment">// Available bytes without growing.  These are the bytes on the free list.</span>
<a name="l01481"></a>01481   <span class="comment">// The bytes in the linear allocation area are not included in this total</span>
<a name="l01482"></a>01482   <span class="comment">// because updating the stats would slow down allocation.  New pages are</span>
<a name="l01483"></a>01483   <span class="comment">// immediately added to the free list so they show up here.</span>
<a name="l01484"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a5f58c8a4d5f2c9e17eae5fadda3e4f29">01484</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a5f58c8a4d5f2c9e17eae5fadda3e4f29">Available</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a0112b5322bebbe0fe1ba4c3b896cfaae">free_list_</a>.available(); }
<a name="l01485"></a>01485 
<a name="l01486"></a>01486   <span class="comment">// Allocated bytes in this space.  Garbage bytes that were not found due to</span>
<a name="l01487"></a>01487   <span class="comment">// lazy sweeping are counted as being allocated!  The bytes in the current</span>
<a name="l01488"></a>01488   <span class="comment">// linear allocation area (between top and limit) are also counted here.</span>
<a name="l01489"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#ab9bacd221b3b0654e2f5d80babde196d">01489</a>   <span class="keyword">virtual</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_paged_space.html#ab9bacd221b3b0654e2f5d80babde196d">Size</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a90f22415397f27568bfb7193630406d6">accounting_stats_</a>.Size(); }
<a name="l01490"></a>01490 
<a name="l01491"></a>01491   <span class="comment">// As size, but the bytes in lazily swept pages are estimated and the bytes</span>
<a name="l01492"></a>01492   <span class="comment">// in the current linear allocation area are not included.</span>
<a name="l01493"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#ab685f64d0c90b17547e4f17d451535fb">01493</a>   <span class="keyword">virtual</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_paged_space.html#ab685f64d0c90b17547e4f17d451535fb">SizeOfObjects</a>() {
<a name="l01494"></a>01494     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(!<a class="code" href="classv8_1_1internal_1_1_paged_space.html#a7e2465ea2d61cf5d40d392344243578e">IsSweepingComplete</a>() || (<a class="code" href="classv8_1_1internal_1_1_paged_space.html#a652270c3570875ab3daae436491d7acc">unswept_free_bytes_</a> == 0));
<a name="l01495"></a>01495     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#ab9bacd221b3b0654e2f5d80babde196d">Size</a>() - <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a652270c3570875ab3daae436491d7acc">unswept_free_bytes_</a> - (<a class="code" href="classv8_1_1internal_1_1_paged_space.html#ad626e6ec83b755db5eb3910b2c755dd0">limit</a>() - <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a5c021b7494dc69658cb62083d89e59b8">top</a>());
<a name="l01496"></a>01496   }
<a name="l01497"></a>01497 
<a name="l01498"></a>01498   <span class="comment">// Wasted bytes in this space.  These are just the bytes that were thrown away</span>
<a name="l01499"></a>01499   <span class="comment">// due to being too small to use for allocation.  They do not include the</span>
<a name="l01500"></a>01500   <span class="comment">// free bytes that were not found at all due to lazy sweeping.</span>
<a name="l01501"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a7b24876985f2479d8ab104d6ceeadbbe">01501</a>   <span class="keyword">virtual</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a7b24876985f2479d8ab104d6ceeadbbe">Waste</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a90f22415397f27568bfb7193630406d6">accounting_stats_</a>.Waste(); }
<a name="l01502"></a>01502 
<a name="l01503"></a>01503   <span class="comment">// Returns the allocation pointer in this space.</span>
<a name="l01504"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a5c021b7494dc69658cb62083d89e59b8">01504</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a5c021b7494dc69658cb62083d89e59b8">top</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a3a17fbb27c54e885327b86e0dc3abab2">allocation_info_</a>.<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a891d3089101b9590fb5e10ba2815f364">top</a>; }
<a name="l01505"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#ad626e6ec83b755db5eb3910b2c755dd0">01505</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#ad626e6ec83b755db5eb3910b2c755dd0">limit</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a3a17fbb27c54e885327b86e0dc3abab2">allocation_info_</a>.<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a58e65b9b6d456df7b1c74a0dfb6f5f6e">limit</a>; }
<a name="l01506"></a>01506 
<a name="l01507"></a>01507   <span class="comment">// Allocate the requested number of bytes in the space if possible, return a</span>
<a name="l01508"></a>01508   <span class="comment">// failure object if not.</span>
<a name="l01509"></a>01509   <a class="code" href="globals_8h.html#afefbce768b9d0df9c9ebc30dd6d13fed">MUST_USE_RESULT</a> <span class="keyword">inline</span> MaybeObject* <a class="code" href="classv8_1_1internal_1_1_paged_space.html#adae8150c52937cf0c3045dceb3547bed">AllocateRaw</a>(<span class="keywordtype">int</span> size_in_bytes);
<a name="l01510"></a>01510 
<a name="l01511"></a>01511   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a97302444432bee0d8ce8326dec1e4382">ReserveSpace</a>(<span class="keywordtype">int</span> bytes);
<a name="l01512"></a>01512 
<a name="l01513"></a>01513   <span class="comment">// Give a block of memory to the space&#39;s free list.  It might be added to</span>
<a name="l01514"></a>01514   <span class="comment">// the free list or accounted as waste.</span>
<a name="l01515"></a>01515   <span class="comment">// If add_to_freelist is false then just accounting stats are updated and</span>
<a name="l01516"></a>01516   <span class="comment">// no attempt to add area to free list is made.</span>
<a name="l01517"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a5429d1ccf9df8d6ff945030c78e63618">01517</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a5429d1ccf9df8d6ff945030c78e63618">Free</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>, <span class="keywordtype">int</span> size_in_bytes) {
<a name="l01518"></a>01518     <span class="keywordtype">int</span> wasted = <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a0112b5322bebbe0fe1ba4c3b896cfaae">free_list_</a>.Free(start, size_in_bytes);
<a name="l01519"></a>01519     <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a90f22415397f27568bfb7193630406d6">accounting_stats_</a>.DeallocateBytes(size_in_bytes - wasted);
<a name="l01520"></a>01520     <span class="keywordflow">return</span> size_in_bytes - wasted;
<a name="l01521"></a>01521   }
<a name="l01522"></a>01522 
<a name="l01523"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a717b2939aec984ef6c6517c3195b0923">01523</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a717b2939aec984ef6c6517c3195b0923">ResetFreeList</a>() {
<a name="l01524"></a>01524     <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a0112b5322bebbe0fe1ba4c3b896cfaae">free_list_</a>.Reset();
<a name="l01525"></a>01525   }
<a name="l01526"></a>01526 
<a name="l01527"></a>01527   <span class="comment">// Set space allocation info.</span>
<a name="l01528"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a79cc83435637bf625bd871a0c213d970">01528</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a79cc83435637bf625bd871a0c213d970">SetTop</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a5c021b7494dc69658cb62083d89e59b8">top</a>, <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#ad626e6ec83b755db5eb3910b2c755dd0">limit</a>) {
<a name="l01529"></a>01529     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(top == limit ||
<a name="l01530"></a>01530            <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa085e1ca88c6b66f52e3f12dc4c89195">Page::FromAddress</a>(top) == <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa085e1ca88c6b66f52e3f12dc4c89195">Page::FromAddress</a>(limit - 1));
<a name="l01531"></a>01531     <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a3a17fbb27c54e885327b86e0dc3abab2">allocation_info_</a>.<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a891d3089101b9590fb5e10ba2815f364">top</a> = <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a5c021b7494dc69658cb62083d89e59b8">top</a>;
<a name="l01532"></a>01532     <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a3a17fbb27c54e885327b86e0dc3abab2">allocation_info_</a>.<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a58e65b9b6d456df7b1c74a0dfb6f5f6e">limit</a> = <a class="code" href="classv8_1_1internal_1_1_paged_space.html#ad626e6ec83b755db5eb3910b2c755dd0">limit</a>;
<a name="l01533"></a>01533   }
<a name="l01534"></a>01534 
<a name="l01535"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a64fdb7e87da1e0eed6f3f79c79a0c1cf">01535</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a64fdb7e87da1e0eed6f3f79c79a0c1cf">Allocate</a>(<span class="keywordtype">int</span> bytes) {
<a name="l01536"></a>01536     <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a90f22415397f27568bfb7193630406d6">accounting_stats_</a>.AllocateBytes(bytes);
<a name="l01537"></a>01537   }
<a name="l01538"></a>01538 
<a name="l01539"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#acbef3b415e3be1968f360554213886b4">01539</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#acbef3b415e3be1968f360554213886b4">IncreaseCapacity</a>(<span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>) {
<a name="l01540"></a>01540     <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a90f22415397f27568bfb7193630406d6">accounting_stats_</a>.ExpandSpace(size);
<a name="l01541"></a>01541   }
<a name="l01542"></a>01542 
<a name="l01543"></a>01543   <span class="comment">// Releases an unused page and shrinks the space.</span>
<a name="l01544"></a>01544   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#aa3530ad4022aca5a8e5417220d45f4a8">ReleasePage</a>(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* page);
<a name="l01545"></a>01545 
<a name="l01546"></a>01546   <span class="comment">// Releases all of the unused pages.</span>
<a name="l01547"></a>01547   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#aa6df0250ac4c1f44f924d7e4ed0e9a4f">ReleaseAllUnusedPages</a>();
<a name="l01548"></a>01548 
<a name="l01549"></a>01549   <span class="comment">// The dummy page that anchors the linked list of pages.</span>
<a name="l01550"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a66a4527d2121356cad29935ecfdcb6c9">01550</a>   <a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a66a4527d2121356cad29935ecfdcb6c9">anchor</a>() { <span class="keywordflow">return</span> &amp;<a class="code" href="classv8_1_1internal_1_1_paged_space.html#a140c1781815c4a43af8f0d553847a583">anchor_</a>; }
<a name="l01551"></a>01551 
<a name="l01552"></a>01552 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l01553"></a>01553 <span class="preprocessor"></span>  <span class="comment">// Print meta info and objects in this space.</span>
<a name="l01554"></a>01554   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="lineprocessor_8cc.html#ae894408d53a5dd2fec4c3e7ea09d5d4b">Print</a>();
<a name="l01555"></a>01555 
<a name="l01556"></a>01556   <span class="comment">// Verify integrity of this space.</span>
<a name="l01557"></a>01557   <span class="keyword">virtual</span> <span class="keywordtype">void</span> Verify(ObjectVisitor* visitor);
<a name="l01558"></a>01558 
<a name="l01559"></a>01559   <span class="comment">// Reports statistics for the space</span>
<a name="l01560"></a>01560   <span class="keywordtype">void</span> ReportStatistics();
<a name="l01561"></a>01561 
<a name="l01562"></a>01562   <span class="comment">// Overridden by subclasses to verify space-specific object</span>
<a name="l01563"></a>01563   <span class="comment">// properties (e.g., only maps or free-list nodes are in map space).</span>
<a name="l01564"></a>01564   <span class="keyword">virtual</span> <span class="keywordtype">void</span> VerifyObject(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* obj) {}
<a name="l01565"></a>01565 
<a name="l01566"></a>01566   <span class="comment">// Report code object related statistics</span>
<a name="l01567"></a>01567   <span class="keywordtype">void</span> CollectCodeStatistics();
<a name="l01568"></a>01568   <span class="keyword">static</span> <span class="keywordtype">void</span> ReportCodeStatistics();
<a name="l01569"></a>01569   <span class="keyword">static</span> <span class="keywordtype">void</span> ResetCodeStatistics();
<a name="l01570"></a>01570 <span class="preprocessor">#endif</span>
<a name="l01571"></a>01571 <span class="preprocessor"></span>
<a name="l01572"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a7b016766c77cfc3ace43e0a8ac554f12">01572</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a7b016766c77cfc3ace43e0a8ac554f12">was_swept_conservatively</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a9c72f0435c46b46c489c9ab20f887e2c">was_swept_conservatively_</a>; }
<a name="l01573"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a1b33480fd916cbdad99be1d304db7267">01573</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a1b33480fd916cbdad99be1d304db7267">set_was_swept_conservatively</a>(<span class="keywordtype">bool</span> b) { <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a9c72f0435c46b46c489c9ab20f887e2c">was_swept_conservatively_</a> = b; }
<a name="l01574"></a>01574 
<a name="l01575"></a>01575   <span class="comment">// Evacuation candidates are swept by evacuator.  Needs to return a valid</span>
<a name="l01576"></a>01576   <span class="comment">// result before _and_ after evacuation has finished.</span>
<a name="l01577"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a2dcfe916e1473c5b7197d156adf86a25">01577</a>   <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a2dcfe916e1473c5b7197d156adf86a25">ShouldBeSweptLazily</a>(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* p) {
<a name="l01578"></a>01578     <span class="keywordflow">return</span> !p-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa67b67fb53d38d2e88207679397c21ce">IsEvacuationCandidate</a>() &amp;&amp;
<a name="l01579"></a>01579            !p-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a01e5775f7047a3ff75f0c24afabb6e96">IsFlagSet</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a03d3c648f27f66bfc8c521871d04a443">Page::RESCAN_ON_EVACUATION</a>) &amp;&amp;
<a name="l01580"></a>01580            !p-&gt;<a class="code" href="classv8_1_1internal_1_1_page.html#a7a596a99d8ef42952634b7272d3dd4c7">WasSweptPrecisely</a>();
<a name="l01581"></a>01581   }
<a name="l01582"></a>01582 
<a name="l01583"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a0b6d5c53eeb48597a0dd6e5627c10b89">01583</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a0b6d5c53eeb48597a0dd6e5627c10b89">SetPagesToSweep</a>(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* first) {
<a name="l01584"></a>01584     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(<a class="code" href="classv8_1_1internal_1_1_paged_space.html#a652270c3570875ab3daae436491d7acc">unswept_free_bytes_</a> == 0);
<a name="l01585"></a>01585     <span class="keywordflow">if</span> (first == &amp;<a class="code" href="classv8_1_1internal_1_1_paged_space.html#a140c1781815c4a43af8f0d553847a583">anchor_</a>) first = <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>;
<a name="l01586"></a>01586     <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a21531e96db3595e1d40becaeea9d4ef4">first_unswept_page_</a> = first;
<a name="l01587"></a>01587   }
<a name="l01588"></a>01588 
<a name="l01589"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a220b7175778b27c087f05d9d2311e753">01589</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a220b7175778b27c087f05d9d2311e753">IncrementUnsweptFreeBytes</a>(<span class="keywordtype">int</span> by) {
<a name="l01590"></a>01590     <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a652270c3570875ab3daae436491d7acc">unswept_free_bytes_</a> += by;
<a name="l01591"></a>01591   }
<a name="l01592"></a>01592 
<a name="l01593"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a54e5033f0b77285378dec5e0e7db5080">01593</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a54e5033f0b77285378dec5e0e7db5080">IncreaseUnsweptFreeBytes</a>(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* p) {
<a name="l01594"></a>01594     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(<a class="code" href="classv8_1_1internal_1_1_paged_space.html#a2dcfe916e1473c5b7197d156adf86a25">ShouldBeSweptLazily</a>(p));
<a name="l01595"></a>01595     <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a652270c3570875ab3daae436491d7acc">unswept_free_bytes_</a> += (p-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ada395cf5efb11ccb21b0f084729f065c">area_size</a>() - p-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a1ee6cbf1d7466945aa5d8ae062ff602f">LiveBytes</a>());
<a name="l01596"></a>01596   }
<a name="l01597"></a>01597 
<a name="l01598"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#aaa86002e0fa4916095ac8f99f4ab7ed9">01598</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#aaa86002e0fa4916095ac8f99f4ab7ed9">DecreaseUnsweptFreeBytes</a>(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* p) {
<a name="l01599"></a>01599     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(<a class="code" href="classv8_1_1internal_1_1_paged_space.html#a2dcfe916e1473c5b7197d156adf86a25">ShouldBeSweptLazily</a>(p));
<a name="l01600"></a>01600     <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a652270c3570875ab3daae436491d7acc">unswept_free_bytes_</a> -= (p-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ada395cf5efb11ccb21b0f084729f065c">area_size</a>() - p-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a1ee6cbf1d7466945aa5d8ae062ff602f">LiveBytes</a>());
<a name="l01601"></a>01601   }
<a name="l01602"></a>01602 
<a name="l01603"></a>01603   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#acb1caad21d50dbf579a069675a2cf1ba">AdvanceSweeper</a>(intptr_t bytes_to_sweep);
<a name="l01604"></a>01604 
<a name="l01605"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a7e2465ea2d61cf5d40d392344243578e">01605</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a7e2465ea2d61cf5d40d392344243578e">IsSweepingComplete</a>() {
<a name="l01606"></a>01606     <span class="keywordflow">return</span> !<a class="code" href="classv8_1_1internal_1_1_paged_space.html#a21531e96db3595e1d40becaeea9d4ef4">first_unswept_page_</a>-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a72d7cd1ec809de2aefaa75087250c76e">is_valid</a>();
<a name="l01607"></a>01607   }
<a name="l01608"></a>01608 
<a name="l01609"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a4bb04dc4c0be6f0d8d98f47a3ea96ccf">01609</a>   <a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a4bb04dc4c0be6f0d8d98f47a3ea96ccf">FirstPage</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a140c1781815c4a43af8f0d553847a583">anchor_</a>.<a class="code" href="classv8_1_1internal_1_1_page.html#ab834d7fc9300a94f86057ab689f0ec54">next_page</a>(); }
<a name="l01610"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a1c5d5e6fbf1a256f7e639a29344d3454">01610</a>   <a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a1c5d5e6fbf1a256f7e639a29344d3454">LastPage</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a140c1781815c4a43af8f0d553847a583">anchor_</a>.<a class="code" href="classv8_1_1internal_1_1_page.html#aec84549fbe37407ce4f79a4e0ab3c581">prev_page</a>(); }
<a name="l01611"></a>01611 
<a name="l01612"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a82bedfa84de8d0c1192476e6fde401de">01612</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a82bedfa84de8d0c1192476e6fde401de">CountFreeListItems</a>(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* p, FreeList::SizeStats* sizes) {
<a name="l01613"></a>01613     <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a0112b5322bebbe0fe1ba4c3b896cfaae">free_list_</a>.CountFreeListItems(p, sizes);
<a name="l01614"></a>01614   }
<a name="l01615"></a>01615 
<a name="l01616"></a>01616   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#ac83c0819dbd6b2f04a2bd65a70a0fdf0">EvictEvacuationCandidatesFromFreeLists</a>();
<a name="l01617"></a>01617 
<a name="l01618"></a>01618   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a599bd226424b0d27dbbc3d8daa53f640">CanExpand</a>();
<a name="l01619"></a>01619 
<a name="l01620"></a>01620   <span class="comment">// Returns the number of total pages in this space.</span>
<a name="l01621"></a>01621   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a6af30463ab9b8ba5a9262105966141f1">CountTotalPages</a>();
<a name="l01622"></a>01622 
<a name="l01623"></a>01623   <span class="comment">// Return size of allocatable area on a page in this space.</span>
<a name="l01624"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a016c01ceec1db5de9d488307d4ffad9f">01624</a>   <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a016c01ceec1db5de9d488307d4ffad9f">AreaSize</a>() {
<a name="l01625"></a>01625     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a1cea029bf48abb4b4009e53d6fd48241">area_size_</a>;
<a name="l01626"></a>01626   }
<a name="l01627"></a>01627 
<a name="l01628"></a>01628  <span class="keyword">protected</span>:
<a name="l01629"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a1cea029bf48abb4b4009e53d6fd48241">01629</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a1cea029bf48abb4b4009e53d6fd48241">area_size_</a>;
<a name="l01630"></a>01630 
<a name="l01631"></a>01631   <span class="comment">// Maximum capacity of this space.</span>
<a name="l01632"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a98f5e213c948e6e79bec397f805054af">01632</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a98f5e213c948e6e79bec397f805054af">max_capacity_</a>;
<a name="l01633"></a>01633 
<a name="l01634"></a>01634   intptr_t <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a73f76ae2d08de80d806c5b33fc5f89cf">SizeOfFirstPage</a>();
<a name="l01635"></a>01635 
<a name="l01636"></a>01636   <span class="comment">// Accounting information for this space.</span>
<a name="l01637"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a90f22415397f27568bfb7193630406d6">01637</a>   AllocationStats <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a90f22415397f27568bfb7193630406d6">accounting_stats_</a>;
<a name="l01638"></a>01638 
<a name="l01639"></a>01639   <span class="comment">// The dummy page that anchors the double linked list of pages.</span>
<a name="l01640"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a140c1781815c4a43af8f0d553847a583">01640</a>   <a class="code" href="classv8_1_1internal_1_1_page.html">Page</a> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a140c1781815c4a43af8f0d553847a583">anchor_</a>;
<a name="l01641"></a>01641 
<a name="l01642"></a>01642   <span class="comment">// The space&#39;s free list.</span>
<a name="l01643"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a0112b5322bebbe0fe1ba4c3b896cfaae">01643</a>   FreeList <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a0112b5322bebbe0fe1ba4c3b896cfaae">free_list_</a>;
<a name="l01644"></a>01644 
<a name="l01645"></a>01645   <span class="comment">// Normal allocation information.</span>
<a name="l01646"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a3a17fbb27c54e885327b86e0dc3abab2">01646</a>   <a class="code" href="classv8_1_1internal_1_1_allocation_info.html">AllocationInfo</a> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a3a17fbb27c54e885327b86e0dc3abab2">allocation_info_</a>;
<a name="l01647"></a>01647 
<a name="l01648"></a>01648   <span class="comment">// Bytes of each page that cannot be allocated.  Possibly non-zero</span>
<a name="l01649"></a>01649   <span class="comment">// for pages in spaces with only fixed-size objects.  Always zero</span>
<a name="l01650"></a>01650   <span class="comment">// for pages in spaces with variable sized objects (those pages are</span>
<a name="l01651"></a>01651   <span class="comment">// padded with free-list nodes).</span>
<a name="l01652"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a5988fece15a37f5fde12ed39d2ecda0a">01652</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a5988fece15a37f5fde12ed39d2ecda0a">page_extra_</a>;
<a name="l01653"></a>01653 
<a name="l01654"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a9c72f0435c46b46c489c9ab20f887e2c">01654</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a9c72f0435c46b46c489c9ab20f887e2c">was_swept_conservatively_</a>;
<a name="l01655"></a>01655 
<a name="l01656"></a>01656   <span class="comment">// The first page to be swept when the lazy sweeper advances. Is set</span>
<a name="l01657"></a>01657   <span class="comment">// to NULL when all pages have been swept.</span>
<a name="l01658"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a21531e96db3595e1d40becaeea9d4ef4">01658</a>   <a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a21531e96db3595e1d40becaeea9d4ef4">first_unswept_page_</a>;
<a name="l01659"></a>01659 
<a name="l01660"></a>01660   <span class="comment">// The number of free bytes which could be reclaimed by advancing the</span>
<a name="l01661"></a>01661   <span class="comment">// lazy sweeper.  This is only an estimation because lazy sweeping is</span>
<a name="l01662"></a>01662   <span class="comment">// done conservatively.</span>
<a name="l01663"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#a652270c3570875ab3daae436491d7acc">01663</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a652270c3570875ab3daae436491d7acc">unswept_free_bytes_</a>;
<a name="l01664"></a>01664 
<a name="l01665"></a>01665   <span class="comment">// Expands the space by allocating a fixed number of pages. Returns false if</span>
<a name="l01666"></a>01666   <span class="comment">// it cannot allocate requested number of pages from OS, or if the hard heap</span>
<a name="l01667"></a>01667   <span class="comment">// size limit has been hit.</span>
<a name="l01668"></a>01668   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a72b12619f3f5da63cf74e17043a9a294">Expand</a>();
<a name="l01669"></a>01669 
<a name="l01670"></a>01670   <span class="comment">// Generic fast case allocation function that tries linear allocation at the</span>
<a name="l01671"></a>01671   <span class="comment">// address denoted by top in allocation_info_.</span>
<a name="l01672"></a>01672   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a4f721427d9246676c4d3223df775c815">AllocateLinearly</a>(<span class="keywordtype">int</span> size_in_bytes);
<a name="l01673"></a>01673 
<a name="l01674"></a>01674   <span class="comment">// Slow path of AllocateRaw.  This function is space-dependent.</span>
<a name="l01675"></a>01675   <a class="code" href="globals_8h.html#afefbce768b9d0df9c9ebc30dd6d13fed">MUST_USE_RESULT</a> <span class="keyword">virtual</span> <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <a class="code" href="classv8_1_1internal_1_1_paged_space.html#ab58832c0ced766184b9b8bd414ef2391">SlowAllocateRaw</a>(<span class="keywordtype">int</span> size_in_bytes);
<a name="l01676"></a>01676 
<a name="l01677"></a><a class="code" href="classv8_1_1internal_1_1_paged_space.html#ae93be65f49fbfeb5716a90719b8c4cb7">01677</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_paged_space.html#ae93be65f49fbfeb5716a90719b8c4cb7">PageIterator</a>;
<a name="l01678"></a>01678 };
<a name="l01679"></a>01679 
<a name="l01680"></a>01680 
<a name="l01681"></a>01681 <span class="keyword">class </span>NumberAndSizeInfo <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html">BASE_EMBEDDED</a> {
<a name="l01682"></a>01682  <span class="keyword">public</span>:
<a name="l01683"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a9902af66e18061e5c397ad269a8f49d2">01683</a>   <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a9902af66e18061e5c397ad269a8f49d2">NumberAndSizeInfo</a>() : number_(0), bytes_(0) {}
<a name="l01684"></a>01684 
<a name="l01685"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a10a20cd135256d759c98593b5afe3a0f">01685</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a10a20cd135256d759c98593b5afe3a0f">number</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> number_; }
<a name="l01686"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a03ce2c7b6e2fde02f3f08051aa4cbbb5">01686</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a03ce2c7b6e2fde02f3f08051aa4cbbb5">increment_number</a>(<span class="keywordtype">int</span> num) { number_ += num; }
<a name="l01687"></a>01687 
<a name="l01688"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a9c341a112a6b0ab3b7b8efd37a19c78a">01688</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a9c341a112a6b0ab3b7b8efd37a19c78a">bytes</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> bytes_; }
<a name="l01689"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a85334c11690ec234f5fba22f10418842">01689</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#a85334c11690ec234f5fba22f10418842">increment_bytes</a>(<span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>) { bytes_ += <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>; }
<a name="l01690"></a>01690 
<a name="l01691"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#ab7c3d08974b002ffe9f7546c4b1641cf">01691</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#ab7c3d08974b002ffe9f7546c4b1641cf">clear</a>() {
<a name="l01692"></a>01692     number_ = 0;
<a name="l01693"></a>01693     bytes_ = 0;
<a name="l01694"></a>01694   }
<a name="l01695"></a>01695 
<a name="l01696"></a>01696  <span class="keyword">private</span>:
<a name="l01697"></a>01697   <span class="keywordtype">int</span> number_;
<a name="l01698"></a>01698   <span class="keywordtype">int</span> bytes_;
<a name="l01699"></a>01699 };
<a name="l01700"></a>01700 
<a name="l01701"></a>01701 
<a name="l01702"></a>01702 <span class="comment">// HistogramInfo class for recording a single &quot;bar&quot; of a histogram.  This</span>
<a name="l01703"></a>01703 <span class="comment">// class is used for collecting statistics to print to the log file.</span>
<a name="l01704"></a><a class="code" href="classv8_1_1internal_1_1_histogram_info.html">01704</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_histogram_info.html">HistogramInfo</a>: <span class="keyword">public</span> NumberAndSizeInfo {
<a name="l01705"></a>01705  <span class="keyword">public</span>:
<a name="l01706"></a><a class="code" href="classv8_1_1internal_1_1_histogram_info.html#ab3ffc59f096c33751ba1d4a5246534ef">01706</a>   <a class="code" href="classv8_1_1internal_1_1_histogram_info.html#ab3ffc59f096c33751ba1d4a5246534ef">HistogramInfo</a>() : NumberAndSizeInfo() {}
<a name="l01707"></a>01707 
<a name="l01708"></a><a class="code" href="classv8_1_1internal_1_1_histogram_info.html#a7a5eb0872cf6a15ba64c355ee47dda9c">01708</a>   <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classv8_1_1internal_1_1_histogram_info.html#a7a5eb0872cf6a15ba64c355ee47dda9c">name</a>() { <span class="keywordflow">return</span> name_; }
<a name="l01709"></a><a class="code" href="classv8_1_1internal_1_1_histogram_info.html#ae4ea0ecca4937a690df5e34516f0b792">01709</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_histogram_info.html#ae4ea0ecca4937a690df5e34516f0b792">set_name</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classv8_1_1internal_1_1_histogram_info.html#a7a5eb0872cf6a15ba64c355ee47dda9c">name</a>) { name_ = <a class="code" href="classv8_1_1internal_1_1_histogram_info.html#a7a5eb0872cf6a15ba64c355ee47dda9c">name</a>; }
<a name="l01710"></a>01710 
<a name="l01711"></a>01711  <span class="keyword">private</span>:
<a name="l01712"></a>01712   <span class="keyword">const</span> <span class="keywordtype">char</span>* name_;
<a name="l01713"></a>01713 };
<a name="l01714"></a>01714 
<a name="l01715"></a>01715 
<a name="l01716"></a><a class="code" href="namespacev8_1_1internal.html#acd4c5ebd3b3afd81113ff7606f326799">01716</a> <span class="keyword">enum</span> <a class="code" href="namespacev8_1_1internal.html#acd4c5ebd3b3afd81113ff7606f326799">SemiSpaceId</a> {
<a name="l01717"></a><a class="code" href="namespacev8_1_1internal.html#acd4c5ebd3b3afd81113ff7606f326799a444195281c8d73ffce5c1c83b96c06cb">01717</a>   <a class="code" href="namespacev8_1_1internal.html#acd4c5ebd3b3afd81113ff7606f326799a444195281c8d73ffce5c1c83b96c06cb">kFromSpace</a> = 0,
<a name="l01718"></a><a class="code" href="namespacev8_1_1internal.html#acd4c5ebd3b3afd81113ff7606f326799a2c95de4ad1431e825dcf878bfa81676f">01718</a>   <a class="code" href="namespacev8_1_1internal.html#acd4c5ebd3b3afd81113ff7606f326799a2c95de4ad1431e825dcf878bfa81676f">kToSpace</a> = 1
<a name="l01719"></a>01719 };
<a name="l01720"></a>01720 
<a name="l01721"></a>01721 
<a name="l01722"></a>01722 <span class="keyword">class </span>SemiSpace;
<a name="l01723"></a>01723 
<a name="l01724"></a>01724 
<a name="l01725"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html">01725</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a> : <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a> {
<a name="l01726"></a>01726  <span class="keyword">public</span>:
<a name="l01727"></a>01727   <span class="comment">// GC related flags copied from from-space to to-space when</span>
<a name="l01728"></a>01728   <span class="comment">// flipping semispaces.</span>
<a name="l01729"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html#aa6e4a74b4f0239c474d8df8513dfc31a">01729</a>   <span class="keyword">static</span> <span class="keyword">const</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#aa6e4a74b4f0239c474d8df8513dfc31a">kCopyOnFlipFlagsMask</a> =
<a name="l01730"></a>01730     (1 &lt;&lt; <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78af2b142e3c0d80b4f4b2cb082a3b06988">MemoryChunk::POINTERS_TO_HERE_ARE_INTERESTING</a>) |
<a name="l01731"></a>01731     (1 &lt;&lt; <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a17af3b9a7543d3eb8051801107209d64">MemoryChunk::POINTERS_FROM_HERE_ARE_INTERESTING</a>) |
<a name="l01732"></a>01732     (1 &lt;&lt; <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78ae6c7b8ad5f683947a839841f6daa569b">MemoryChunk::SCAN_ON_SCAVENGE</a>);
<a name="l01733"></a>01733 
<a name="l01734"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a755d0554182e7ff72af75e0b7665e899">01734</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a755d0554182e7ff72af75e0b7665e899">kAreaSize</a> = <a class="code" href="classv8_1_1internal_1_1_page.html#a8a6f72dc41510de01d1f0972b75451d0">Page::kNonCodeObjectAreaSize</a>;
<a name="l01735"></a>01735 
<a name="l01736"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a4537a7df808443b67dd5cbf24db69565">01736</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>* <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a4537a7df808443b67dd5cbf24db69565">next_page</a>()<span class="keyword"> const </span>{
<a name="l01737"></a>01737     <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>*<span class="keyword">&gt;</span>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a487f8c05109d4b1d31c788f7327c0ca8">next_chunk</a>());
<a name="l01738"></a>01738   }
<a name="l01739"></a>01739 
<a name="l01740"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html#aa9c2b7f5748845342a90619f37db94c4">01740</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#aa9c2b7f5748845342a90619f37db94c4">set_next_page</a>(<a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>* page) {
<a name="l01741"></a>01741     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a33680f5d5cd36e8094c38e0ff43ffe82">set_next_chunk</a>(page);
<a name="l01742"></a>01742   }
<a name="l01743"></a>01743 
<a name="l01744"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html#ac97a49a13d7c0aba5c4372f5b9fa7403">01744</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>* <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#ac97a49a13d7c0aba5c4372f5b9fa7403">prev_page</a>()<span class="keyword"> const </span>{
<a name="l01745"></a>01745     <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>*<span class="keyword">&gt;</span>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ae356e1e0334211a3d760ab67535a0a82">prev_chunk</a>());
<a name="l01746"></a>01746   }
<a name="l01747"></a>01747 
<a name="l01748"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a42e5cc3b0e73acd87a6a5a7180d097b3">01748</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a42e5cc3b0e73acd87a6a5a7180d097b3">set_prev_page</a>(<a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>* page) {
<a name="l01749"></a>01749     <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a76397898a99e742c97e27cfe0d254407">set_prev_chunk</a>(page);
<a name="l01750"></a>01750   }
<a name="l01751"></a>01751 
<a name="l01752"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a276b0e129f4e4cdb7c4f56c3a60f6696">01752</a>   <a class="code" href="classv8_1_1internal_1_1_semi_space.html">SemiSpace</a>* <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a276b0e129f4e4cdb7c4f56c3a60f6696">semi_space</a>() {
<a name="l01753"></a>01753     <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classv8_1_1internal_1_1_semi_space.html">SemiSpace</a>*<span class="keyword">&gt;</span>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3e6f1fb7b24f1662eed90feefb5152ad">owner</a>());
<a name="l01754"></a>01754   }
<a name="l01755"></a>01755 
<a name="l01756"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a4e9f30cf45b58385257c7f353c86ffdd">01756</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a4e9f30cf45b58385257c7f353c86ffdd">is_anchor</a>() { <span class="keywordflow">return</span> !this-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a440a5fbf7b463a4762b6ee1e73224ac7">InNewSpace</a>(); }
<a name="l01757"></a>01757 
<a name="l01758"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a95c0f65be99a16369f76708bf27ead2d">01758</a>   <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a95c0f65be99a16369f76708bf27ead2d">IsAtStart</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr) {
<a name="l01759"></a>01759     <span class="keywordflow">return</span> (reinterpret_cast&lt;intptr_t&gt;(addr) &amp; <a class="code" href="classv8_1_1internal_1_1_page.html#a856e4e5c2ed9278569185cc42b7a645f">Page::kPageAlignmentMask</a>)
<a name="l01760"></a>01760         == <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a323d49bf8af911559723fa084503b6e7">kObjectStartOffset</a>;
<a name="l01761"></a>01761   }
<a name="l01762"></a>01762 
<a name="l01763"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a15a25b0583867758253bd558c66beb5a">01763</a>   <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a15a25b0583867758253bd558c66beb5a">IsAtEnd</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr) {
<a name="l01764"></a>01764     <span class="keywordflow">return</span> (reinterpret_cast&lt;intptr_t&gt;(addr) &amp; <a class="code" href="classv8_1_1internal_1_1_page.html#a856e4e5c2ed9278569185cc42b7a645f">Page::kPageAlignmentMask</a>) == 0;
<a name="l01765"></a>01765   }
<a name="l01766"></a>01766 
<a name="l01767"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a640f2ef0a76e0dd87e2b1121b50af7d1">01767</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a640f2ef0a76e0dd87e2b1121b50af7d1">address</a>() {
<a name="l01768"></a>01768     <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a><span class="keyword">&gt;</span>(<span class="keyword">this</span>);
<a name="l01769"></a>01769   }
<a name="l01770"></a>01770 
<a name="l01771"></a>01771   <span class="comment">// Finds the NewSpacePage containg the given address.</span>
<a name="l01772"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html#abfc27202ec422e3a19ea430440cf3608">01772</a>   <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>* <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#abfc27202ec422e3a19ea430440cf3608">FromAddress</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> address_in_page) {
<a name="l01773"></a>01773     <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> page_start =
<a name="l01774"></a>01774         <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a><span class="keyword">&gt;</span>(<span class="keyword">reinterpret_cast&lt;</span>uintptr_t<span class="keyword">&gt;</span>(address_in_page) &amp;
<a name="l01775"></a>01775                                   ~<a class="code" href="classv8_1_1internal_1_1_page.html#a856e4e5c2ed9278569185cc42b7a645f">Page::kPageAlignmentMask</a>);
<a name="l01776"></a>01776     <a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>* page = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>*<span class="keyword">&gt;</span>(page_start);
<a name="l01777"></a>01777     <span class="keywordflow">return</span> page;
<a name="l01778"></a>01778   }
<a name="l01779"></a>01779 
<a name="l01780"></a>01780   <span class="comment">// Find the page for a limit address. A limit address is either an address</span>
<a name="l01781"></a>01781   <span class="comment">// inside a page, or the address right after the last byte of a page.</span>
<a name="l01782"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html#aceb6a3181304820f663885cbd78b767f">01782</a>   <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>* <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#aceb6a3181304820f663885cbd78b767f">FromLimit</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> address_limit) {
<a name="l01783"></a>01783     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#abfc27202ec422e3a19ea430440cf3608">NewSpacePage::FromAddress</a>(address_limit - 1);
<a name="l01784"></a>01784   }
<a name="l01785"></a>01785 
<a name="l01786"></a>01786  <span class="keyword">private</span>:
<a name="l01787"></a>01787   <span class="comment">// Create a NewSpacePage object that is only used as anchor</span>
<a name="l01788"></a>01788   <span class="comment">// for the doubly-linked list of real pages.</span>
<a name="l01789"></a>01789   <span class="keyword">explicit</span> <a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>(<a class="code" href="classv8_1_1internal_1_1_semi_space.html">SemiSpace</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3e6f1fb7b24f1662eed90feefb5152ad">owner</a>) {
<a name="l01790"></a>01790     InitializeAsAnchor(owner);
<a name="l01791"></a>01791   }
<a name="l01792"></a>01792 
<a name="l01793"></a>01793   <span class="keyword">static</span> NewSpacePage* Initialize(Heap* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a0d2f4722858e958a80df90a287958581">heap</a>,
<a name="l01794"></a>01794                                   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>,
<a name="l01795"></a>01795                                   <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a7f9e141e6974f065422dc71eec580fc6">SemiSpace</a>* <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a276b0e129f4e4cdb7c4f56c3a60f6696">semi_space</a>);
<a name="l01796"></a>01796 
<a name="l01797"></a>01797   <span class="comment">// Intialize a fake NewSpacePage used as sentinel at the ends</span>
<a name="l01798"></a>01798   <span class="comment">// of a doubly-linked list of real NewSpacePages.</span>
<a name="l01799"></a>01799   <span class="comment">// Only uses the prev/next links, and sets flags to not be in new-space.</span>
<a name="l01800"></a>01800   <span class="keywordtype">void</span> InitializeAsAnchor(<a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a7f9e141e6974f065422dc71eec580fc6">SemiSpace</a>* <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3e6f1fb7b24f1662eed90feefb5152ad">owner</a>);
<a name="l01801"></a>01801 
<a name="l01802"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a7f9e141e6974f065422dc71eec580fc6">01802</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_semi_space.html">SemiSpace</a>;
<a name="l01803"></a><a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a8b928629934cd4bbb42b079d8d3faf28">01803</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_semi_space_iterator.html">SemiSpaceIterator</a>;
<a name="l01804"></a>01804 };
<a name="l01805"></a>01805 
<a name="l01806"></a>01806 
<a name="l01807"></a>01807 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l01808"></a>01808 <span class="comment">// SemiSpace in young generation</span>
<a name="l01809"></a>01809 <span class="comment">//</span>
<a name="l01810"></a>01810 <span class="comment">// A semispace is a contiguous chunk of memory holding page-like memory</span>
<a name="l01811"></a>01811 <span class="comment">// chunks. The mark-compact collector  uses the memory of the first page in</span>
<a name="l01812"></a>01812 <span class="comment">// the from space as a marking stack when tracing live objects.</span>
<a name="l01813"></a>01813 
<a name="l01814"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html">01814</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_semi_space.html">SemiSpace</a> : <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_space.html">Space</a> {
<a name="l01815"></a>01815  <span class="keyword">public</span>:
<a name="l01816"></a>01816   <span class="comment">// Constructor.</span>
<a name="l01817"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a1958ffe221d002476c29da54612956f0">01817</a>   <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a1958ffe221d002476c29da54612956f0">SemiSpace</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_space.html#aa2434e21dfedab7d15316ce88f5ee1a2">heap</a>, <a class="code" href="namespacev8_1_1internal.html#acd4c5ebd3b3afd81113ff7606f326799">SemiSpaceId</a> semispace)
<a name="l01818"></a>01818     : <a class="code" href="classv8_1_1internal_1_1_space.html">Space</a>(heap, <a class="code" href="namespacev8_1_1internal.html#aa131d4fd9972fd8dfbec01a9243d9fefa057ecb490c9eb2f2dc1677326b8a5621">NEW_SPACE</a>, <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093a1b9620a0e08f61037b76f280f98c6df8">NOT_EXECUTABLE</a>),
<a name="l01819"></a>01819       start_(<a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>),
<a name="l01820"></a>01820       age_mark_(<a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>),
<a name="l01821"></a>01821       id_(semispace),
<a name="l01822"></a>01822       anchor_(this),
<a name="l01823"></a>01823       current_page_(<a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>) { }
<a name="l01824"></a>01824 
<a name="l01825"></a>01825   <span class="comment">// Sets up the semispace using the given chunk.</span>
<a name="l01826"></a>01826   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#aba3a399ad56e6158e138e5d1ecd76315">SetUp</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>, <span class="keywordtype">int</span> initial_capacity, <span class="keywordtype">int</span> maximum_capacity);
<a name="l01827"></a>01827 
<a name="l01828"></a>01828   <span class="comment">// Tear down the space.  Heap memory was not allocated by the space, so it</span>
<a name="l01829"></a>01829   <span class="comment">// is not deallocated here.</span>
<a name="l01830"></a>01830   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a2e5b66ad47c14767b0035ed5006c2152">TearDown</a>();
<a name="l01831"></a>01831 
<a name="l01832"></a>01832   <span class="comment">// True if the space has been set up but not torn down.</span>
<a name="l01833"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#ae549c9fcda92bd48717df21eb7ffe024">01833</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#ae549c9fcda92bd48717df21eb7ffe024">HasBeenSetUp</a>() { <span class="keywordflow">return</span> start_ != <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>; }
<a name="l01834"></a>01834 
<a name="l01835"></a>01835   <span class="comment">// Grow the semispace to the new capacity.  The new capacity</span>
<a name="l01836"></a>01836   <span class="comment">// requested must be larger than the current capacity and less than</span>
<a name="l01837"></a>01837   <span class="comment">// the maximum capacity.</span>
<a name="l01838"></a>01838   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#ac5923076cef0dd5a93f2d917ebc50544">GrowTo</a>(<span class="keywordtype">int</span> new_capacity);
<a name="l01839"></a>01839 
<a name="l01840"></a>01840   <span class="comment">// Shrinks the semispace to the new capacity.  The new capacity</span>
<a name="l01841"></a>01841   <span class="comment">// requested must be more than the amount of used memory in the</span>
<a name="l01842"></a>01842   <span class="comment">// semispace and less than the current capacity.</span>
<a name="l01843"></a>01843   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a71a5e8d620e9754758f3779b5c2806c1">ShrinkTo</a>(<span class="keywordtype">int</span> new_capacity);
<a name="l01844"></a>01844 
<a name="l01845"></a>01845   <span class="comment">// Returns the start address of the first page of the space.</span>
<a name="l01846"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a00a39687980da5652bb8b3c9d86b416b">01846</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a00a39687980da5652bb8b3c9d86b416b">space_start</a>() {
<a name="l01847"></a>01847     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(anchor_.<a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a4537a7df808443b67dd5cbf24db69565">next_page</a>() != &amp;anchor_);
<a name="l01848"></a>01848     <span class="keywordflow">return</span> anchor_.<a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a4537a7df808443b67dd5cbf24db69565">next_page</a>()-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a8992f4ee6a39c4c82eb82e0b3e33e9fa">area_start</a>();
<a name="l01849"></a>01849   }
<a name="l01850"></a>01850 
<a name="l01851"></a>01851   <span class="comment">// Returns the start address of the current page of the space.</span>
<a name="l01852"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a99bc7823065a43ae2616a5add5576927">01852</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a99bc7823065a43ae2616a5add5576927">page_low</a>() {
<a name="l01853"></a>01853     <span class="keywordflow">return</span> current_page_-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a8992f4ee6a39c4c82eb82e0b3e33e9fa">area_start</a>();
<a name="l01854"></a>01854   }
<a name="l01855"></a>01855 
<a name="l01856"></a>01856   <span class="comment">// Returns one past the end address of the space.</span>
<a name="l01857"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#afa779ea2c5d2ee9717ebd964016bf9b9">01857</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#afa779ea2c5d2ee9717ebd964016bf9b9">space_end</a>() {
<a name="l01858"></a>01858     <span class="keywordflow">return</span> anchor_.<a class="code" href="classv8_1_1internal_1_1_new_space_page.html#ac97a49a13d7c0aba5c4372f5b9fa7403">prev_page</a>()-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad3898b428d291ef457bc87c2999ff18d">area_end</a>();
<a name="l01859"></a>01859   }
<a name="l01860"></a>01860 
<a name="l01861"></a>01861   <span class="comment">// Returns one past the end address of the current page of the space.</span>
<a name="l01862"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a1215003e1c658acd5ecb782063880833">01862</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a1215003e1c658acd5ecb782063880833">page_high</a>() {
<a name="l01863"></a>01863     <span class="keywordflow">return</span> current_page_-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad3898b428d291ef457bc87c2999ff18d">area_end</a>();
<a name="l01864"></a>01864   }
<a name="l01865"></a>01865 
<a name="l01866"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a3a3a17fe0cd6b823613b324e1f352b46">01866</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a3a3a17fe0cd6b823613b324e1f352b46">AdvancePage</a>() {
<a name="l01867"></a>01867     <a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>* next_page = current_page_-&gt;<a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a4537a7df808443b67dd5cbf24db69565">next_page</a>();
<a name="l01868"></a>01868     <span class="keywordflow">if</span> (next_page == anchor()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01869"></a>01869     current_page_ = next_page;
<a name="l01870"></a>01870     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01871"></a>01871   }
<a name="l01872"></a>01872 
<a name="l01873"></a>01873   <span class="comment">// Resets the space to using the first page.</span>
<a name="l01874"></a>01874   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a14dc89b6ec2d58c43fe3799cd8e54c38">Reset</a>();
<a name="l01875"></a>01875 
<a name="l01876"></a>01876   <span class="comment">// Age mark accessors.</span>
<a name="l01877"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a96d84b4c29550486b8600a8601b269ce">01877</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a96d84b4c29550486b8600a8601b269ce">age_mark</a>() { <span class="keywordflow">return</span> age_mark_; }
<a name="l01878"></a>01878   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#aab39f62197f82066a5b293869ee2fc44">set_age_mark</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> mark);
<a name="l01879"></a>01879 
<a name="l01880"></a>01880   <span class="comment">// True if the address is in the address range of this semispace (not</span>
<a name="l01881"></a>01881   <span class="comment">// necessarily below the allocation pointer).</span>
<a name="l01882"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a30f520fd28a2f60ef05b7c8a282d4539">01882</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a30f520fd28a2f60ef05b7c8a282d4539">Contains</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> a) {
<a name="l01883"></a>01883     <span class="keywordflow">return</span> (reinterpret_cast&lt;uintptr_t&gt;(a) &amp; address_mask_)
<a name="l01884"></a>01884            == <span class="keyword">reinterpret_cast&lt;</span>uintptr_t<span class="keyword">&gt;</span>(start_);
<a name="l01885"></a>01885   }
<a name="l01886"></a>01886 
<a name="l01887"></a>01887   <span class="comment">// True if the object is a heap object in the address range of this</span>
<a name="l01888"></a>01888   <span class="comment">// semispace (not necessarily below the allocation pointer).</span>
<a name="l01889"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a6dc2672844ad19e9ed67d92fd8fa7d52">01889</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a6dc2672844ad19e9ed67d92fd8fa7d52">Contains</a>(<a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>* o) {
<a name="l01890"></a>01890     <span class="keywordflow">return</span> (reinterpret_cast&lt;uintptr_t&gt;(o) &amp; object_mask_) == object_expected_;
<a name="l01891"></a>01891   }
<a name="l01892"></a>01892 
<a name="l01893"></a>01893   <span class="comment">// If we don&#39;t have these here then SemiSpace will be abstract.  However</span>
<a name="l01894"></a>01894   <span class="comment">// they should never be called.</span>
<a name="l01895"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#af7235403ae9e1923c8076615daaf2e55">01895</a>   <span class="keyword">virtual</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_semi_space.html#af7235403ae9e1923c8076615daaf2e55">Size</a>() {
<a name="l01896"></a>01896     <a class="code" href="checks_8h.html#a0bc63b24b654ca433be7b97a3edde132">UNREACHABLE</a>();
<a name="l01897"></a>01897     <span class="keywordflow">return</span> 0;
<a name="l01898"></a>01898   }
<a name="l01899"></a>01899 
<a name="l01900"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#ad4ae3d5a312547fa204222124ca80f0d">01900</a>   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#ad4ae3d5a312547fa204222124ca80f0d">ReserveSpace</a>(<span class="keywordtype">int</span> bytes) {
<a name="l01901"></a>01901     <a class="code" href="checks_8h.html#a0bc63b24b654ca433be7b97a3edde132">UNREACHABLE</a>();
<a name="l01902"></a>01902     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01903"></a>01903   }
<a name="l01904"></a>01904 
<a name="l01905"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a287a9650286c05244efe8a2464a0b584">01905</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a287a9650286c05244efe8a2464a0b584">is_committed</a>() { <span class="keywordflow">return</span> committed_; }
<a name="l01906"></a>01906   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#abcde77679b352a13023036322527bdd8">Commit</a>();
<a name="l01907"></a>01907   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a61e540c5fda1ce8ca1d3eba9ea7b79dc">Uncommit</a>();
<a name="l01908"></a>01908 
<a name="l01909"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a93fef3d64d95922589a3dd58d0d3b010">01909</a>   <a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>* <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a93fef3d64d95922589a3dd58d0d3b010">first_page</a>() { <span class="keywordflow">return</span> anchor_.<a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a4537a7df808443b67dd5cbf24db69565">next_page</a>(); }
<a name="l01910"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a61c6b0e913e97681d1e1cfad598cb7b8">01910</a>   <a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>* <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a61c6b0e913e97681d1e1cfad598cb7b8">current_page</a>() { <span class="keywordflow">return</span> current_page_; }
<a name="l01911"></a>01911 
<a name="l01912"></a>01912 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l01913"></a>01913 <span class="preprocessor"></span>  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="lineprocessor_8cc.html#ae894408d53a5dd2fec4c3e7ea09d5d4b">Print</a>();
<a name="l01914"></a>01914   <span class="keyword">virtual</span> <span class="keywordtype">void</span> Verify();
<a name="l01915"></a>01915   <span class="comment">// Validate a range of of addresses in a SemiSpace.</span>
<a name="l01916"></a>01916   <span class="comment">// The &quot;from&quot; address must be on a page prior to the &quot;to&quot; address,</span>
<a name="l01917"></a>01917   <span class="comment">// in the linked page order, or it must be earlier on the same page.</span>
<a name="l01918"></a>01918   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#ae78e80586c1013a2339790bd6f5938e2">AssertValidRange</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> from, <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> to);
<a name="l01919"></a>01919 <span class="preprocessor">#else</span>
<a name="l01920"></a>01920 <span class="preprocessor"></span>  <span class="comment">// Do nothing.</span>
<a name="l01921"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#ae78e80586c1013a2339790bd6f5938e2">01921</a>   <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#ae78e80586c1013a2339790bd6f5938e2">AssertValidRange</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> from, <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> to) {}
<a name="l01922"></a>01922 <span class="preprocessor">#endif</span>
<a name="l01923"></a>01923 <span class="preprocessor"></span>
<a name="l01924"></a>01924   <span class="comment">// Returns the current capacity of the semi space.</span>
<a name="l01925"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a470472a0565ba3dd318b36abc609a877">01925</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a470472a0565ba3dd318b36abc609a877">Capacity</a>() { <span class="keywordflow">return</span> capacity_; }
<a name="l01926"></a>01926 
<a name="l01927"></a>01927   <span class="comment">// Returns the maximum capacity of the semi space.</span>
<a name="l01928"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a5b329d7fda4134d112b19a24aa8a717b">01928</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a5b329d7fda4134d112b19a24aa8a717b">MaximumCapacity</a>() { <span class="keywordflow">return</span> maximum_capacity_; }
<a name="l01929"></a>01929 
<a name="l01930"></a>01930   <span class="comment">// Returns the initial capacity of the semi space.</span>
<a name="l01931"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#aa321297fd89187108751bb134d7c1f22">01931</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#aa321297fd89187108751bb134d7c1f22">InitialCapacity</a>() { <span class="keywordflow">return</span> initial_capacity_; }
<a name="l01932"></a>01932 
<a name="l01933"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#acdc44c71f23654cb7a127db798a1a52a">01933</a>   <a class="code" href="namespacev8_1_1internal.html#acd4c5ebd3b3afd81113ff7606f326799">SemiSpaceId</a> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#acdc44c71f23654cb7a127db798a1a52a">id</a>() { <span class="keywordflow">return</span> id_; }
<a name="l01934"></a>01934 
<a name="l01935"></a>01935   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_semi_space.html#a12d9024e40c876221b1fc8da9ad55433">Swap</a>(<a class="code" href="classv8_1_1internal_1_1_semi_space.html">SemiSpace</a>* from, <a class="code" href="classv8_1_1internal_1_1_semi_space.html">SemiSpace</a>* to);
<a name="l01936"></a>01936 
<a name="l01937"></a>01937  <span class="keyword">private</span>:
<a name="l01938"></a>01938   <span class="comment">// Flips the semispace between being from-space and to-space.</span>
<a name="l01939"></a>01939   <span class="comment">// Copies the flags into the masked positions on all pages in the space.</span>
<a name="l01940"></a>01940   <span class="keywordtype">void</span> FlipPages(intptr_t <a class="code" href="namespacev8_1_1internal.html#a9b4b1c68517c9a42918bc7079187ec70">flags</a>, intptr_t flag_mask);
<a name="l01941"></a>01941 
<a name="l01942"></a>01942   <a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>* anchor() { <span class="keywordflow">return</span> &amp;anchor_; }
<a name="l01943"></a>01943 
<a name="l01944"></a>01944   <span class="comment">// The current and maximum capacity of the space.</span>
<a name="l01945"></a>01945   <span class="keywordtype">int</span> capacity_;
<a name="l01946"></a>01946   <span class="keywordtype">int</span> maximum_capacity_;
<a name="l01947"></a>01947   <span class="keywordtype">int</span> initial_capacity_;
<a name="l01948"></a>01948 
<a name="l01949"></a>01949   <span class="comment">// The start address of the space.</span>
<a name="l01950"></a>01950   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> start_;
<a name="l01951"></a>01951   <span class="comment">// Used to govern object promotion during mark-compact collection.</span>
<a name="l01952"></a>01952   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> age_mark_;
<a name="l01953"></a>01953 
<a name="l01954"></a>01954   <span class="comment">// Masks and comparison values to test for containment in this semispace.</span>
<a name="l01955"></a>01955   uintptr_t address_mask_;
<a name="l01956"></a>01956   uintptr_t object_mask_;
<a name="l01957"></a>01957   uintptr_t object_expected_;
<a name="l01958"></a>01958 
<a name="l01959"></a>01959   <span class="keywordtype">bool</span> committed_;
<a name="l01960"></a>01960   <a class="code" href="namespacev8_1_1internal.html#acd4c5ebd3b3afd81113ff7606f326799">SemiSpaceId</a> id_;
<a name="l01961"></a>01961 
<a name="l01962"></a>01962   NewSpacePage anchor_;
<a name="l01963"></a>01963   NewSpacePage* current_page_;
<a name="l01964"></a>01964 
<a name="l01965"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a8b928629934cd4bbb42b079d8d3faf28">01965</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_semi_space_iterator.html">SemiSpaceIterator</a>;
<a name="l01966"></a><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a02d17e1b42313e4399611c825807adc6">01966</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_semi_space.html#a02d17e1b42313e4399611c825807adc6">NewSpacePageIterator</a>;
<a name="l01967"></a>01967  <span class="keyword">public</span>:
<a name="l01968"></a>01968   <a class="code" href="v8globals_8h.html#acd6c28319b70fd08384c3a21e0a14658">TRACK_MEMORY</a>(<span class="stringliteral">&quot;SemiSpace&quot;</span>)
<a name="l01969"></a>01969 };
<a name="l01970"></a>01970 
<a name="l01971"></a>01971 
<a name="l01972"></a>01972 <span class="comment">// A SemiSpaceIterator is an ObjectIterator that iterates over the active</span>
<a name="l01973"></a>01973 <span class="comment">// semispace of the heap&#39;s new space.  It iterates over the objects in the</span>
<a name="l01974"></a>01974 <span class="comment">// semispace from a given start address (defaulting to the bottom of the</span>
<a name="l01975"></a>01975 <span class="comment">// semispace) to the top of the semispace.  New objects allocated after the</span>
<a name="l01976"></a>01976 <span class="comment">// iterator is created are not iterated.</span>
<a name="l01977"></a><a class="code" href="classv8_1_1internal_1_1_semi_space_iterator.html">01977</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_semi_space_iterator.html">SemiSpaceIterator</a> : <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_object_iterator.html">ObjectIterator</a> {
<a name="l01978"></a>01978  <span class="keyword">public</span>:
<a name="l01979"></a>01979   <span class="comment">// Create an iterator over the objects in the given space.  If no start</span>
<a name="l01980"></a>01980   <span class="comment">// address is given, the iterator starts from the bottom of the space.  If</span>
<a name="l01981"></a>01981   <span class="comment">// no size function is given, the iterator calls Object::Size().</span>
<a name="l01982"></a>01982 
<a name="l01983"></a>01983   <span class="comment">// Iterate over all of allocated to-space.</span>
<a name="l01984"></a>01984   <span class="keyword">explicit</span> <a class="code" href="classv8_1_1internal_1_1_semi_space_iterator.html#ac5e7b5fd619d66ab4704cb5963b68d2c">SemiSpaceIterator</a>(<a class="code" href="classv8_1_1internal_1_1_new_space.html">NewSpace</a>* space);
<a name="l01985"></a>01985   <span class="comment">// Iterate over all of allocated to-space, with a custome size function.</span>
<a name="l01986"></a>01986   <a class="code" href="classv8_1_1internal_1_1_semi_space_iterator.html#ac5e7b5fd619d66ab4704cb5963b68d2c">SemiSpaceIterator</a>(<a class="code" href="classv8_1_1internal_1_1_new_space.html">NewSpace</a>* space, <a class="code" href="namespacev8_1_1internal.html#a4664a14735f154f774c9130702904468">HeapObjectCallback</a> size_func);
<a name="l01987"></a>01987   <span class="comment">// Iterate over part of allocated to-space, from start to the end</span>
<a name="l01988"></a>01988   <span class="comment">// of allocation.</span>
<a name="l01989"></a>01989   <a class="code" href="classv8_1_1internal_1_1_semi_space_iterator.html#ac5e7b5fd619d66ab4704cb5963b68d2c">SemiSpaceIterator</a>(<a class="code" href="classv8_1_1internal_1_1_new_space.html">NewSpace</a>* space, <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>);
<a name="l01990"></a>01990   <span class="comment">// Iterate from one address to another in the same semi-space.</span>
<a name="l01991"></a>01991   <a class="code" href="classv8_1_1internal_1_1_semi_space_iterator.html#ac5e7b5fd619d66ab4704cb5963b68d2c">SemiSpaceIterator</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> from, <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> to);
<a name="l01992"></a>01992 
<a name="l01993"></a><a class="code" href="classv8_1_1internal_1_1_semi_space_iterator.html#a37235788a31be69a87b02d71dc1687d0">01993</a>   <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <a class="code" href="classv8_1_1internal_1_1_semi_space_iterator.html#a37235788a31be69a87b02d71dc1687d0">Next</a>() {
<a name="l01994"></a>01994     <span class="keywordflow">if</span> (current_ == limit_) <span class="keywordflow">return</span> <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>;
<a name="l01995"></a>01995     <span class="keywordflow">if</span> (<a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a15a25b0583867758253bd558c66beb5a">NewSpacePage::IsAtEnd</a>(current_)) {
<a name="l01996"></a>01996       <a class="code" href="classv8_1_1internal_1_1_new_space_page.html">NewSpacePage</a>* page = <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#aceb6a3181304820f663885cbd78b767f">NewSpacePage::FromLimit</a>(current_);
<a name="l01997"></a>01997       page = page-&gt;<a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a4537a7df808443b67dd5cbf24db69565">next_page</a>();
<a name="l01998"></a>01998       <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(!page-&gt;<a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a4e9f30cf45b58385257c7f353c86ffdd">is_anchor</a>());
<a name="l01999"></a>01999       current_ = page-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a8992f4ee6a39c4c82eb82e0b3e33e9fa">area_start</a>();
<a name="l02000"></a>02000       <span class="keywordflow">if</span> (current_ == limit_) <span class="keywordflow">return</span> <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>;
<a name="l02001"></a>02001     }
<a name="l02002"></a>02002 
<a name="l02003"></a>02003     <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <span class="keywordtype">object</span> = <a class="code" href="classv8_1_1internal_1_1_heap_object.html#ac2dbe6768e6332fc90a987f23ca41ddb">HeapObject::FromAddress</a>(current_);
<a name="l02004"></a>02004     <span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a> = (size_func_ == <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>) ? object-&gt;<a class="code" href="classv8_1_1internal_1_1_heap_object.html#a53f4a8784ede9710d87dec27abb0a91d">Size</a>() : size_func_(<span class="keywordtype">object</span>);
<a name="l02005"></a>02005 
<a name="l02006"></a>02006     current_ += <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>;
<a name="l02007"></a>02007     <span class="keywordflow">return</span> object;
<a name="l02008"></a>02008   }
<a name="l02009"></a>02009 
<a name="l02010"></a>02010   <span class="comment">// Implementation of the ObjectIterator functions.</span>
<a name="l02011"></a><a class="code" href="classv8_1_1internal_1_1_semi_space_iterator.html#abd6d0878bb6d7b8be095bbed0590e8aa">02011</a>   <span class="keyword">virtual</span> <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <a class="code" href="classv8_1_1internal_1_1_semi_space_iterator.html#abd6d0878bb6d7b8be095bbed0590e8aa">next_object</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_semi_space_iterator.html#a37235788a31be69a87b02d71dc1687d0">Next</a>(); }
<a name="l02012"></a>02012 
<a name="l02013"></a>02013  <span class="keyword">private</span>:
<a name="l02014"></a>02014   <span class="keywordtype">void</span> Initialize(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> start,
<a name="l02015"></a>02015                   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> end,
<a name="l02016"></a>02016                   <a class="code" href="namespacev8_1_1internal.html#a4664a14735f154f774c9130702904468">HeapObjectCallback</a> size_func);
<a name="l02017"></a>02017 
<a name="l02018"></a>02018   <span class="comment">// The current iteration point.</span>
<a name="l02019"></a>02019   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> current_;
<a name="l02020"></a>02020   <span class="comment">// The end of iteration.</span>
<a name="l02021"></a>02021   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> limit_;
<a name="l02022"></a>02022   <span class="comment">// The callback function.</span>
<a name="l02023"></a>02023   <a class="code" href="namespacev8_1_1internal.html#a4664a14735f154f774c9130702904468">HeapObjectCallback</a> size_func_;
<a name="l02024"></a>02024 };
<a name="l02025"></a>02025 
<a name="l02026"></a>02026 
<a name="l02027"></a>02027 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l02028"></a>02028 <span class="comment">// A PageIterator iterates the pages in a semi-space.</span>
<a name="l02029"></a>02029 <span class="keyword">class </span>NewSpacePageIterator <a class="code" href="allocation_8h.html#abab81306d90d0b82732d5bed93a0a588">BASE_EMBEDDED</a> {
<a name="l02030"></a>02030  <span class="keyword">public</span>:
<a name="l02031"></a>02031   <span class="comment">// Make an iterator that runs over all pages in to-space.</span>
<a name="l02032"></a>02032   <span class="keyword">explicit</span> <span class="keyword">inline</span> NewSpacePageIterator(NewSpace* space);
<a name="l02033"></a>02033 
<a name="l02034"></a>02034   <span class="comment">// Make an iterator that runs over all pages in the given semispace,</span>
<a name="l02035"></a>02035   <span class="comment">// even those not used in allocation.</span>
<a name="l02036"></a>02036   <span class="keyword">explicit</span> <span class="keyword">inline</span> NewSpacePageIterator(SemiSpace* space);
<a name="l02037"></a>02037 
<a name="l02038"></a>02038   <span class="comment">// Make iterator that iterates from the page containing start</span>
<a name="l02039"></a>02039   <span class="comment">// to the page that contains limit in the same semispace.</span>
<a name="l02040"></a>02040   <span class="keyword">inline</span> NewSpacePageIterator(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="namespacell__prof.html#a5b7aee10eba26bc62f35b1049906c277">start</a>, <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> limit);
<a name="l02041"></a>02041 
<a name="l02042"></a>02042   <span class="keyword">inline</span> <span class="keywordtype">bool</span> has_next();
<a name="l02043"></a>02043   <span class="keyword">inline</span> NewSpacePage* next();
<a name="l02044"></a>02044 
<a name="l02045"></a>02045  <span class="keyword">private</span>:
<a name="l02046"></a>02046   NewSpacePage* prev_page_;  <span class="comment">// Previous page returned.</span>
<a name="l02047"></a>02047   <span class="comment">// Next page that will be returned.  Cached here so that we can use this</span>
<a name="l02048"></a>02048   <span class="comment">// iterator for operations that deallocate pages.</span>
<a name="l02049"></a>02049   NewSpacePage* next_page_;
<a name="l02050"></a>02050   <span class="comment">// Last page returned.</span>
<a name="l02051"></a>02051   NewSpacePage* last_page_;
<a name="l02052"></a>02052 };
<a name="l02053"></a>02053 
<a name="l02054"></a>02054 
<a name="l02055"></a>02055 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l02056"></a>02056 <span class="comment">// The young generation space.</span>
<a name="l02057"></a>02057 <span class="comment">//</span>
<a name="l02058"></a>02058 <span class="comment">// The new space consists of a contiguous pair of semispaces.  It simply</span>
<a name="l02059"></a>02059 <span class="comment">// forwards most functions to the appropriate semispace.</span>
<a name="l02060"></a>02060 
<a name="l02061"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html">02061</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_new_space.html">NewSpace</a> : <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_space.html">Space</a> {
<a name="l02062"></a>02062  <span class="keyword">public</span>:
<a name="l02063"></a>02063   <span class="comment">// Constructor.</span>
<a name="l02064"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#ad27147487351e9aa2f5d9d4b54525997">02064</a>   <span class="keyword">explicit</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#ad27147487351e9aa2f5d9d4b54525997">NewSpace</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_space.html#aa2434e21dfedab7d15316ce88f5ee1a2">heap</a>)
<a name="l02065"></a>02065     : <a class="code" href="classv8_1_1internal_1_1_space.html">Space</a>(heap, <a class="code" href="namespacev8_1_1internal.html#aa131d4fd9972fd8dfbec01a9243d9fefa057ecb490c9eb2f2dc1677326b8a5621">NEW_SPACE</a>, <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093a1b9620a0e08f61037b76f280f98c6df8">NOT_EXECUTABLE</a>),
<a name="l02066"></a>02066       to_space_(heap, <a class="code" href="namespacev8_1_1internal.html#acd4c5ebd3b3afd81113ff7606f326799a2c95de4ad1431e825dcf878bfa81676f">kToSpace</a>),
<a name="l02067"></a>02067       from_space_(heap, <a class="code" href="namespacev8_1_1internal.html#acd4c5ebd3b3afd81113ff7606f326799a444195281c8d73ffce5c1c83b96c06cb">kFromSpace</a>),
<a name="l02068"></a>02068       reservation_(),
<a name="l02069"></a>02069       inline_allocation_limit_step_(0) {}
<a name="l02070"></a>02070 
<a name="l02071"></a>02071   <span class="comment">// Sets up the new space using the given chunk.</span>
<a name="l02072"></a>02072   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a6d9a611cf03a01a66f00f9e606fb5792">SetUp</a>(<span class="keywordtype">int</span> reserved_semispace_size_, <span class="keywordtype">int</span> max_semispace_size);
<a name="l02073"></a>02073 
<a name="l02074"></a>02074   <span class="comment">// Tears down the space.  Heap memory was not allocated by the space, so it</span>
<a name="l02075"></a>02075   <span class="comment">// is not deallocated here.</span>
<a name="l02076"></a>02076   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a3c260c86d0c22230141dcfa58bd291b2">TearDown</a>();
<a name="l02077"></a>02077 
<a name="l02078"></a>02078   <span class="comment">// True if the space has been set up but not torn down.</span>
<a name="l02079"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#aa0b65ebe6da72afaf8654286124d5f9a">02079</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#aa0b65ebe6da72afaf8654286124d5f9a">HasBeenSetUp</a>() {
<a name="l02080"></a>02080     <span class="keywordflow">return</span> to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#ae549c9fcda92bd48717df21eb7ffe024">HasBeenSetUp</a>() &amp;&amp; from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#ae549c9fcda92bd48717df21eb7ffe024">HasBeenSetUp</a>();
<a name="l02081"></a>02081   }
<a name="l02082"></a>02082 
<a name="l02083"></a>02083   <span class="comment">// Flip the pair of spaces.</span>
<a name="l02084"></a>02084   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a2483751f06066ed3004a2cc72ec7fb9f">Flip</a>();
<a name="l02085"></a>02085 
<a name="l02086"></a>02086   <span class="comment">// Grow the capacity of the semispaces.  Assumes that they are not at</span>
<a name="l02087"></a>02087   <span class="comment">// their maximum capacity.</span>
<a name="l02088"></a>02088   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#ab3f396ae74206828b53672f496b676b3">Grow</a>();
<a name="l02089"></a>02089 
<a name="l02090"></a>02090   <span class="comment">// Shrink the capacity of the semispaces.</span>
<a name="l02091"></a>02091   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a96e448968f2591e48f8f8452cbd01d72">Shrink</a>();
<a name="l02092"></a>02092 
<a name="l02093"></a>02093   <span class="comment">// True if the address or object lies in the address range of either</span>
<a name="l02094"></a>02094   <span class="comment">// semispace (not necessarily below the allocation pointer).</span>
<a name="l02095"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#aee5fb40a7fdd34db3bf96a1a0251daa2">02095</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#aee5fb40a7fdd34db3bf96a1a0251daa2">Contains</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> a) {
<a name="l02096"></a>02096     <span class="keywordflow">return</span> (reinterpret_cast&lt;uintptr_t&gt;(a) &amp; address_mask_)
<a name="l02097"></a>02097         == <span class="keyword">reinterpret_cast&lt;</span>uintptr_t<span class="keyword">&gt;</span>(start_);
<a name="l02098"></a>02098   }
<a name="l02099"></a>02099 
<a name="l02100"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a3eb5dbab1f2ac9f6bc263e2e9549f5bf">02100</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a3eb5dbab1f2ac9f6bc263e2e9549f5bf">Contains</a>(<a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>* o) {
<a name="l02101"></a>02101     <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> a = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a><span class="keyword">&gt;</span>(o);
<a name="l02102"></a>02102     <span class="keywordflow">return</span> (reinterpret_cast&lt;uintptr_t&gt;(a) &amp; object_mask_) == object_expected_;
<a name="l02103"></a>02103   }
<a name="l02104"></a>02104 
<a name="l02105"></a>02105   <span class="comment">// Return the allocated bytes in the active semispace.</span>
<a name="l02106"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a6ab7d37f6b21efa90b5105654a63a400">02106</a>   <span class="keyword">virtual</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_new_space.html#a6ab7d37f6b21efa90b5105654a63a400">Size</a>() {
<a name="l02107"></a>02107     <span class="keywordflow">return</span> pages_used_ * <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a755d0554182e7ff72af75e0b7665e899">NewSpacePage::kAreaSize</a> +
<a name="l02108"></a>02108         <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code" href="classv8_1_1internal_1_1_new_space.html#a92582edd8562e673b9f6594f5f6d21bd">top</a>() - to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a99bc7823065a43ae2616a5add5576927">page_low</a>());
<a name="l02109"></a>02109   }
<a name="l02110"></a>02110 
<a name="l02111"></a>02111   <span class="comment">// The same, but returning an int.  We have to have the one that returns</span>
<a name="l02112"></a>02112   <span class="comment">// intptr_t because it is inherited, but if we know we are dealing with the</span>
<a name="l02113"></a>02113   <span class="comment">// new space, which can&#39;t get as big as the other spaces then this is useful:</span>
<a name="l02114"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#af67b47d7b604b691cf5edcd42b4cac67">02114</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#af67b47d7b604b691cf5edcd42b4cac67">SizeAsInt</a>() { <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code" href="classv8_1_1internal_1_1_new_space.html#a6ab7d37f6b21efa90b5105654a63a400">Size</a>()); }
<a name="l02115"></a>02115 
<a name="l02116"></a>02116   <span class="comment">// Return the current capacity of a semispace.</span>
<a name="l02117"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#ae61c605791a180089c29b81fc927fac5">02117</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_new_space.html#ae61c605791a180089c29b81fc927fac5">EffectiveCapacity</a>() {
<a name="l02118"></a>02118     <a class="code" href="checks_8h.html#afaada219ababb63f4a43da387a881b83">SLOW_ASSERT</a>(to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a470472a0565ba3dd318b36abc609a877">Capacity</a>() == from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a470472a0565ba3dd318b36abc609a877">Capacity</a>());
<a name="l02119"></a>02119     <span class="keywordflow">return</span> (to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a470472a0565ba3dd318b36abc609a877">Capacity</a>() / <a class="code" href="classv8_1_1internal_1_1_page.html#a573b8add96a07f20176e2bab44f48c20">Page::kPageSize</a>) * <a class="code" href="classv8_1_1internal_1_1_new_space_page.html#a755d0554182e7ff72af75e0b7665e899">NewSpacePage::kAreaSize</a>;
<a name="l02120"></a>02120   }
<a name="l02121"></a>02121 
<a name="l02122"></a>02122   <span class="comment">// Return the current capacity of a semispace.</span>
<a name="l02123"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a31fc242c1d16db736c1d274b811e1433">02123</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_new_space.html#a31fc242c1d16db736c1d274b811e1433">Capacity</a>() {
<a name="l02124"></a>02124     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a470472a0565ba3dd318b36abc609a877">Capacity</a>() == from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a470472a0565ba3dd318b36abc609a877">Capacity</a>());
<a name="l02125"></a>02125     <span class="keywordflow">return</span> to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a470472a0565ba3dd318b36abc609a877">Capacity</a>();
<a name="l02126"></a>02126   }
<a name="l02127"></a>02127 
<a name="l02128"></a>02128   <span class="comment">// Return the total amount of memory committed for new space.</span>
<a name="l02129"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a57910038eb12a408b2894a0cae522736">02129</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_new_space.html#a57910038eb12a408b2894a0cae522736">CommittedMemory</a>() {
<a name="l02130"></a>02130     <span class="keywordflow">if</span> (from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a287a9650286c05244efe8a2464a0b584">is_committed</a>()) <span class="keywordflow">return</span> 2 * <a class="code" href="classv8_1_1internal_1_1_new_space.html#a31fc242c1d16db736c1d274b811e1433">Capacity</a>();
<a name="l02131"></a>02131     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a31fc242c1d16db736c1d274b811e1433">Capacity</a>();
<a name="l02132"></a>02132   }
<a name="l02133"></a>02133 
<a name="l02134"></a>02134   <span class="comment">// Return the available bytes without growing.</span>
<a name="l02135"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a05bd9cc5f1987f510caafa25ceed00ca">02135</a>   intptr_t <a class="code" href="classv8_1_1internal_1_1_new_space.html#a05bd9cc5f1987f510caafa25ceed00ca">Available</a>() {
<a name="l02136"></a>02136     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a31fc242c1d16db736c1d274b811e1433">Capacity</a>() - <a class="code" href="classv8_1_1internal_1_1_new_space.html#a6ab7d37f6b21efa90b5105654a63a400">Size</a>();
<a name="l02137"></a>02137   }
<a name="l02138"></a>02138 
<a name="l02139"></a>02139   <span class="comment">// Return the maximum capacity of a semispace.</span>
<a name="l02140"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#ab2156ccf9bf7e051857765ca79bcd6cf">02140</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#ab2156ccf9bf7e051857765ca79bcd6cf">MaximumCapacity</a>() {
<a name="l02141"></a>02141     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a5b329d7fda4134d112b19a24aa8a717b">MaximumCapacity</a>() == from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a5b329d7fda4134d112b19a24aa8a717b">MaximumCapacity</a>());
<a name="l02142"></a>02142     <span class="keywordflow">return</span> to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a5b329d7fda4134d112b19a24aa8a717b">MaximumCapacity</a>();
<a name="l02143"></a>02143   }
<a name="l02144"></a>02144 
<a name="l02145"></a>02145   <span class="comment">// Returns the initial capacity of a semispace.</span>
<a name="l02146"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a2eb8cc0f7a534080f7e3056caa79eebc">02146</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a2eb8cc0f7a534080f7e3056caa79eebc">InitialCapacity</a>() {
<a name="l02147"></a>02147     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#aa321297fd89187108751bb134d7c1f22">InitialCapacity</a>() == from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#aa321297fd89187108751bb134d7c1f22">InitialCapacity</a>());
<a name="l02148"></a>02148     <span class="keywordflow">return</span> to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#aa321297fd89187108751bb134d7c1f22">InitialCapacity</a>();
<a name="l02149"></a>02149   }
<a name="l02150"></a>02150 
<a name="l02151"></a>02151   <span class="comment">// Return the address of the allocation pointer in the active semispace.</span>
<a name="l02152"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a92582edd8562e673b9f6594f5f6d21bd">02152</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a92582edd8562e673b9f6594f5f6d21bd">top</a>() {
<a name="l02153"></a>02153     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a61c6b0e913e97681d1e1cfad598cb7b8">current_page</a>()-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3c63106e1a91ed8f9ae53fdda7a475f0">ContainsLimit</a>(allocation_info_.<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a891d3089101b9590fb5e10ba2815f364">top</a>));
<a name="l02154"></a>02154     <span class="keywordflow">return</span> allocation_info_.<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a891d3089101b9590fb5e10ba2815f364">top</a>;
<a name="l02155"></a>02155   }
<a name="l02156"></a>02156   <span class="comment">// Return the address of the first object in the active semispace.</span>
<a name="l02157"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a1f1a7f43269691e499b99320516d4bfc">02157</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a1f1a7f43269691e499b99320516d4bfc">bottom</a>() { <span class="keywordflow">return</span> to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a00a39687980da5652bb8b3c9d86b416b">space_start</a>(); }
<a name="l02158"></a>02158 
<a name="l02159"></a>02159   <span class="comment">// Get the age mark of the inactive semispace.</span>
<a name="l02160"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#ac2db326d663e8f24e1e699d75a2373ad">02160</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_new_space.html#ac2db326d663e8f24e1e699d75a2373ad">age_mark</a>() { <span class="keywordflow">return</span> from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a96d84b4c29550486b8600a8601b269ce">age_mark</a>(); }
<a name="l02161"></a>02161   <span class="comment">// Set the age mark in the active semispace.</span>
<a name="l02162"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a61f2c59fea2f6c0626fbae3d75aa4dd2">02162</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a61f2c59fea2f6c0626fbae3d75aa4dd2">set_age_mark</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> mark) { to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#aab39f62197f82066a5b293869ee2fc44">set_age_mark</a>(mark); }
<a name="l02163"></a>02163 
<a name="l02164"></a>02164   <span class="comment">// The start address of the space and a bit mask. Anding an address in the</span>
<a name="l02165"></a>02165   <span class="comment">// new space with the mask will result in the start address.</span>
<a name="l02166"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#ad350338a57641d5d844e1e45415bb327">02166</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_new_space.html#ad350338a57641d5d844e1e45415bb327">start</a>() { <span class="keywordflow">return</span> start_; }
<a name="l02167"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#af7b8398afe3e58368f8b4d2115692738">02167</a>   uintptr_t <a class="code" href="classv8_1_1internal_1_1_new_space.html#af7b8398afe3e58368f8b4d2115692738">mask</a>() { <span class="keywordflow">return</span> address_mask_; }
<a name="l02168"></a>02168 
<a name="l02169"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a601a8737a924d23e9e39af5c69d0584d">02169</a>   <a class="code" href="classv8_1_1internal_1_1_new_space.html#a601a8737a924d23e9e39af5c69d0584d">INLINE</a>(uint32_t AddressToMarkbitIndex(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr)) {
<a name="l02170"></a>02170     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(<a class="code" href="classv8_1_1internal_1_1_new_space.html#aee5fb40a7fdd34db3bf96a1a0251daa2">Contains</a>(addr));
<a name="l02171"></a>02171     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(<a class="code" href="namespacev8_1_1internal.html#ada66adab5e750853950daf4371db1392">IsAligned</a>(<a class="code" href="namespacev8_1_1internal.html#aefd9bd49976aa2276ada1b562f1c6cbb">OffsetFrom</a>(addr), <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a>) ||
<a name="l02172"></a>02172            <a class="code" href="namespacev8_1_1internal.html#ada66adab5e750853950daf4371db1392">IsAligned</a>(<a class="code" href="namespacev8_1_1internal.html#aefd9bd49976aa2276ada1b562f1c6cbb">OffsetFrom</a>(addr) - 1, <a class="code" href="namespacev8_1_1internal.html#a023300bfff7e3bace1bbc934a501681c">kPointerSize</a>));
<a name="l02173"></a>02173     <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(addr - start_) &gt;&gt; <a class="code" href="namespacev8_1_1internal.html#a601740e70a85facf0b9567aa303a7e5f">kPointerSizeLog2</a>;
<a name="l02174"></a>02174   }
<a name="l02175"></a>02175 
<a name="l02176"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#af2468748067c7108a7e005c7d0262715">02176</a>   <a class="code" href="classv8_1_1internal_1_1_new_space.html#af2468748067c7108a7e005c7d0262715">INLINE</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> MarkbitIndexToAddress(uint32_t index)) {
<a name="l02177"></a>02177     <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a><span class="keyword">&gt;</span>(index &lt;&lt; <a class="code" href="namespacev8_1_1internal.html#a601740e70a85facf0b9567aa303a7e5f">kPointerSizeLog2</a>);
<a name="l02178"></a>02178   }
<a name="l02179"></a>02179 
<a name="l02180"></a>02180   <span class="comment">// The allocation top and limit addresses.</span>
<a name="l02181"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a76390e249756e491e6887b27718a31b6">02181</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a>* <a class="code" href="classv8_1_1internal_1_1_new_space.html#a76390e249756e491e6887b27718a31b6">allocation_top_address</a>() { <span class="keywordflow">return</span> &amp;allocation_info_.<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a891d3089101b9590fb5e10ba2815f364">top</a>; }
<a name="l02182"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#ab132e5fe993a4e1ade3bf1137dc655bb">02182</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a>* <a class="code" href="classv8_1_1internal_1_1_new_space.html#ab132e5fe993a4e1ade3bf1137dc655bb">allocation_limit_address</a>() { <span class="keywordflow">return</span> &amp;allocation_info_.<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a58e65b9b6d456df7b1c74a0dfb6f5f6e">limit</a>; }
<a name="l02183"></a>02183 
<a name="l02184"></a>02184   <a class="code" href="globals_8h.html#afefbce768b9d0df9c9ebc30dd6d13fed">MUST_USE_RESULT</a> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a601a8737a924d23e9e39af5c69d0584d">INLINE</a>(MaybeObject* AllocateRaw(<span class="keywordtype">int</span> size_in_bytes));
<a name="l02185"></a>02185 
<a name="l02186"></a>02186   <span class="comment">// Reset the allocation pointer to the beginning of the active semispace.</span>
<a name="l02187"></a>02187   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a76b5e11eb122d9ab2befeca74f56f001">ResetAllocationInfo</a>();
<a name="l02188"></a>02188 
<a name="l02189"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a0e9e1d62b1fde1e2f12a1a751d7807bc">02189</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a0e9e1d62b1fde1e2f12a1a751d7807bc">LowerInlineAllocationLimit</a>(intptr_t step) {
<a name="l02190"></a>02190     inline_allocation_limit_step_ = step;
<a name="l02191"></a>02191     <span class="keywordflow">if</span> (step == 0) {
<a name="l02192"></a>02192       allocation_info_.<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a58e65b9b6d456df7b1c74a0dfb6f5f6e">limit</a> = to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a1215003e1c658acd5ecb782063880833">page_high</a>();
<a name="l02193"></a>02193     } <span class="keywordflow">else</span> {
<a name="l02194"></a>02194       allocation_info_.<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a58e65b9b6d456df7b1c74a0dfb6f5f6e">limit</a> = <a class="code" href="namespacev8_1_1internal.html#a4789b60113833ac293f9d1aa9a6372e8">Min</a>(
<a name="l02195"></a>02195           allocation_info_.<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a891d3089101b9590fb5e10ba2815f364">top</a> + inline_allocation_limit_step_,
<a name="l02196"></a>02196           allocation_info_.<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a58e65b9b6d456df7b1c74a0dfb6f5f6e">limit</a>);
<a name="l02197"></a>02197     }
<a name="l02198"></a>02198     top_on_previous_step_ = allocation_info_.<a class="code" href="classv8_1_1internal_1_1_allocation_info.html#a891d3089101b9590fb5e10ba2815f364">top</a>;
<a name="l02199"></a>02199   }
<a name="l02200"></a>02200 
<a name="l02201"></a>02201   <span class="comment">// Get the extent of the inactive semispace (for use as a marking stack,</span>
<a name="l02202"></a>02202   <span class="comment">// or to zap it). Notice: space-addresses are not necessarily on the</span>
<a name="l02203"></a>02203   <span class="comment">// same page, so FromSpaceStart() might be above FromSpaceEnd().</span>
<a name="l02204"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#ad7aaea88d9ac7c1f7f2cd43040858c8f">02204</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_new_space.html#ad7aaea88d9ac7c1f7f2cd43040858c8f">FromSpacePageLow</a>() { <span class="keywordflow">return</span> from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a99bc7823065a43ae2616a5add5576927">page_low</a>(); }
<a name="l02205"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a33df91858d38af93ce62ea76b28e903a">02205</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a33df91858d38af93ce62ea76b28e903a">FromSpacePageHigh</a>() { <span class="keywordflow">return</span> from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a1215003e1c658acd5ecb782063880833">page_high</a>(); }
<a name="l02206"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#adca65134cc792a5c9085abe28890d804">02206</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_new_space.html#adca65134cc792a5c9085abe28890d804">FromSpaceStart</a>() { <span class="keywordflow">return</span> from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a00a39687980da5652bb8b3c9d86b416b">space_start</a>(); }
<a name="l02207"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a33017a03a8d882305087b8b831e128d8">02207</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a33017a03a8d882305087b8b831e128d8">FromSpaceEnd</a>() { <span class="keywordflow">return</span> from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#afa779ea2c5d2ee9717ebd964016bf9b9">space_end</a>(); }
<a name="l02208"></a>02208 
<a name="l02209"></a>02209   <span class="comment">// Get the extent of the active semispace&#39;s pages&#39; memory.</span>
<a name="l02210"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a70fc5e7f13bb98f995d3ad5dde952089">02210</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a70fc5e7f13bb98f995d3ad5dde952089">ToSpaceStart</a>() { <span class="keywordflow">return</span> to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a00a39687980da5652bb8b3c9d86b416b">space_start</a>(); }
<a name="l02211"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a1c1df8621b4e259bd2484431b6e1ed72">02211</a>   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a1c1df8621b4e259bd2484431b6e1ed72">ToSpaceEnd</a>() { <span class="keywordflow">return</span> to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#afa779ea2c5d2ee9717ebd964016bf9b9">space_end</a>(); }
<a name="l02212"></a>02212 
<a name="l02213"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#adbf40ccbe0411660f759ee63c20abd2d">02213</a>   <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#adbf40ccbe0411660f759ee63c20abd2d">ToSpaceContains</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> address) {
<a name="l02214"></a>02214     <span class="keywordflow">return</span> to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a30f520fd28a2f60ef05b7c8a282d4539">Contains</a>(address);
<a name="l02215"></a>02215   }
<a name="l02216"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#ac1b1535ac92f5d5e009d738fe25e6c8d">02216</a>   <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#ac1b1535ac92f5d5e009d738fe25e6c8d">FromSpaceContains</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> address) {
<a name="l02217"></a>02217     <span class="keywordflow">return</span> from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a30f520fd28a2f60ef05b7c8a282d4539">Contains</a>(address);
<a name="l02218"></a>02218   }
<a name="l02219"></a>02219 
<a name="l02220"></a>02220   <span class="comment">// True if the object is a heap object in the address range of the</span>
<a name="l02221"></a>02221   <span class="comment">// respective semispace (not necessarily below the allocation pointer of the</span>
<a name="l02222"></a>02222   <span class="comment">// semispace).</span>
<a name="l02223"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a560c4efe48c8217a5fc3880b89dd664d">02223</a>   <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a560c4efe48c8217a5fc3880b89dd664d">ToSpaceContains</a>(<a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>* o) { <span class="keywordflow">return</span> to_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a30f520fd28a2f60ef05b7c8a282d4539">Contains</a>(o); }
<a name="l02224"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a543190278789f732a664226eef5253ca">02224</a>   <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a543190278789f732a664226eef5253ca">FromSpaceContains</a>(<a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>* o) { <span class="keywordflow">return</span> from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a30f520fd28a2f60ef05b7c8a282d4539">Contains</a>(o); }
<a name="l02225"></a>02225 
<a name="l02226"></a>02226   <span class="comment">// Try to switch the active semispace to a new, empty, page.</span>
<a name="l02227"></a>02227   <span class="comment">// Returns false if this isn&#39;t possible or reasonable (i.e., there</span>
<a name="l02228"></a>02228   <span class="comment">// are no pages, or the current page is already empty), or true</span>
<a name="l02229"></a>02229   <span class="comment">// if successful.</span>
<a name="l02230"></a>02230   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a744459ffa6773c735d730165c2474fe1">AddFreshPage</a>();
<a name="l02231"></a>02231 
<a name="l02232"></a>02232   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a20110ca2ec5c01ced4d5b3ec007f63fb">ReserveSpace</a>(<span class="keywordtype">int</span> bytes);
<a name="l02233"></a>02233 
<a name="l02234"></a>02234   <span class="comment">// Resizes a sequential string which must be the most recent thing that was</span>
<a name="l02235"></a>02235   <span class="comment">// allocated in new space.</span>
<a name="l02236"></a>02236   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l02237"></a>02237   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a915b19f6a193bf2e57b7ebfa7f0b39ef">ShrinkStringAtAllocationBoundary</a>(<a class="code" href="classv8_1_1internal_1_1_string.html">String</a>* <span class="keywordtype">string</span>, <span class="keywordtype">int</span> len);
<a name="l02238"></a>02238 
<a name="l02239"></a>02239 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l02240"></a>02240 <span class="preprocessor"></span>  <span class="comment">// Verify the active semispace.</span>
<a name="l02241"></a>02241   <span class="keyword">virtual</span> <span class="keywordtype">void</span> Verify();
<a name="l02242"></a>02242   <span class="comment">// Print the active semispace.</span>
<a name="l02243"></a>02243   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="lineprocessor_8cc.html#ae894408d53a5dd2fec4c3e7ea09d5d4b">Print</a>() { to_space_.Print(); }
<a name="l02244"></a>02244 <span class="preprocessor">#endif</span>
<a name="l02245"></a>02245 <span class="preprocessor"></span>
<a name="l02246"></a>02246   <span class="comment">// Iterates the active semispace to collect statistics.</span>
<a name="l02247"></a>02247   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a66084fd586f0e286a38b0ba78717938f">CollectStatistics</a>();
<a name="l02248"></a>02248   <span class="comment">// Reports previously collected statistics of the active semispace.</span>
<a name="l02249"></a>02249   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a30fad752a749629cf77790063497f53f">ReportStatistics</a>();
<a name="l02250"></a>02250   <span class="comment">// Clears previously collected statistics.</span>
<a name="l02251"></a>02251   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a0129b90dc61f100bc670c8afc4434242">ClearHistograms</a>();
<a name="l02252"></a>02252 
<a name="l02253"></a>02253   <span class="comment">// Record the allocation or promotion of a heap object.  Note that we don&#39;t</span>
<a name="l02254"></a>02254   <span class="comment">// record every single allocation, but only those that happen in the</span>
<a name="l02255"></a>02255   <span class="comment">// to space during a scavenge GC.</span>
<a name="l02256"></a>02256   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#aa91ee8eb4de2a808c8bc91ed345d06ce">RecordAllocation</a>(HeapObject* obj);
<a name="l02257"></a>02257   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a15db9fe227a0454640e6ae19c124290a">RecordPromotion</a>(HeapObject* obj);
<a name="l02258"></a>02258 
<a name="l02259"></a>02259   <span class="comment">// Return whether the operation succeded.</span>
<a name="l02260"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a9f14d02d53653fcaca7c4b18d4f93984">02260</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#a9f14d02d53653fcaca7c4b18d4f93984">CommitFromSpaceIfNeeded</a>() {
<a name="l02261"></a>02261     <span class="keywordflow">if</span> (from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a287a9650286c05244efe8a2464a0b584">is_committed</a>()) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02262"></a>02262     <span class="keywordflow">return</span> from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#abcde77679b352a13023036322527bdd8">Commit</a>();
<a name="l02263"></a>02263   }
<a name="l02264"></a>02264 
<a name="l02265"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#aa96d85e9b611f7e6ab4f555ad63ab4d9">02265</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_new_space.html#aa96d85e9b611f7e6ab4f555ad63ab4d9">UncommitFromSpace</a>() {
<a name="l02266"></a>02266     <span class="keywordflow">if</span> (!from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a287a9650286c05244efe8a2464a0b584">is_committed</a>()) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02267"></a>02267     <span class="keywordflow">return</span> from_space_.<a class="code" href="classv8_1_1internal_1_1_semi_space.html#a61e540c5fda1ce8ca1d3eba9ea7b79dc">Uncommit</a>();
<a name="l02268"></a>02268   }
<a name="l02269"></a>02269 
<a name="l02270"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#ae0274a1c122c791db268d31b58d82abb">02270</a>   <span class="keyword">inline</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_new_space.html#ae0274a1c122c791db268d31b58d82abb">inline_allocation_limit_step</a>() {
<a name="l02271"></a>02271     <span class="keywordflow">return</span> inline_allocation_limit_step_;
<a name="l02272"></a>02272   }
<a name="l02273"></a>02273 
<a name="l02274"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a2be99e414fb38135104bb1e86cdcb3a4">02274</a>   <a class="code" href="classv8_1_1internal_1_1_semi_space.html">SemiSpace</a>* <a class="code" href="classv8_1_1internal_1_1_new_space.html#a2be99e414fb38135104bb1e86cdcb3a4">active_space</a>() { <span class="keywordflow">return</span> &amp;to_space_; }
<a name="l02275"></a>02275 
<a name="l02276"></a>02276  <span class="keyword">private</span>:
<a name="l02277"></a>02277   <span class="comment">// Update allocation info to match the current to-space page.</span>
<a name="l02278"></a>02278   <span class="keywordtype">void</span> UpdateAllocationInfo();
<a name="l02279"></a>02279 
<a name="l02280"></a>02280   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> chunk_base_;
<a name="l02281"></a>02281   uintptr_t chunk_size_;
<a name="l02282"></a>02282 
<a name="l02283"></a>02283   <span class="comment">// The semispaces.</span>
<a name="l02284"></a>02284   <a class="code" href="classv8_1_1internal_1_1_semi_space.html">SemiSpace</a> to_space_;
<a name="l02285"></a>02285   <a class="code" href="classv8_1_1internal_1_1_semi_space.html">SemiSpace</a> from_space_;
<a name="l02286"></a>02286   <a class="code" href="classv8_1_1internal_1_1_virtual_memory.html">VirtualMemory</a> reservation_;
<a name="l02287"></a>02287   <span class="keywordtype">int</span> pages_used_;
<a name="l02288"></a>02288 
<a name="l02289"></a>02289   <span class="comment">// Start address and bit mask for containment testing.</span>
<a name="l02290"></a>02290   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> start_;
<a name="l02291"></a>02291   uintptr_t address_mask_;
<a name="l02292"></a>02292   uintptr_t object_mask_;
<a name="l02293"></a>02293   uintptr_t object_expected_;
<a name="l02294"></a>02294 
<a name="l02295"></a>02295   <span class="comment">// Allocation pointer and limit for normal allocation and allocation during</span>
<a name="l02296"></a>02296   <span class="comment">// mark-compact collection.</span>
<a name="l02297"></a>02297   <a class="code" href="classv8_1_1internal_1_1_allocation_info.html">AllocationInfo</a> allocation_info_;
<a name="l02298"></a>02298 
<a name="l02299"></a>02299   <span class="comment">// When incremental marking is active we will set allocation_info_.limit</span>
<a name="l02300"></a>02300   <span class="comment">// to be lower than actual limit and then will gradually increase it</span>
<a name="l02301"></a>02301   <span class="comment">// in steps to guarantee that we do incremental marking steps even</span>
<a name="l02302"></a>02302   <span class="comment">// when all allocation is performed from inlined generated code.</span>
<a name="l02303"></a>02303   intptr_t inline_allocation_limit_step_;
<a name="l02304"></a>02304 
<a name="l02305"></a>02305   <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> top_on_previous_step_;
<a name="l02306"></a>02306 
<a name="l02307"></a>02307   <a class="code" href="classv8_1_1internal_1_1_histogram_info.html">HistogramInfo</a>* allocated_histogram_;
<a name="l02308"></a>02308   <a class="code" href="classv8_1_1internal_1_1_histogram_info.html">HistogramInfo</a>* promoted_histogram_;
<a name="l02309"></a>02309 
<a name="l02310"></a>02310   <a class="code" href="globals_8h.html#afefbce768b9d0df9c9ebc30dd6d13fed">MUST_USE_RESULT</a> MaybeObject* SlowAllocateRaw(<span class="keywordtype">int</span> size_in_bytes);
<a name="l02311"></a>02311 
<a name="l02312"></a><a class="code" href="classv8_1_1internal_1_1_new_space.html#a8b928629934cd4bbb42b079d8d3faf28">02312</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_semi_space_iterator.html">SemiSpaceIterator</a>;
<a name="l02313"></a>02313 
<a name="l02314"></a>02314  <span class="keyword">public</span>:
<a name="l02315"></a>02315   <a class="code" href="v8globals_8h.html#acd6c28319b70fd08384c3a21e0a14658">TRACK_MEMORY</a>(<span class="stringliteral">&quot;NewSpace&quot;</span>)
<a name="l02316"></a>02316 };
<a name="l02317"></a>02317 
<a name="l02318"></a>02318 
<a name="l02319"></a>02319 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l02320"></a>02320 <span class="comment">// Old object space (excluding map objects)</span>
<a name="l02321"></a>02321 
<a name="l02322"></a><a class="code" href="classv8_1_1internal_1_1_old_space.html">02322</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_old_space.html">OldSpace</a> : <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html">PagedSpace</a> {
<a name="l02323"></a>02323  <span class="keyword">public</span>:
<a name="l02324"></a>02324   <span class="comment">// Creates an old space object with a given maximum capacity.</span>
<a name="l02325"></a>02325   <span class="comment">// The constructor does not allocate pages from OS.</span>
<a name="l02326"></a><a class="code" href="classv8_1_1internal_1_1_old_space.html#ad09e0b32b7ab34e49fe807f772413807">02326</a>   <a class="code" href="classv8_1_1internal_1_1_old_space.html#ad09e0b32b7ab34e49fe807f772413807">OldSpace</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_space.html#aa2434e21dfedab7d15316ce88f5ee1a2">heap</a>,
<a name="l02327"></a>02327            intptr_t max_capacity,
<a name="l02328"></a>02328            <a class="code" href="namespacev8_1_1internal.html#aa131d4fd9972fd8dfbec01a9243d9fef">AllocationSpace</a> <span class="keywordtype">id</span>,
<a name="l02329"></a>02329            <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> <a class="code" href="classv8_1_1internal_1_1_space.html#aac4582fa58547eaf2339efa4b39b656c">executable</a>)
<a name="l02330"></a>02330       : <a class="code" href="classv8_1_1internal_1_1_paged_space.html">PagedSpace</a>(heap, max_capacity, id, executable) {
<a name="l02331"></a>02331     <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a5988fece15a37f5fde12ed39d2ecda0a">page_extra_</a> = 0;
<a name="l02332"></a>02332   }
<a name="l02333"></a>02333 
<a name="l02334"></a>02334   <span class="comment">// The limit of allocation for a page in this space.</span>
<a name="l02335"></a><a class="code" href="classv8_1_1internal_1_1_old_space.html#a8a1aa000fe4cf73162b509bb510cce55">02335</a>   <span class="keyword">virtual</span> <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_old_space.html#a8a1aa000fe4cf73162b509bb510cce55">PageAllocationLimit</a>(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* page) {
<a name="l02336"></a>02336     <span class="keywordflow">return</span> page-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad3898b428d291ef457bc87c2999ff18d">area_end</a>();
<a name="l02337"></a>02337   }
<a name="l02338"></a>02338 
<a name="l02339"></a>02339  <span class="keyword">public</span>:
<a name="l02340"></a>02340   <a class="code" href="v8globals_8h.html#acd6c28319b70fd08384c3a21e0a14658">TRACK_MEMORY</a>(<span class="stringliteral">&quot;OldSpace&quot;</span>)
<a name="l02341"></a>02341 };
<a name="l02342"></a>02342 
<a name="l02343"></a>02343 
<a name="l02344"></a>02344 <span class="comment">// For contiguous spaces, top should be in the space (or at the end) and limit</span>
<a name="l02345"></a>02345 <span class="comment">// should be the end of the space.</span>
<a name="l02346"></a><a class="code" href="spaces_8h.html#a260599f6ea778e270b3e84edeb9a58ba">02346</a> <span class="preprocessor">#define ASSERT_SEMISPACE_ALLOCATION_INFO(info, space) \</span>
<a name="l02347"></a>02347 <span class="preprocessor">  SLOW_ASSERT((space).page_low() &lt;= (info).top             \</span>
<a name="l02348"></a>02348 <span class="preprocessor">              &amp;&amp; (info).top &lt;= (space).page_high()         \</span>
<a name="l02349"></a>02349 <span class="preprocessor">              &amp;&amp; (info).limit &lt;= (space).page_high())</span>
<a name="l02350"></a>02350 <span class="preprocessor"></span>
<a name="l02351"></a>02351 
<a name="l02352"></a>02352 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l02353"></a>02353 <span class="comment">// Old space for objects of a fixed size</span>
<a name="l02354"></a>02354 
<a name="l02355"></a><a class="code" href="classv8_1_1internal_1_1_fixed_space.html">02355</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_fixed_space.html">FixedSpace</a> : <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_paged_space.html">PagedSpace</a> {
<a name="l02356"></a>02356  <span class="keyword">public</span>:
<a name="l02357"></a><a class="code" href="classv8_1_1internal_1_1_fixed_space.html#a75e3d868cd864ba5e1723b4f4bc526a6">02357</a>   <a class="code" href="classv8_1_1internal_1_1_fixed_space.html#a75e3d868cd864ba5e1723b4f4bc526a6">FixedSpace</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_space.html#aa2434e21dfedab7d15316ce88f5ee1a2">heap</a>,
<a name="l02358"></a>02358              intptr_t max_capacity,
<a name="l02359"></a>02359              <a class="code" href="namespacev8_1_1internal.html#aa131d4fd9972fd8dfbec01a9243d9fef">AllocationSpace</a> <span class="keywordtype">id</span>,
<a name="l02360"></a>02360              <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_fixed_space.html#affb9df8a2b37d45eafd54b72c2cf6c19">object_size_in_bytes</a>,
<a name="l02361"></a>02361              <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="namespacev8_1_1internal.html#a81b49fe6af51fab72b8b2ee86f70d4dd">name</a>)
<a name="l02362"></a>02362       : <a class="code" href="classv8_1_1internal_1_1_paged_space.html">PagedSpace</a>(heap, max_capacity, id, <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093a1b9620a0e08f61037b76f280f98c6df8">NOT_EXECUTABLE</a>),
<a name="l02363"></a>02363         object_size_in_bytes_(object_size_in_bytes),
<a name="l02364"></a>02364         name_(name) {
<a name="l02365"></a>02365     <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a5988fece15a37f5fde12ed39d2ecda0a">page_extra_</a> = <a class="code" href="classv8_1_1internal_1_1_page.html#a8a6f72dc41510de01d1f0972b75451d0">Page::kNonCodeObjectAreaSize</a> % <a class="code" href="classv8_1_1internal_1_1_fixed_space.html#affb9df8a2b37d45eafd54b72c2cf6c19">object_size_in_bytes</a>;
<a name="l02366"></a>02366   }
<a name="l02367"></a>02367 
<a name="l02368"></a>02368   <span class="comment">// The limit of allocation for a page in this space.</span>
<a name="l02369"></a><a class="code" href="classv8_1_1internal_1_1_fixed_space.html#a5d2e8f88ad120b6b2ee1d3680942785d">02369</a>   <span class="keyword">virtual</span> <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> <a class="code" href="classv8_1_1internal_1_1_fixed_space.html#a5d2e8f88ad120b6b2ee1d3680942785d">PageAllocationLimit</a>(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* page) {
<a name="l02370"></a>02370     <span class="keywordflow">return</span> page-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#ad3898b428d291ef457bc87c2999ff18d">area_end</a>() - <a class="code" href="classv8_1_1internal_1_1_paged_space.html#a5988fece15a37f5fde12ed39d2ecda0a">page_extra_</a>;
<a name="l02371"></a>02371   }
<a name="l02372"></a>02372 
<a name="l02373"></a><a class="code" href="classv8_1_1internal_1_1_fixed_space.html#affb9df8a2b37d45eafd54b72c2cf6c19">02373</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_fixed_space.html#affb9df8a2b37d45eafd54b72c2cf6c19">object_size_in_bytes</a>() { <span class="keywordflow">return</span> object_size_in_bytes_; }
<a name="l02374"></a>02374 
<a name="l02375"></a>02375   <span class="comment">// Prepares for a mark-compact GC.</span>
<a name="l02376"></a>02376   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_fixed_space.html#a4c70af2dca21178b38844c33b9e1793c">PrepareForMarkCompact</a>();
<a name="l02377"></a>02377 
<a name="l02378"></a>02378  <span class="keyword">private</span>:
<a name="l02379"></a>02379   <span class="comment">// The size of objects in this space.</span>
<a name="l02380"></a>02380   <span class="keywordtype">int</span> object_size_in_bytes_;
<a name="l02381"></a>02381 
<a name="l02382"></a>02382   <span class="comment">// The name of this space.</span>
<a name="l02383"></a>02383   <span class="keyword">const</span> <span class="keywordtype">char</span>* name_;
<a name="l02384"></a>02384 };
<a name="l02385"></a>02385 
<a name="l02386"></a>02386 
<a name="l02387"></a>02387 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l02388"></a>02388 <span class="comment">// Old space for all map objects</span>
<a name="l02389"></a>02389 
<a name="l02390"></a><a class="code" href="classv8_1_1internal_1_1_map_space.html">02390</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_map_space.html">MapSpace</a> : <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_fixed_space.html">FixedSpace</a> {
<a name="l02391"></a>02391  <span class="keyword">public</span>:
<a name="l02392"></a>02392   <span class="comment">// Creates a map space object with a maximum capacity.</span>
<a name="l02393"></a><a class="code" href="classv8_1_1internal_1_1_map_space.html#a92cd0878b24aa6f53f31dbeea7d61626">02393</a>   <a class="code" href="classv8_1_1internal_1_1_map_space.html#a92cd0878b24aa6f53f31dbeea7d61626">MapSpace</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_space.html#aa2434e21dfedab7d15316ce88f5ee1a2">heap</a>, intptr_t max_capacity, <a class="code" href="namespacev8_1_1internal.html#aa131d4fd9972fd8dfbec01a9243d9fef">AllocationSpace</a> <span class="keywordtype">id</span>)
<a name="l02394"></a>02394       : <a class="code" href="classv8_1_1internal_1_1_fixed_space.html">FixedSpace</a>(heap, max_capacity, id, <a class="code" href="classv8_1_1internal_1_1_map.html">Map</a>::kSize, <span class="stringliteral">&quot;map&quot;</span>),
<a name="l02395"></a>02395         max_map_space_pages_(<a class="code" href="classv8_1_1internal_1_1_map_space.html#a4c172981cd80bd7ac88778d4359d1e94">kMaxMapPageIndex</a> - 1) {
<a name="l02396"></a>02396   }
<a name="l02397"></a>02397 
<a name="l02398"></a>02398   <span class="comment">// Given an index, returns the page address.</span>
<a name="l02399"></a>02399   <span class="comment">// TODO(1600): this limit is artifical just to keep code compilable</span>
<a name="l02400"></a><a class="code" href="classv8_1_1internal_1_1_map_space.html#a4c172981cd80bd7ac88778d4359d1e94">02400</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_map_space.html#a4c172981cd80bd7ac88778d4359d1e94">kMaxMapPageIndex</a> = 1 &lt;&lt; 16;
<a name="l02401"></a>02401 
<a name="l02402"></a><a class="code" href="classv8_1_1internal_1_1_map_space.html#a817fc2fa29ab9ab92eff266e71244618">02402</a>   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_map_space.html#a817fc2fa29ab9ab92eff266e71244618">RoundSizeDownToObjectAlignment</a>(<span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>) {
<a name="l02403"></a>02403     <span class="keywordflow">if</span> (<a class="code" href="namespacev8_1_1internal.html#ab46d6fb6aab3e552e9fb0ab7fe9212ba">IsPowerOf2</a>(<a class="code" href="classv8_1_1internal_1_1_map.html#aa4e29ae9c6ce51359888cf4a769a1585">Map::kSize</a>)) {
<a name="l02404"></a>02404       <span class="keywordflow">return</span> <a class="code" href="namespacev8_1_1internal.html#a62ab6b040688d278b36c6e932b7820a7">RoundDown</a>(size, <a class="code" href="classv8_1_1internal_1_1_map.html#aa4e29ae9c6ce51359888cf4a769a1585">Map::kSize</a>);
<a name="l02405"></a>02405     } <span class="keywordflow">else</span> {
<a name="l02406"></a>02406       <span class="keywordflow">return</span> (size / <a class="code" href="classv8_1_1internal_1_1_map.html#aa4e29ae9c6ce51359888cf4a769a1585">Map::kSize</a>) * <a class="code" href="classv8_1_1internal_1_1_map.html#aa4e29ae9c6ce51359888cf4a769a1585">Map::kSize</a>;
<a name="l02407"></a>02407     }
<a name="l02408"></a>02408   }
<a name="l02409"></a>02409 
<a name="l02410"></a>02410  <span class="keyword">protected</span>:
<a name="l02411"></a>02411 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l02412"></a>02412 <span class="preprocessor"></span>  <span class="keyword">virtual</span> <span class="keywordtype">void</span> VerifyObject(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* obj);
<a name="l02413"></a>02413 <span class="preprocessor">#endif</span>
<a name="l02414"></a>02414 <span class="preprocessor"></span>
<a name="l02415"></a>02415  <span class="keyword">private</span>:
<a name="l02416"></a>02416   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kMapsPerPage = <a class="code" href="classv8_1_1internal_1_1_page.html#a8a6f72dc41510de01d1f0972b75451d0">Page::kNonCodeObjectAreaSize</a> / <a class="code" href="classv8_1_1internal_1_1_map.html#aa4e29ae9c6ce51359888cf4a769a1585">Map::kSize</a>;
<a name="l02417"></a>02417 
<a name="l02418"></a>02418   <span class="comment">// Do map space compaction if there is a page gap.</span>
<a name="l02419"></a>02419   <span class="keywordtype">int</span> CompactionThreshold() {
<a name="l02420"></a>02420     <span class="keywordflow">return</span> kMapsPerPage * (max_map_space_pages_ - 1);
<a name="l02421"></a>02421   }
<a name="l02422"></a>02422 
<a name="l02423"></a>02423   <span class="keyword">const</span> <span class="keywordtype">int</span> max_map_space_pages_;
<a name="l02424"></a>02424 
<a name="l02425"></a>02425  <span class="keyword">public</span>:
<a name="l02426"></a>02426   <a class="code" href="v8globals_8h.html#acd6c28319b70fd08384c3a21e0a14658">TRACK_MEMORY</a>(<span class="stringliteral">&quot;MapSpace&quot;</span>)
<a name="l02427"></a>02427 };
<a name="l02428"></a>02428 
<a name="l02429"></a>02429 
<a name="l02430"></a>02430 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l02431"></a>02431 <span class="comment">// Old space for all global object property cell objects</span>
<a name="l02432"></a>02432 
<a name="l02433"></a><a class="code" href="classv8_1_1internal_1_1_cell_space.html">02433</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_cell_space.html">CellSpace</a> : <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_fixed_space.html">FixedSpace</a> {
<a name="l02434"></a>02434  <span class="keyword">public</span>:
<a name="l02435"></a>02435   <span class="comment">// Creates a property cell space object with a maximum capacity.</span>
<a name="l02436"></a><a class="code" href="classv8_1_1internal_1_1_cell_space.html#af292af96d3d9665dd2439e46cd3b7e1e">02436</a>   <a class="code" href="classv8_1_1internal_1_1_cell_space.html#af292af96d3d9665dd2439e46cd3b7e1e">CellSpace</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_space.html#aa2434e21dfedab7d15316ce88f5ee1a2">heap</a>, intptr_t max_capacity, <a class="code" href="namespacev8_1_1internal.html#aa131d4fd9972fd8dfbec01a9243d9fef">AllocationSpace</a> <span class="keywordtype">id</span>)
<a name="l02437"></a>02437       : <a class="code" href="classv8_1_1internal_1_1_fixed_space.html">FixedSpace</a>(heap, max_capacity, id, <a class="code" href="classv8_1_1internal_1_1_j_s_global_property_cell.html">JSGlobalPropertyCell</a>::kSize, <span class="stringliteral">&quot;cell&quot;</span>)
<a name="l02438"></a>02438   {}
<a name="l02439"></a>02439 
<a name="l02440"></a><a class="code" href="classv8_1_1internal_1_1_cell_space.html#a8ac54a8232eb57676c12061b7d892911">02440</a>   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_cell_space.html#a8ac54a8232eb57676c12061b7d892911">RoundSizeDownToObjectAlignment</a>(<span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>) {
<a name="l02441"></a>02441     <span class="keywordflow">if</span> (<a class="code" href="namespacev8_1_1internal.html#ab46d6fb6aab3e552e9fb0ab7fe9212ba">IsPowerOf2</a>(<a class="code" href="classv8_1_1internal_1_1_j_s_global_property_cell.html#a7fc5d778ffa2e6bc7e55d7bae3255a9c">JSGlobalPropertyCell::kSize</a>)) {
<a name="l02442"></a>02442       <span class="keywordflow">return</span> <a class="code" href="namespacev8_1_1internal.html#a62ab6b040688d278b36c6e932b7820a7">RoundDown</a>(size, <a class="code" href="classv8_1_1internal_1_1_j_s_global_property_cell.html#a7fc5d778ffa2e6bc7e55d7bae3255a9c">JSGlobalPropertyCell::kSize</a>);
<a name="l02443"></a>02443     } <span class="keywordflow">else</span> {
<a name="l02444"></a>02444       <span class="keywordflow">return</span> (size / <a class="code" href="classv8_1_1internal_1_1_j_s_global_property_cell.html#a7fc5d778ffa2e6bc7e55d7bae3255a9c">JSGlobalPropertyCell::kSize</a>) * <a class="code" href="classv8_1_1internal_1_1_j_s_global_property_cell.html#a7fc5d778ffa2e6bc7e55d7bae3255a9c">JSGlobalPropertyCell::kSize</a>;
<a name="l02445"></a>02445     }
<a name="l02446"></a>02446   }
<a name="l02447"></a>02447 
<a name="l02448"></a>02448  <span class="keyword">protected</span>:
<a name="l02449"></a>02449 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l02450"></a>02450 <span class="preprocessor"></span>  <span class="keyword">virtual</span> <span class="keywordtype">void</span> VerifyObject(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* obj);
<a name="l02451"></a>02451 <span class="preprocessor">#endif</span>
<a name="l02452"></a>02452 <span class="preprocessor"></span>
<a name="l02453"></a>02453  <span class="keyword">public</span>:
<a name="l02454"></a>02454   <a class="code" href="v8globals_8h.html#acd6c28319b70fd08384c3a21e0a14658">TRACK_MEMORY</a>(<span class="stringliteral">&quot;CellSpace&quot;</span>)
<a name="l02455"></a>02455 };
<a name="l02456"></a>02456 
<a name="l02457"></a>02457 
<a name="l02458"></a>02458 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l02459"></a>02459 <span class="comment">// Large objects ( &gt; Page::kMaxHeapObjectSize ) are allocated and managed by</span>
<a name="l02460"></a>02460 <span class="comment">// the large object space. A large object is allocated from OS heap with</span>
<a name="l02461"></a>02461 <span class="comment">// extra padding bytes (Page::kPageSize + Page::kObjectStartOffset).</span>
<a name="l02462"></a>02462 <span class="comment">// A large object always starts at Page::kObjectStartOffset to a page.</span>
<a name="l02463"></a>02463 <span class="comment">// Large objects do not move during garbage collections.</span>
<a name="l02464"></a>02464 
<a name="l02465"></a><a class="code" href="classv8_1_1internal_1_1_large_object_space.html">02465</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_large_object_space.html">LargeObjectSpace</a> : <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_space.html">Space</a> {
<a name="l02466"></a>02466  <span class="keyword">public</span>:
<a name="l02467"></a>02467   <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a675cb708cda096d65809c3f94aa4af8a">LargeObjectSpace</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_space.html#aa2434e21dfedab7d15316ce88f5ee1a2">heap</a>, intptr_t max_capacity, <a class="code" href="namespacev8_1_1internal.html#aa131d4fd9972fd8dfbec01a9243d9fef">AllocationSpace</a> <span class="keywordtype">id</span>);
<a name="l02468"></a><a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a2bf0c4d8e995a38dc87398d77f8d657d">02468</a>   <span class="keyword">virtual</span> <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a2bf0c4d8e995a38dc87398d77f8d657d">~LargeObjectSpace</a>() {}
<a name="l02469"></a>02469 
<a name="l02470"></a>02470   <span class="comment">// Initializes internal data structures.</span>
<a name="l02471"></a>02471   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a0d6d297e876381ad6e2f0d63ed5051ac">SetUp</a>();
<a name="l02472"></a>02472 
<a name="l02473"></a>02473   <span class="comment">// Releases internal resources, frees objects in this space.</span>
<a name="l02474"></a>02474   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a4f1bf837df9444515b16160be0780838">TearDown</a>();
<a name="l02475"></a>02475 
<a name="l02476"></a><a class="code" href="classv8_1_1internal_1_1_large_object_space.html#ab02f8331007158171f81c7f511e33f32">02476</a>   <span class="keyword">static</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#ab02f8331007158171f81c7f511e33f32">ObjectSizeFor</a>(intptr_t chunk_size) {
<a name="l02477"></a>02477     <span class="keywordflow">if</span> (chunk_size &lt;= (<a class="code" href="classv8_1_1internal_1_1_page.html#a573b8add96a07f20176e2bab44f48c20">Page::kPageSize</a> + <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a323d49bf8af911559723fa084503b6e7">Page::kObjectStartOffset</a>)) <span class="keywordflow">return</span> 0;
<a name="l02478"></a>02478     <span class="keywordflow">return</span> chunk_size - <a class="code" href="classv8_1_1internal_1_1_page.html#a573b8add96a07f20176e2bab44f48c20">Page::kPageSize</a> - <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a323d49bf8af911559723fa084503b6e7">Page::kObjectStartOffset</a>;
<a name="l02479"></a>02479   }
<a name="l02480"></a>02480 
<a name="l02481"></a>02481   <span class="comment">// Shared implementation of AllocateRaw, AllocateRawCode and</span>
<a name="l02482"></a>02482   <span class="comment">// AllocateRawFixedArray.</span>
<a name="l02483"></a>02483   <a class="code" href="globals_8h.html#afefbce768b9d0df9c9ebc30dd6d13fed">MUST_USE_RESULT</a> MaybeObject* <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#adca023fc9b2d85b31d16ed099fced80e">AllocateRaw</a>(<span class="keywordtype">int</span> object_size,
<a name="l02484"></a>02484                                            <a class="code" href="namespacev8_1_1internal.html#a1537ade05d756212fcaac97a990b9093">Executability</a> <a class="code" href="classv8_1_1internal_1_1_space.html#aac4582fa58547eaf2339efa4b39b656c">executable</a>);
<a name="l02485"></a>02485 
<a name="l02486"></a>02486   <span class="comment">// Available bytes for objects in this space.</span>
<a name="l02487"></a>02487   <span class="keyword">inline</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a53f1901b3624e3993f5b2bd9dcc0b4c1">Available</a>();
<a name="l02488"></a>02488 
<a name="l02489"></a><a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a9103b60bf78e5b668b3a206cfc6160ae">02489</a>   <span class="keyword">virtual</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a9103b60bf78e5b668b3a206cfc6160ae">Size</a>() {
<a name="l02490"></a>02490     <span class="keywordflow">return</span> size_;
<a name="l02491"></a>02491   }
<a name="l02492"></a>02492 
<a name="l02493"></a><a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a0f22a921a3027f863cab51f0f87f6ec6">02493</a>   <span class="keyword">virtual</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a0f22a921a3027f863cab51f0f87f6ec6">SizeOfObjects</a>() {
<a name="l02494"></a>02494     <span class="keywordflow">return</span> objects_size_;
<a name="l02495"></a>02495   }
<a name="l02496"></a>02496 
<a name="l02497"></a><a class="code" href="classv8_1_1internal_1_1_large_object_space.html#ad785aa0d59494dca8961ab2be41ac656">02497</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#ad785aa0d59494dca8961ab2be41ac656">PageCount</a>() {
<a name="l02498"></a>02498     <span class="keywordflow">return</span> page_count_;
<a name="l02499"></a>02499   }
<a name="l02500"></a>02500 
<a name="l02501"></a>02501   <span class="comment">// Finds an object for a given address, returns Failure::Exception()</span>
<a name="l02502"></a>02502   <span class="comment">// if it is not found. The function iterates through all objects in this</span>
<a name="l02503"></a>02503   <span class="comment">// space, may be slow.</span>
<a name="l02504"></a>02504   MaybeObject* <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a1b8f1fcab95f31ed937c72820dfb8c41">FindObject</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> a);
<a name="l02505"></a>02505 
<a name="l02506"></a>02506   <span class="comment">// Finds a large object page containing the given address, returns NULL</span>
<a name="l02507"></a>02507   <span class="comment">// if such a page doesn&#39;t exist.</span>
<a name="l02508"></a>02508   <a class="code" href="classv8_1_1internal_1_1_large_page.html">LargePage</a>* <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#ab41210b34537c0b31f2ba5935e3fb607">FindPage</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> a);
<a name="l02509"></a>02509 
<a name="l02510"></a>02510   <span class="comment">// Frees unmarked objects.</span>
<a name="l02511"></a>02511   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a074a88a9c1b0045440ae1613d986b294">FreeUnmarkedObjects</a>();
<a name="l02512"></a>02512 
<a name="l02513"></a>02513   <span class="comment">// Checks whether a heap object is in this space; O(1).</span>
<a name="l02514"></a>02514   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a8553cb5254e6f95b8535ec88b8d71f51">Contains</a>(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* obj);
<a name="l02515"></a>02515 
<a name="l02516"></a>02516   <span class="comment">// Checks whether the space is empty.</span>
<a name="l02517"></a><a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a1540b1b446a3ce5210b8b6ab9e02aad0">02517</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a1540b1b446a3ce5210b8b6ab9e02aad0">IsEmpty</a>() { <span class="keywordflow">return</span> first_page_ == <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>; }
<a name="l02518"></a>02518 
<a name="l02519"></a>02519   <span class="comment">// See the comments for ReserveSpace in the Space class.  This has to be</span>
<a name="l02520"></a>02520   <span class="comment">// called after ReserveSpace has been called on the paged spaces, since they</span>
<a name="l02521"></a>02521   <span class="comment">// may use some memory, leaving less for large objects.</span>
<a name="l02522"></a>02522   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#ac52f149878ebbf2aaafb68c1c25bc5bf">ReserveSpace</a>(<span class="keywordtype">int</span> bytes);
<a name="l02523"></a>02523 
<a name="l02524"></a><a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a238ecdf0c67e7880af4afa23e6acec29">02524</a>   <a class="code" href="classv8_1_1internal_1_1_large_page.html">LargePage</a>* <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a238ecdf0c67e7880af4afa23e6acec29">first_page</a>() { <span class="keywordflow">return</span> first_page_; }
<a name="l02525"></a>02525 
<a name="l02526"></a>02526 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l02527"></a>02527 <span class="preprocessor"></span>  <span class="keyword">virtual</span> <span class="keywordtype">void</span> Verify();
<a name="l02528"></a>02528   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="lineprocessor_8cc.html#ae894408d53a5dd2fec4c3e7ea09d5d4b">Print</a>();
<a name="l02529"></a>02529   <span class="keywordtype">void</span> ReportStatistics();
<a name="l02530"></a>02530   <span class="keywordtype">void</span> CollectCodeStatistics();
<a name="l02531"></a>02531 <span class="preprocessor">#endif</span>
<a name="l02532"></a>02532 <span class="preprocessor"></span>  <span class="comment">// Checks whether an address is in the object area in this space.  It</span>
<a name="l02533"></a>02533   <span class="comment">// iterates all objects in the space. May be slow.</span>
<a name="l02534"></a><a class="code" href="classv8_1_1internal_1_1_large_object_space.html#add47982ac44dcedb689a471099578871">02534</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_large_object_space.html#add47982ac44dcedb689a471099578871">SlowContains</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr) { <span class="keywordflow">return</span> !<a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a1b8f1fcab95f31ed937c72820dfb8c41">FindObject</a>(addr)-&gt;IsFailure(); }
<a name="l02535"></a>02535 
<a name="l02536"></a>02536  <span class="keyword">private</span>:
<a name="l02537"></a>02537   intptr_t max_capacity_;
<a name="l02538"></a>02538   <span class="comment">// The head of the linked list of large object chunks.</span>
<a name="l02539"></a>02539   <a class="code" href="classv8_1_1internal_1_1_large_page.html">LargePage</a>* first_page_;
<a name="l02540"></a>02540   intptr_t size_;  <span class="comment">// allocated bytes</span>
<a name="l02541"></a>02541   <span class="keywordtype">int</span> page_count_;  <span class="comment">// number of chunks</span>
<a name="l02542"></a>02542   intptr_t objects_size_;  <span class="comment">// size of objects</span>
<a name="l02543"></a>02543   <span class="comment">// Map MemoryChunk::kAlignment-aligned chunks to large pages covering them</span>
<a name="l02544"></a>02544   <a class="code" href="classv8_1_1internal_1_1_template_hash_map_impl.html">HashMap</a> chunk_map_;
<a name="l02545"></a>02545 
<a name="l02546"></a><a class="code" href="classv8_1_1internal_1_1_large_object_space.html#a3bc21bcf0ff3a8b52c6a491296fce3f2">02546</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_large_object_iterator.html">LargeObjectIterator</a>;
<a name="l02547"></a>02547 
<a name="l02548"></a>02548  <span class="keyword">public</span>:
<a name="l02549"></a>02549   <a class="code" href="v8globals_8h.html#acd6c28319b70fd08384c3a21e0a14658">TRACK_MEMORY</a>(<span class="stringliteral">&quot;LargeObjectSpace&quot;</span>)
<a name="l02550"></a>02550 };
<a name="l02551"></a>02551 
<a name="l02552"></a>02552 
<a name="l02553"></a><a class="code" href="classv8_1_1internal_1_1_large_object_iterator.html">02553</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_large_object_iterator.html">LargeObjectIterator</a>: <span class="keyword">public</span> <a class="code" href="classv8_1_1internal_1_1_object_iterator.html">ObjectIterator</a> {
<a name="l02554"></a>02554  <span class="keyword">public</span>:
<a name="l02555"></a>02555   <span class="keyword">explicit</span> <a class="code" href="classv8_1_1internal_1_1_large_object_iterator.html#ab14565d56a9d243c94e7d9b86f5862aa">LargeObjectIterator</a>(<a class="code" href="classv8_1_1internal_1_1_large_object_space.html">LargeObjectSpace</a>* space);
<a name="l02556"></a>02556   <a class="code" href="classv8_1_1internal_1_1_large_object_iterator.html#ab14565d56a9d243c94e7d9b86f5862aa">LargeObjectIterator</a>(<a class="code" href="classv8_1_1internal_1_1_large_object_space.html">LargeObjectSpace</a>* space, <a class="code" href="namespacev8_1_1internal.html#a4664a14735f154f774c9130702904468">HeapObjectCallback</a> size_func);
<a name="l02557"></a>02557 
<a name="l02558"></a>02558   <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <a class="code" href="classv8_1_1internal_1_1_large_object_iterator.html#a66f8be9d006f95a2db1113d03be859eb">Next</a>();
<a name="l02559"></a>02559 
<a name="l02560"></a>02560   <span class="comment">// implementation of ObjectIterator.</span>
<a name="l02561"></a><a class="code" href="classv8_1_1internal_1_1_large_object_iterator.html#a8a772a4a789f798953d3427f54d1d558">02561</a>   <span class="keyword">virtual</span> <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <a class="code" href="classv8_1_1internal_1_1_large_object_iterator.html#a8a772a4a789f798953d3427f54d1d558">next_object</a>() { <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_large_object_iterator.html#a66f8be9d006f95a2db1113d03be859eb">Next</a>(); }
<a name="l02562"></a>02562 
<a name="l02563"></a>02563  <span class="keyword">private</span>:
<a name="l02564"></a>02564   <a class="code" href="classv8_1_1internal_1_1_large_page.html">LargePage</a>* current_;
<a name="l02565"></a>02565   <a class="code" href="namespacev8_1_1internal.html#a4664a14735f154f774c9130702904468">HeapObjectCallback</a> size_func_;
<a name="l02566"></a>02566 };
<a name="l02567"></a>02567 
<a name="l02568"></a>02568 
<a name="l02569"></a>02569 <span class="comment">// Iterates over the chunks (pages and large object pages) that can contain</span>
<a name="l02570"></a>02570 <span class="comment">// pointers to new space.</span>
<a name="l02571"></a>02571 <span class="keyword">class </span>PointerChunkIterator <a class="code" href="allocation_8h.html#abab81306d90d0b82732d5bed93a0a588">BASE_EMBEDDED</a> {
<a name="l02572"></a>02572  <span class="keyword">public</span>:
<a name="l02573"></a>02573   <span class="keyword">inline</span> <span class="keyword">explicit</span> PointerChunkIterator(Heap* heap);
<a name="l02574"></a>02574 
<a name="l02575"></a>02575   <span class="comment">// Return NULL when the iterator is done.</span>
<a name="l02576"></a><a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#ad4c49fb9b275f0290d35f2cf8927fab7">02576</a>   <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* <a class="code" href="classv8_1_1internal_1_1_b_a_s_e___e_m_b_e_d_d_e_d.html#ad4c49fb9b275f0290d35f2cf8927fab7">next</a>() {
<a name="l02577"></a>02577     <span class="keywordflow">switch</span> (state_) {
<a name="l02578"></a>02578       <span class="keywordflow">case</span> kOldPointerState: {
<a name="l02579"></a>02579         <span class="keywordflow">if</span> (old_pointer_iterator_.has_next()) {
<a name="l02580"></a>02580           <span class="keywordflow">return</span> old_pointer_iterator_.next();
<a name="l02581"></a>02581         }
<a name="l02582"></a>02582         state_ = kMapState;
<a name="l02583"></a>02583         <span class="comment">// Fall through.</span>
<a name="l02584"></a>02584       }
<a name="l02585"></a>02585       <span class="keywordflow">case</span> kMapState: {
<a name="l02586"></a>02586         <span class="keywordflow">if</span> (map_iterator_.has_next()) {
<a name="l02587"></a>02587           <span class="keywordflow">return</span> map_iterator_.next();
<a name="l02588"></a>02588         }
<a name="l02589"></a>02589         state_ = kLargeObjectState;
<a name="l02590"></a>02590         <span class="comment">// Fall through.</span>
<a name="l02591"></a>02591       }
<a name="l02592"></a>02592       <span class="keywordflow">case</span> kLargeObjectState: {
<a name="l02593"></a>02593         <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* heap_object;
<a name="l02594"></a>02594         <span class="keywordflow">do</span> {
<a name="l02595"></a>02595           heap_object = lo_iterator_.Next();
<a name="l02596"></a>02596           <span class="keywordflow">if</span> (heap_object == <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>) {
<a name="l02597"></a>02597             state_ = kFinishedState;
<a name="l02598"></a>02598             <span class="keywordflow">return</span> <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>;
<a name="l02599"></a>02599           }
<a name="l02600"></a>02600           <span class="comment">// Fixed arrays are the only pointer-containing objects in large</span>
<a name="l02601"></a>02601           <span class="comment">// object space.</span>
<a name="l02602"></a>02602         } <span class="keywordflow">while</span> (!heap_object-&gt;IsFixedArray());
<a name="l02603"></a>02603         <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html">MemoryChunk</a>* answer = <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa085e1ca88c6b66f52e3f12dc4c89195">MemoryChunk::FromAddress</a>(heap_object-&gt;<a class="code" href="classv8_1_1internal_1_1_heap_object.html#a6969394bb5c9119fd1a23ec6bedda74d">address</a>());
<a name="l02604"></a>02604         <span class="keywordflow">return</span> answer;
<a name="l02605"></a>02605       }
<a name="l02606"></a>02606       <span class="keywordflow">case</span> kFinishedState:
<a name="l02607"></a>02607         <span class="keywordflow">return</span> <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>;
<a name="l02608"></a>02608       <span class="keywordflow">default</span>:
<a name="l02609"></a>02609         <span class="keywordflow">break</span>;
<a name="l02610"></a>02610     }
<a name="l02611"></a>02611     <a class="code" href="checks_8h.html#a0bc63b24b654ca433be7b97a3edde132">UNREACHABLE</a>();
<a name="l02612"></a>02612     <span class="keywordflow">return</span> <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>;
<a name="l02613"></a>02613   }
<a name="l02614"></a>02614 
<a name="l02615"></a>02615 
<a name="l02616"></a>02616  <span class="keyword">private</span>:
<a name="l02617"></a>02617   <span class="keyword">enum</span> State {
<a name="l02618"></a>02618     kOldPointerState,
<a name="l02619"></a>02619     kMapState,
<a name="l02620"></a>02620     kLargeObjectState,
<a name="l02621"></a>02621     kFinishedState
<a name="l02622"></a>02622   };
<a name="l02623"></a>02623   State state_;
<a name="l02624"></a>02624   PageIterator old_pointer_iterator_;
<a name="l02625"></a>02625   PageIterator map_iterator_;
<a name="l02626"></a>02626   LargeObjectIterator lo_iterator_;
<a name="l02627"></a>02627 };
<a name="l02628"></a>02628 
<a name="l02629"></a>02629 
<a name="l02630"></a>02630 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l02631"></a>02631 <span class="preprocessor"></span><span class="keyword">struct </span>CommentStatistic {
<a name="l02632"></a>02632   <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="namespacev8_1_1internal.html#a879eb4a875af9844e2a2f1b23266ff29">comment</a>;
<a name="l02633"></a>02633   <span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>;
<a name="l02634"></a>02634   <span class="keywordtype">int</span> count;
<a name="l02635"></a>02635   <span class="keywordtype">void</span> Clear() {
<a name="l02636"></a>02636     <a class="code" href="namespacev8_1_1internal.html#a879eb4a875af9844e2a2f1b23266ff29">comment</a> = <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>;
<a name="l02637"></a>02637     <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a> = 0;
<a name="l02638"></a>02638     count = 0;
<a name="l02639"></a>02639   }
<a name="l02640"></a>02640   <span class="comment">// Must be small, since an iteration is used for lookup.</span>
<a name="l02641"></a>02641   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kMaxComments = 64;
<a name="l02642"></a>02642 };
<a name="l02643"></a>02643 <span class="preprocessor">#endif</span>
<a name="l02644"></a>02644 <span class="preprocessor"></span>
<a name="l02645"></a>02645 
<a name="l02646"></a>02646 } }  <span class="comment">// namespace v8::internal</span>
<a name="l02647"></a>02647 
<a name="l02648"></a>02648 <span class="preprocessor">#endif  // V8_SPACES_H_</span>
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="spaces_8h.html">spaces.h</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 13:06:13 for V8 API Reference Guide by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.0 </li>
   </ul>
 </div>


</body>
</html>
