<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>V8 API Reference Guide: /home/codex/apps/v8/src/mark-compact.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="logo.jpg"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">V8 API Reference Guide
   
   </div>
   <div id="projectbrief">If this is out of date tweet @Contra</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('mark-compact_8h.html','');
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/home/codex/apps/v8/src/mark-compact.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="mark-compact_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Copyright 2012 the V8 project authors. All rights reserved.</span>
<a name="l00002"></a>00002 <span class="comment">// Redistribution and use in source and binary forms, with or without</span>
<a name="l00003"></a>00003 <span class="comment">// modification, are permitted provided that the following conditions are</span>
<a name="l00004"></a>00004 <span class="comment">// met:</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">//     * Redistributions of source code must retain the above copyright</span>
<a name="l00007"></a>00007 <span class="comment">//       notice, this list of conditions and the following disclaimer.</span>
<a name="l00008"></a>00008 <span class="comment">//     * Redistributions in binary form must reproduce the above</span>
<a name="l00009"></a>00009 <span class="comment">//       copyright notice, this list of conditions and the following</span>
<a name="l00010"></a>00010 <span class="comment">//       disclaimer in the documentation and/or other materials provided</span>
<a name="l00011"></a>00011 <span class="comment">//       with the distribution.</span>
<a name="l00012"></a>00012 <span class="comment">//     * Neither the name of Google Inc. nor the names of its</span>
<a name="l00013"></a>00013 <span class="comment">//       contributors may be used to endorse or promote products derived</span>
<a name="l00014"></a>00014 <span class="comment">//       from this software without specific prior written permission.</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00017"></a>00017 <span class="comment">// &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00018"></a>00018 <span class="comment">// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00019"></a>00019 <span class="comment">// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00020"></a>00020 <span class="comment">// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00021"></a>00021 <span class="comment">// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00022"></a>00022 <span class="comment">// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00023"></a>00023 <span class="comment">// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00024"></a>00024 <span class="comment">// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00025"></a>00025 <span class="comment">// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00026"></a>00026 <span class="comment">// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#ifndef V8_MARK_COMPACT_H_</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#define V8_MARK_COMPACT_H_</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="compiler-intrinsics_8h.html">compiler-intrinsics.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="spaces_8h.html">spaces.h</a>&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="keyword">namespace </span>v8 {
<a name="l00035"></a>00035 <span class="keyword">namespace </span>internal {
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="comment">// Callback function, returns whether an object is alive. The heap size</span>
<a name="l00038"></a>00038 <span class="comment">// of the object is returned in size. It optionally updates the offset</span>
<a name="l00039"></a>00039 <span class="comment">// to the first live object in the page (only used for old and map objects).</span>
<a name="l00040"></a><a class="code" href="namespacev8_1_1internal.html#a65b18f515f61fe4c87444bfc886d0e13">00040</a> <span class="keyword">typedef</span> bool (*<a class="code" href="namespacev8_1_1internal.html#a65b18f515f61fe4c87444bfc886d0e13">IsAliveFunction</a>)(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* obj, <span class="keywordtype">int</span>* <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>, <span class="keywordtype">int</span>* offset);
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="comment">// Forward declarations.</span>
<a name="l00043"></a>00043 <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_code_flusher.html">CodeFlusher</a>;
<a name="l00044"></a>00044 <span class="keyword">class </span>GCTracer;
<a name="l00045"></a>00045 <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_marking_visitor.html">MarkingVisitor</a>;
<a name="l00046"></a>00046 <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_root_marking_visitor.html">RootMarkingVisitor</a>;
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="classv8_1_1internal_1_1_marking.html">00049</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_marking.html">Marking</a> {
<a name="l00050"></a>00050  <span class="keyword">public</span>:
<a name="l00051"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#aab0b2069bb1f5cd8f99b13e8ca1d1bc1">00051</a>   <span class="keyword">explicit</span> <a class="code" href="classv8_1_1internal_1_1_marking.html#aab0b2069bb1f5cd8f99b13e8ca1d1bc1">Marking</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* heap)
<a name="l00052"></a>00052       : heap_(heap) {
<a name="l00053"></a>00053   }
<a name="l00054"></a>00054 
<a name="l00055"></a>00055   <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> <a class="code" href="classv8_1_1internal_1_1_marking.html#a369bd3931a643801359d6af087508835">MarkBitFrom</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr);
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#a6eb1850f5c853bf876a141516bee59c0">00057</a>   <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> <a class="code" href="classv8_1_1internal_1_1_marking.html#a6eb1850f5c853bf876a141516bee59c0">MarkBitFrom</a>(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* obj) {
<a name="l00058"></a>00058     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_marking.html#a369bd3931a643801359d6af087508835">MarkBitFrom</a>(reinterpret_cast&lt;Address&gt;(obj));
<a name="l00059"></a>00059   }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061   <span class="comment">// Impossible markbits: 01</span>
<a name="l00062"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#a5d5b84d1f33bf8544a82e61861214335">00062</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classv8_1_1internal_1_1_marking.html#a5d5b84d1f33bf8544a82e61861214335">kImpossibleBitPattern</a>;
<a name="l00063"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#a4880077a3934c8d723dd6050a2d3858c">00063</a>   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_marking.html#a4880077a3934c8d723dd6050a2d3858c">IsImpossible</a>(<a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> mark_bit) {
<a name="l00064"></a>00064     <span class="keywordflow">return</span> !mark_bit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a23f900f77547dd64ec77ef413607a0e5">Get</a>() &amp;&amp; mark_bit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#abbf1fd5c72d8abc1e4063e1adca84965">Next</a>().<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a23f900f77547dd64ec77ef413607a0e5">Get</a>();
<a name="l00065"></a>00065   }
<a name="l00066"></a>00066 
<a name="l00067"></a>00067   <span class="comment">// Black markbits: 10 - this is required by the sweeper.</span>
<a name="l00068"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#ae266eec4e20a094664f5e87e47ed9bb6">00068</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classv8_1_1internal_1_1_marking.html#ae266eec4e20a094664f5e87e47ed9bb6">kBlackBitPattern</a>;
<a name="l00069"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#a5021366a7ced4bd60ed4cfb727aae8bf">00069</a>   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_marking.html#a5021366a7ced4bd60ed4cfb727aae8bf">IsBlack</a>(<a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> mark_bit) {
<a name="l00070"></a>00070     <span class="keywordflow">return</span> mark_bit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a23f900f77547dd64ec77ef413607a0e5">Get</a>() &amp;&amp; !mark_bit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#abbf1fd5c72d8abc1e4063e1adca84965">Next</a>().<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a23f900f77547dd64ec77ef413607a0e5">Get</a>();
<a name="l00071"></a>00071   }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073   <span class="comment">// White markbits: 00 - this is required by the mark bit clearer.</span>
<a name="l00074"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#ae1a2d716903841ec64024f8ccaba6d7a">00074</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classv8_1_1internal_1_1_marking.html#ae1a2d716903841ec64024f8ccaba6d7a">kWhiteBitPattern</a>;
<a name="l00075"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#a4cf064d0a735690da64b0488aa688c3b">00075</a>   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_marking.html#a4cf064d0a735690da64b0488aa688c3b">IsWhite</a>(<a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> mark_bit) {
<a name="l00076"></a>00076     <span class="keywordflow">return</span> !mark_bit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a23f900f77547dd64ec77ef413607a0e5">Get</a>();
<a name="l00077"></a>00077   }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079   <span class="comment">// Grey markbits: 11</span>
<a name="l00080"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#a9b85ac4c30060dde97a977e7b6346d55">00080</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classv8_1_1internal_1_1_marking.html#a9b85ac4c30060dde97a977e7b6346d55">kGreyBitPattern</a>;
<a name="l00081"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#a0acb515d069a9e275903d5c71e5c899f">00081</a>   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_marking.html#a0acb515d069a9e275903d5c71e5c899f">IsGrey</a>(<a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> mark_bit) {
<a name="l00082"></a>00082     <span class="keywordflow">return</span> mark_bit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a23f900f77547dd64ec77ef413607a0e5">Get</a>() &amp;&amp; mark_bit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#abbf1fd5c72d8abc1e4063e1adca84965">Next</a>().<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a23f900f77547dd64ec77ef413607a0e5">Get</a>();
<a name="l00083"></a>00083   }
<a name="l00084"></a>00084 
<a name="l00085"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#adf72cb6fc8ec2b6d687ccd9a2eaf26e9">00085</a>   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_marking.html#adf72cb6fc8ec2b6d687ccd9a2eaf26e9">MarkBlack</a>(<a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> mark_bit) {
<a name="l00086"></a>00086     mark_bit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#adda04986b25426477243ca94a756600c">Set</a>();
<a name="l00087"></a>00087     mark_bit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#abbf1fd5c72d8abc1e4063e1adca84965">Next</a>().<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#ae957b539a0baa239a7dba09508735227">Clear</a>();
<a name="l00088"></a>00088   }
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#a28755e16195af8245457c309b60bb677">00090</a>   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_marking.html#a28755e16195af8245457c309b60bb677">BlackToGrey</a>(<a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> markbit) {
<a name="l00091"></a>00091     markbit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#abbf1fd5c72d8abc1e4063e1adca84965">Next</a>().<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#adda04986b25426477243ca94a756600c">Set</a>();
<a name="l00092"></a>00092   }
<a name="l00093"></a>00093 
<a name="l00094"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#ab6c49e8af2442de37a29f67ba15376ed">00094</a>   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_marking.html#ab6c49e8af2442de37a29f67ba15376ed">WhiteToGrey</a>(<a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> markbit) {
<a name="l00095"></a>00095     markbit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#adda04986b25426477243ca94a756600c">Set</a>();
<a name="l00096"></a>00096     markbit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#abbf1fd5c72d8abc1e4063e1adca84965">Next</a>().<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#adda04986b25426477243ca94a756600c">Set</a>();
<a name="l00097"></a>00097   }
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#af2150594ebcfdc9126d0090555fc9b0b">00099</a>   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_marking.html#af2150594ebcfdc9126d0090555fc9b0b">GreyToBlack</a>(<a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> markbit) {
<a name="l00100"></a>00100     markbit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#abbf1fd5c72d8abc1e4063e1adca84965">Next</a>().<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#ae957b539a0baa239a7dba09508735227">Clear</a>();
<a name="l00101"></a>00101   }
<a name="l00102"></a>00102 
<a name="l00103"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#ae9ed1363ec1413b73aa1cb2a26ef469c">00103</a>   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_marking.html#ae9ed1363ec1413b73aa1cb2a26ef469c">BlackToGrey</a>(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* obj) {
<a name="l00104"></a>00104     <a class="code" href="classv8_1_1internal_1_1_marking.html#a28755e16195af8245457c309b60bb677">BlackToGrey</a>(<a class="code" href="classv8_1_1internal_1_1_marking.html#a369bd3931a643801359d6af087508835">MarkBitFrom</a>(obj));
<a name="l00105"></a>00105   }
<a name="l00106"></a>00106 
<a name="l00107"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#ae4f445d9f4fd864e6c347ab54d6555f5">00107</a>   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_marking.html#ae4f445d9f4fd864e6c347ab54d6555f5">AnyToGrey</a>(<a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> markbit) {
<a name="l00108"></a>00108     markbit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#adda04986b25426477243ca94a756600c">Set</a>();
<a name="l00109"></a>00109     markbit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#abbf1fd5c72d8abc1e4063e1adca84965">Next</a>().<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#adda04986b25426477243ca94a756600c">Set</a>();
<a name="l00110"></a>00110   }
<a name="l00111"></a>00111 
<a name="l00112"></a>00112   <span class="comment">// Returns true if the the object whose mark is transferred is marked black.</span>
<a name="l00113"></a>00113   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_marking.html#a3b0181be733e3476008d74e985da5942">TransferMark</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> old_start, <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> new_start);
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span>  <span class="keyword">enum</span> ObjectColor {
<a name="l00117"></a>00117     BLACK_OBJECT,
<a name="l00118"></a>00118     WHITE_OBJECT,
<a name="l00119"></a>00119     GREY_OBJECT,
<a name="l00120"></a>00120     IMPOSSIBLE_COLOR
<a name="l00121"></a>00121   };
<a name="l00122"></a>00122 
<a name="l00123"></a>00123   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* ColorName(ObjectColor color) {
<a name="l00124"></a>00124     <span class="keywordflow">switch</span> (color) {
<a name="l00125"></a>00125       <span class="keywordflow">case</span> BLACK_OBJECT: <span class="keywordflow">return</span> <span class="stringliteral">&quot;black&quot;</span>;
<a name="l00126"></a>00126       <span class="keywordflow">case</span> WHITE_OBJECT: <span class="keywordflow">return</span> <span class="stringliteral">&quot;white&quot;</span>;
<a name="l00127"></a>00127       <span class="keywordflow">case</span> GREY_OBJECT: <span class="keywordflow">return</span> <span class="stringliteral">&quot;grey&quot;</span>;
<a name="l00128"></a>00128       <span class="keywordflow">case</span> IMPOSSIBLE_COLOR: <span class="keywordflow">return</span> <span class="stringliteral">&quot;impossible&quot;</span>;
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130     <span class="keywordflow">return</span> <span class="stringliteral">&quot;error&quot;</span>;
<a name="l00131"></a>00131   }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133   <span class="keyword">static</span> ObjectColor Color(HeapObject* obj) {
<a name="l00134"></a>00134     <span class="keywordflow">return</span> Color(<a class="code" href="classv8_1_1internal_1_1_marking.html#a369bd3931a643801359d6af087508835">Marking::MarkBitFrom</a>(obj));
<a name="l00135"></a>00135   }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137   <span class="keyword">static</span> ObjectColor Color(MarkBit mark_bit) {
<a name="l00138"></a>00138     <span class="keywordflow">if</span> (<a class="code" href="classv8_1_1internal_1_1_marking.html#a5021366a7ced4bd60ed4cfb727aae8bf">IsBlack</a>(mark_bit)) <span class="keywordflow">return</span> BLACK_OBJECT;
<a name="l00139"></a>00139     <span class="keywordflow">if</span> (<a class="code" href="classv8_1_1internal_1_1_marking.html#a4cf064d0a735690da64b0488aa688c3b">IsWhite</a>(mark_bit)) <span class="keywordflow">return</span> WHITE_OBJECT;
<a name="l00140"></a>00140     <span class="keywordflow">if</span> (<a class="code" href="classv8_1_1internal_1_1_marking.html#a0acb515d069a9e275903d5c71e5c899f">IsGrey</a>(mark_bit)) <span class="keywordflow">return</span> GREY_OBJECT;
<a name="l00141"></a>00141     <a class="code" href="checks_8h.html#a0bc63b24b654ca433be7b97a3edde132">UNREACHABLE</a>();
<a name="l00142"></a>00142     <span class="keywordflow">return</span> IMPOSSIBLE_COLOR;
<a name="l00143"></a>00143   }
<a name="l00144"></a>00144 <span class="preprocessor">#endif</span>
<a name="l00145"></a>00145 <span class="preprocessor"></span>
<a name="l00146"></a>00146   <span class="comment">// Returns true if the transferred color is black.</span>
<a name="l00147"></a><a class="code" href="classv8_1_1internal_1_1_marking.html#ace5f36b2741224a982aa385ba26dfa1c">00147</a>   <a class="code" href="classv8_1_1internal_1_1_marking.html#ace5f36b2741224a982aa385ba26dfa1c">INLINE</a>(<span class="keyword">static</span> <span class="keywordtype">bool</span> TransferColor(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* from,
<a name="l00148"></a>00148                                    <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* to)) {
<a name="l00149"></a>00149     <a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> from_mark_bit = <a class="code" href="classv8_1_1internal_1_1_marking.html#a369bd3931a643801359d6af087508835">MarkBitFrom</a>(from);
<a name="l00150"></a>00150     <a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> to_mark_bit = <a class="code" href="classv8_1_1internal_1_1_marking.html#a369bd3931a643801359d6af087508835">MarkBitFrom</a>(to);
<a name="l00151"></a>00151     <span class="keywordtype">bool</span> is_black = <span class="keyword">false</span>;
<a name="l00152"></a>00152     <span class="keywordflow">if</span> (from_mark_bit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a23f900f77547dd64ec77ef413607a0e5">Get</a>()) {
<a name="l00153"></a>00153       to_mark_bit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#adda04986b25426477243ca94a756600c">Set</a>();
<a name="l00154"></a>00154       is_black = <span class="keyword">true</span>;  <span class="comment">// Looks black so far.</span>
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156     <span class="keywordflow">if</span> (from_mark_bit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#abbf1fd5c72d8abc1e4063e1adca84965">Next</a>().<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#a23f900f77547dd64ec77ef413607a0e5">Get</a>()) {
<a name="l00157"></a>00157       to_mark_bit.<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#abbf1fd5c72d8abc1e4063e1adca84965">Next</a>().<a class="code" href="classv8_1_1internal_1_1_mark_bit.html#adda04986b25426477243ca94a756600c">Set</a>();
<a name="l00158"></a>00158       is_black = <span class="keyword">false</span>;  <span class="comment">// Was actually gray.</span>
<a name="l00159"></a>00159     }
<a name="l00160"></a>00160     <span class="keywordflow">return</span> is_black;
<a name="l00161"></a>00161   }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163  <span class="keyword">private</span>:
<a name="l00164"></a>00164   <a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* heap_;
<a name="l00165"></a>00165 };
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 <span class="comment">// ----------------------------------------------------------------------------</span>
<a name="l00168"></a>00168 <span class="comment">// Marking deque for tracing live objects.</span>
<a name="l00169"></a>00169 
<a name="l00170"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html">00170</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_marking_deque.html">MarkingDeque</a> {
<a name="l00171"></a>00171  <span class="keyword">public</span>:
<a name="l00172"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#abbd093fd5413561c4d07e9fa3f8009c2">00172</a>   <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#abbd093fd5413561c4d07e9fa3f8009c2">MarkingDeque</a>()
<a name="l00173"></a>00173       : array_(<a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>), top_(0), bottom_(0), mask_(0), overflowed_(<a class="code" href="namespacev8_1_1internal.html#a95f596a3bb6a493b8b63c451e07f7bb6">false</a>) { }
<a name="l00174"></a>00174 
<a name="l00175"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#af5d7193fa995621fb0b9f4f2549cc298">00175</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#af5d7193fa995621fb0b9f4f2549cc298">Initialize</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> low, <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> high) {
<a name="l00176"></a>00176     <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>** obj_low = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>**<span class="keyword">&gt;</span>(low);
<a name="l00177"></a>00177     <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>** obj_high = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>**<span class="keyword">&gt;</span>(high);
<a name="l00178"></a>00178     array_ = obj_low;
<a name="l00179"></a>00179     mask_ = <a class="code" href="namespacev8_1_1internal.html#a83972d62713cfe96c0efbb513f990ad1">RoundDownToPowerOf2</a>(static_cast&lt;int&gt;(obj_high - obj_low)) - 1;
<a name="l00180"></a>00180     top_ = bottom_ = 0;
<a name="l00181"></a>00181     overflowed_ = <span class="keyword">false</span>;
<a name="l00182"></a>00182   }
<a name="l00183"></a>00183 
<a name="l00184"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#ab5e1a83987a1c90e8825edd088b347ba">00184</a>   <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#ab5e1a83987a1c90e8825edd088b347ba">IsFull</a>() { <span class="keywordflow">return</span> ((top_ + 1) &amp; mask_) == bottom_; }
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#a3db4c132717260d8f1bb00f84dec60c4">00186</a>   <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#a3db4c132717260d8f1bb00f84dec60c4">IsEmpty</a>() { <span class="keywordflow">return</span> top_ == bottom_; }
<a name="l00187"></a>00187 
<a name="l00188"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#aed9511b7f9a72c37952c78a43186b7ab">00188</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#aed9511b7f9a72c37952c78a43186b7ab">overflowed</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> overflowed_; }
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#a8eb2c854d43bd1640aabeae46782213f">00190</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#a8eb2c854d43bd1640aabeae46782213f">ClearOverflowed</a>() { overflowed_ = <span class="keyword">false</span>; }
<a name="l00191"></a>00191 
<a name="l00192"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#aaf705ef6c1f7892caf563780a8f238e7">00192</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#aaf705ef6c1f7892caf563780a8f238e7">SetOverflowed</a>() { overflowed_ = <span class="keyword">true</span>; }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194   <span class="comment">// Push the (marked) object on the marking stack if there is room,</span>
<a name="l00195"></a>00195   <span class="comment">// otherwise mark the object as overflowed and wait for a rescan of the</span>
<a name="l00196"></a>00196   <span class="comment">// heap.</span>
<a name="l00197"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#ad87566817a37b6ec6b7c0bd423cfa970">00197</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#ad87566817a37b6ec6b7c0bd423cfa970">PushBlack</a>(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <span class="keywordtype">object</span>) {
<a name="l00198"></a>00198     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(object-&gt;IsHeapObject());
<a name="l00199"></a>00199     <span class="keywordflow">if</span> (<a class="code" href="classv8_1_1internal_1_1_marking_deque.html#ab5e1a83987a1c90e8825edd088b347ba">IsFull</a>()) {
<a name="l00200"></a>00200       <a class="code" href="classv8_1_1internal_1_1_marking.html#a28755e16195af8245457c309b60bb677">Marking::BlackToGrey</a>(<span class="keywordtype">object</span>);
<a name="l00201"></a>00201       <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3c349f01d0fce3625ff9ce9cb6d6c272">MemoryChunk::IncrementLiveBytesFromGC</a>(object-&gt;<a class="code" href="classv8_1_1internal_1_1_heap_object.html#a6969394bb5c9119fd1a23ec6bedda74d">address</a>(), -<span class="keywordtype">object</span>-&gt;Size());
<a name="l00202"></a>00202       <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#aaf705ef6c1f7892caf563780a8f238e7">SetOverflowed</a>();
<a name="l00203"></a>00203     } <span class="keywordflow">else</span> {
<a name="l00204"></a>00204       array_[top_] = object;
<a name="l00205"></a>00205       top_ = ((top_ + 1) &amp; mask_);
<a name="l00206"></a>00206     }
<a name="l00207"></a>00207   }
<a name="l00208"></a>00208 
<a name="l00209"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#a957f9f930c85de06c63477c3d104fe16">00209</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#a957f9f930c85de06c63477c3d104fe16">PushGrey</a>(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <span class="keywordtype">object</span>) {
<a name="l00210"></a>00210     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(object-&gt;IsHeapObject());
<a name="l00211"></a>00211     <span class="keywordflow">if</span> (<a class="code" href="classv8_1_1internal_1_1_marking_deque.html#ab5e1a83987a1c90e8825edd088b347ba">IsFull</a>()) {
<a name="l00212"></a>00212       <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#aaf705ef6c1f7892caf563780a8f238e7">SetOverflowed</a>();
<a name="l00213"></a>00213     } <span class="keywordflow">else</span> {
<a name="l00214"></a>00214       array_[top_] = object;
<a name="l00215"></a>00215       top_ = ((top_ + 1) &amp; mask_);
<a name="l00216"></a>00216     }
<a name="l00217"></a>00217   }
<a name="l00218"></a>00218 
<a name="l00219"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#a4e687863a9a3605f3653865c22d0a189">00219</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#a4e687863a9a3605f3653865c22d0a189">Pop</a>() {
<a name="l00220"></a>00220     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(!<a class="code" href="classv8_1_1internal_1_1_marking_deque.html#a3db4c132717260d8f1bb00f84dec60c4">IsEmpty</a>());
<a name="l00221"></a>00221     top_ = ((top_ - 1) &amp; mask_);
<a name="l00222"></a>00222     <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <span class="keywordtype">object</span> = array_[top_];
<a name="l00223"></a>00223     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(object-&gt;IsHeapObject());
<a name="l00224"></a>00224     <span class="keywordflow">return</span> object;
<a name="l00225"></a>00225   }
<a name="l00226"></a>00226 
<a name="l00227"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#a722ea5f054100c35c079fe360e5e3808">00227</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#a722ea5f054100c35c079fe360e5e3808">UnshiftGrey</a>(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <span class="keywordtype">object</span>) {
<a name="l00228"></a>00228     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(object-&gt;IsHeapObject());
<a name="l00229"></a>00229     <span class="keywordflow">if</span> (<a class="code" href="classv8_1_1internal_1_1_marking_deque.html#ab5e1a83987a1c90e8825edd088b347ba">IsFull</a>()) {
<a name="l00230"></a>00230       <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#aaf705ef6c1f7892caf563780a8f238e7">SetOverflowed</a>();
<a name="l00231"></a>00231     } <span class="keywordflow">else</span> {
<a name="l00232"></a>00232       bottom_ = ((bottom_ - 1) &amp; mask_);
<a name="l00233"></a>00233       array_[bottom_] = object;
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235   }
<a name="l00236"></a>00236 
<a name="l00237"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#a8d1cf672feabff20cadd8da892f0740d">00237</a>   <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>** <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#a8d1cf672feabff20cadd8da892f0740d">array</a>() { <span class="keywordflow">return</span> array_; }
<a name="l00238"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#a46a7dfe5e3f40980ce8bf4063c916a59">00238</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#a46a7dfe5e3f40980ce8bf4063c916a59">bottom</a>() { <span class="keywordflow">return</span> bottom_; }
<a name="l00239"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#ae325db1ff1dc01cb9a1db5716a798921">00239</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#ae325db1ff1dc01cb9a1db5716a798921">top</a>() { <span class="keywordflow">return</span> top_; }
<a name="l00240"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#af37d39d98dae02aaeecd4b373bba0242">00240</a>   <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#af37d39d98dae02aaeecd4b373bba0242">mask</a>() { <span class="keywordflow">return</span> mask_; }
<a name="l00241"></a><a class="code" href="classv8_1_1internal_1_1_marking_deque.html#ac716a38b90666b5561f528b5b11e5b21">00241</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#ac716a38b90666b5561f528b5b11e5b21">set_top</a>(<span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#ae325db1ff1dc01cb9a1db5716a798921">top</a>) { top_ = <a class="code" href="classv8_1_1internal_1_1_marking_deque.html#ae325db1ff1dc01cb9a1db5716a798921">top</a>; }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243  <span class="keyword">private</span>:
<a name="l00244"></a>00244   <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>** array_;
<a name="l00245"></a>00245   <span class="comment">// array_[(top - 1) &amp; mask_] is the top element in the deque.  The Deque is</span>
<a name="l00246"></a>00246   <span class="comment">// empty when top_ == bottom_.  It is full when top_ + 1 == bottom</span>
<a name="l00247"></a>00247   <span class="comment">// (mod mask + 1).</span>
<a name="l00248"></a>00248   <span class="keywordtype">int</span> top_;
<a name="l00249"></a>00249   <span class="keywordtype">int</span> bottom_;
<a name="l00250"></a>00250   <span class="keywordtype">int</span> mask_;
<a name="l00251"></a>00251   <span class="keywordtype">bool</span> overflowed_;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253   DISALLOW_COPY_AND_ASSIGN(<a class="code" href="classv8_1_1internal_1_1_marking_deque.html">MarkingDeque</a>);
<a name="l00254"></a>00254 };
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 
<a name="l00257"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer_allocator.html">00257</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_slots_buffer_allocator.html">SlotsBufferAllocator</a> {
<a name="l00258"></a>00258  <span class="keyword">public</span>:
<a name="l00259"></a>00259   <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>* <a class="code" href="classv8_1_1internal_1_1_slots_buffer_allocator.html#a2fefab655c1d05f9cfb371f15e12de7a">AllocateBuffer</a>(<a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>* next_buffer);
<a name="l00260"></a>00260   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer_allocator.html#a35672c8184b41c8f087f90048aadf8af">DeallocateBuffer</a>(<a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>* buffer);
<a name="l00261"></a>00261 
<a name="l00262"></a>00262   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer_allocator.html#aafd5e927d76a0e44297b8d6935fd5d66">DeallocateChain</a>(<a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>** buffer_address);
<a name="l00263"></a>00263 };
<a name="l00264"></a>00264 
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 <span class="comment">// SlotsBuffer records a sequence of slots that has to be updated</span>
<a name="l00267"></a>00267 <span class="comment">// after live objects were relocated from evacuation candidates.</span>
<a name="l00268"></a>00268 <span class="comment">// All slots are either untyped or typed:</span>
<a name="l00269"></a>00269 <span class="comment">//    - Untyped slots are expected to contain a tagged object pointer.</span>
<a name="l00270"></a>00270 <span class="comment">//      They are recorded by an address.</span>
<a name="l00271"></a>00271 <span class="comment">//    - Typed slots are expected to contain an encoded pointer to a heap</span>
<a name="l00272"></a>00272 <span class="comment">//      object where the way of encoding depends on the type of the slot.</span>
<a name="l00273"></a>00273 <span class="comment">//      They are recorded as a pair (SlotType, slot address).</span>
<a name="l00274"></a>00274 <span class="comment">// We assume that zero-page is never mapped this allows us to distinguish</span>
<a name="l00275"></a>00275 <span class="comment">// untyped slots from typed slots during iteration by a simple comparison:</span>
<a name="l00276"></a>00276 <span class="comment">// if element of slots buffer is less than NUMBER_OF_SLOT_TYPES then it</span>
<a name="l00277"></a>00277 <span class="comment">// is the first element of typed slot&#39;s pair.</span>
<a name="l00278"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">00278</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a> {
<a name="l00279"></a>00279  <span class="keyword">public</span>:
<a name="l00280"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a8813d7e57d2a8679bd9733905e91151a">00280</a>   <span class="keyword">typedef</span> <a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>** <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a8813d7e57d2a8679bd9733905e91151a">ObjectSlot</a>;
<a name="l00281"></a>00281 
<a name="l00282"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a97d043e5cb5ee9a9f9b708879682fcd3">00282</a>   <span class="keyword">explicit</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a97d043e5cb5ee9a9f9b708879682fcd3">SlotsBuffer</a>(<a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>* next_buffer)
<a name="l00283"></a>00283       : idx_(0), chain_length_(1), next_(next_buffer) {
<a name="l00284"></a>00284     <span class="keywordflow">if</span> (next_ != <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>) {
<a name="l00285"></a>00285       chain_length_ = next_-&gt;chain_length_ + 1;
<a name="l00286"></a>00286     }
<a name="l00287"></a>00287   }
<a name="l00288"></a>00288 
<a name="l00289"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#ac96e895b76bacd29ce89c4d087b37083">00289</a>   <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#ac96e895b76bacd29ce89c4d087b37083">~SlotsBuffer</a>() {
<a name="l00290"></a>00290   }
<a name="l00291"></a>00291 
<a name="l00292"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a7d231385ef0e30a91c60c1730e5adb41">00292</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a7d231385ef0e30a91c60c1730e5adb41">Add</a>(<a class="code" href="classv8_1_1internal_1_1_object.html">ObjectSlot</a> slot) {
<a name="l00293"></a>00293     <a class="code" href="checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(0 &lt;= idx_ &amp;&amp; idx_ &lt; <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a3cfc5b07a7886b74d5c392e5f29b8805">kNumberOfElements</a>);
<a name="l00294"></a>00294     slots_[idx_++] = slot;
<a name="l00295"></a>00295   }
<a name="l00296"></a>00296 
<a name="l00297"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fc">00297</a>   <span class="keyword">enum</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fc">SlotType</a> {
<a name="l00298"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fcacf46a7de61b5e04f8d99f3a136bec82f">00298</a>     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fcacf46a7de61b5e04f8d99f3a136bec82f">EMBEDDED_OBJECT_SLOT</a>,
<a name="l00299"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fca1afbbbde31f50a7376961844631d32ca">00299</a>     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fca1afbbbde31f50a7376961844631d32ca">RELOCATED_CODE_OBJECT</a>,
<a name="l00300"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fca5e82af38825639c14d713e23e8c6e228">00300</a>     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fca5e82af38825639c14d713e23e8c6e228">CODE_TARGET_SLOT</a>,
<a name="l00301"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fca5760fa56e12fa0941c5a889904644f35">00301</a>     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fca5760fa56e12fa0941c5a889904644f35">CODE_ENTRY_SLOT</a>,
<a name="l00302"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fcab636e1c743755da72e98a13f5ba2dceb">00302</a>     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fcab636e1c743755da72e98a13f5ba2dceb">DEBUG_TARGET_SLOT</a>,
<a name="l00303"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fca32fc09af4de62a1c027cad1b94bea1cc">00303</a>     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fca32fc09af4de62a1c027cad1b94bea1cc">JS_RETURN_SLOT</a>,
<a name="l00304"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fca0b98599df5d5cd6d7587917f86509c4f">00304</a>     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fca0b98599df5d5cd6d7587917f86509c4f">NUMBER_OF_SLOT_TYPES</a>
<a name="l00305"></a>00305   };
<a name="l00306"></a>00306 
<a name="l00307"></a>00307   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#aef4ff91d577ec9aa8e6b25caccf280b0">UpdateSlots</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* heap);
<a name="l00308"></a>00308 
<a name="l00309"></a>00309   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a3fc353b657d3f092b08d5449915f81ed">UpdateSlotsWithFilter</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* heap);
<a name="l00310"></a>00310 
<a name="l00311"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a39b938524a3d2a4d142aeedcf8fb3fc5">00311</a>   <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>* <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a39b938524a3d2a4d142aeedcf8fb3fc5">next</a>() { <span class="keywordflow">return</span> next_; }
<a name="l00312"></a>00312 
<a name="l00313"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a9be3e313604ee68eecf5c3b66b141d12">00313</a>   <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a9be3e313604ee68eecf5c3b66b141d12">SizeOfChain</a>(<a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>* buffer) {
<a name="l00314"></a>00314     <span class="keywordflow">if</span> (buffer == <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>) <span class="keywordflow">return</span> 0;
<a name="l00315"></a>00315     <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(buffer-&gt;idx_ +
<a name="l00316"></a>00316                             (buffer-&gt;chain_length_ - 1) * <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a3cfc5b07a7886b74d5c392e5f29b8805">kNumberOfElements</a>);
<a name="l00317"></a>00317   }
<a name="l00318"></a>00318 
<a name="l00319"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a0d30164702981e571dadac206d2e7182">00319</a>   <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a0d30164702981e571dadac206d2e7182">IsFull</a>() {
<a name="l00320"></a>00320     <span class="keywordflow">return</span> idx_ == <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a3cfc5b07a7886b74d5c392e5f29b8805">kNumberOfElements</a>;
<a name="l00321"></a>00321   }
<a name="l00322"></a>00322 
<a name="l00323"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a300599863743654fe055d088e0fee70e">00323</a>   <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a300599863743654fe055d088e0fee70e">HasSpaceForTypedSlot</a>() {
<a name="l00324"></a>00324     <span class="keywordflow">return</span> idx_ &lt; <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a3cfc5b07a7886b74d5c392e5f29b8805">kNumberOfElements</a> - 1;
<a name="l00325"></a>00325   }
<a name="l00326"></a>00326 
<a name="l00327"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a96bb92ee0cf97d2da2d807b1efb7bab5">00327</a>   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a96bb92ee0cf97d2da2d807b1efb7bab5">UpdateSlotsRecordedIn</a>(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* heap,
<a name="l00328"></a>00328                                     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>* buffer,
<a name="l00329"></a>00329                                     <span class="keywordtype">bool</span> code_slots_filtering_required) {
<a name="l00330"></a>00330     <span class="keywordflow">while</span> (buffer != <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>) {
<a name="l00331"></a>00331       <span class="keywordflow">if</span> (code_slots_filtering_required) {
<a name="l00332"></a>00332         buffer-&gt;<a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a3fc353b657d3f092b08d5449915f81ed">UpdateSlotsWithFilter</a>(heap);
<a name="l00333"></a>00333       } <span class="keywordflow">else</span> {
<a name="l00334"></a>00334         buffer-&gt;<a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#aef4ff91d577ec9aa8e6b25caccf280b0">UpdateSlots</a>(heap);
<a name="l00335"></a>00335       }
<a name="l00336"></a>00336       buffer = buffer-&gt;<a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a39b938524a3d2a4d142aeedcf8fb3fc5">next</a>();
<a name="l00337"></a>00337     }
<a name="l00338"></a>00338   }
<a name="l00339"></a>00339 
<a name="l00340"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a8e18be0f621788ba48e9d5edfc6aef7e">00340</a>   <span class="keyword">enum</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a8e18be0f621788ba48e9d5edfc6aef7e">AdditionMode</a> {
<a name="l00341"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a8e18be0f621788ba48e9d5edfc6aef7eaed4a73bac5704c907a844a14f19b7b60">00341</a>     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a8e18be0f621788ba48e9d5edfc6aef7eaed4a73bac5704c907a844a14f19b7b60">FAIL_ON_OVERFLOW</a>,
<a name="l00342"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a8e18be0f621788ba48e9d5edfc6aef7ea4aad5bc32318fb4554642002cd6a51dd">00342</a>     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a8e18be0f621788ba48e9d5edfc6aef7ea4aad5bc32318fb4554642002cd6a51dd">IGNORE_OVERFLOW</a>
<a name="l00343"></a>00343   };
<a name="l00344"></a>00344 
<a name="l00345"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a4421e74591538f027121a831a0e19f91">00345</a>   <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a4421e74591538f027121a831a0e19f91">ChainLengthThresholdReached</a>(<a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>* buffer) {
<a name="l00346"></a>00346     <span class="keywordflow">return</span> buffer != <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a> &amp;&amp; buffer-&gt;chain_length_ &gt;= kChainLengthThreshold;
<a name="l00347"></a>00347   }
<a name="l00348"></a>00348 
<a name="l00349"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#aca8d2f7ed26a28f93ff12f90c601bd92">00349</a>   <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#aca8d2f7ed26a28f93ff12f90c601bd92">AddTo</a>(<a class="code" href="classv8_1_1internal_1_1_slots_buffer_allocator.html">SlotsBufferAllocator</a>* allocator,
<a name="l00350"></a>00350                     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>** buffer_address,
<a name="l00351"></a>00351                     <a class="code" href="classv8_1_1internal_1_1_object.html">ObjectSlot</a> slot,
<a name="l00352"></a>00352                     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a8e18be0f621788ba48e9d5edfc6aef7e">AdditionMode</a> mode) {
<a name="l00353"></a>00353     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>* buffer = *buffer_address;
<a name="l00354"></a>00354     <span class="keywordflow">if</span> (buffer == <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a> || buffer-&gt;<a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a0d30164702981e571dadac206d2e7182">IsFull</a>()) {
<a name="l00355"></a>00355       <span class="keywordflow">if</span> (mode == <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a8e18be0f621788ba48e9d5edfc6aef7eaed4a73bac5704c907a844a14f19b7b60">FAIL_ON_OVERFLOW</a> &amp;&amp; <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a4421e74591538f027121a831a0e19f91">ChainLengthThresholdReached</a>(buffer)) {
<a name="l00356"></a>00356         allocator-&gt;<a class="code" href="classv8_1_1internal_1_1_slots_buffer_allocator.html#aafd5e927d76a0e44297b8d6935fd5d66">DeallocateChain</a>(buffer_address);
<a name="l00357"></a>00357         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00358"></a>00358       }
<a name="l00359"></a>00359       buffer = allocator-&gt;<a class="code" href="classv8_1_1internal_1_1_slots_buffer_allocator.html#a2fefab655c1d05f9cfb371f15e12de7a">AllocateBuffer</a>(buffer);
<a name="l00360"></a>00360       *buffer_address = buffer;
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362     buffer-&gt;<a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a7d231385ef0e30a91c60c1730e5adb41">Add</a>(slot);
<a name="l00363"></a>00363     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00364"></a>00364   }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366   <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#ad4a581106c8e5573fab990aa023ae616">IsTypedSlot</a>(<a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a8813d7e57d2a8679bd9733905e91151a">ObjectSlot</a> slot);
<a name="l00367"></a>00367 
<a name="l00368"></a>00368   <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#aca8d2f7ed26a28f93ff12f90c601bd92">AddTo</a>(<a class="code" href="classv8_1_1internal_1_1_slots_buffer_allocator.html">SlotsBufferAllocator</a>* allocator,
<a name="l00369"></a>00369                     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>** buffer_address,
<a name="l00370"></a>00370                     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a457ba6a78a748693139f41f930a465fc">SlotType</a> <a class="code" href="namespacev8_1_1internal.html#af325044478c719d86be7dc7a017f250a">type</a>,
<a name="l00371"></a>00371                     <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> addr,
<a name="l00372"></a>00372                     <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a8e18be0f621788ba48e9d5edfc6aef7e">AdditionMode</a> mode);
<a name="l00373"></a>00373 
<a name="l00374"></a><a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a3cfc5b07a7886b74d5c392e5f29b8805">00374</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a3cfc5b07a7886b74d5c392e5f29b8805">kNumberOfElements</a> = 1021;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376  <span class="keyword">private</span>:
<a name="l00377"></a>00377   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kChainLengthThreshold = 15;
<a name="l00378"></a>00378 
<a name="l00379"></a>00379   intptr_t idx_;
<a name="l00380"></a>00380   intptr_t chain_length_;
<a name="l00381"></a>00381   <a class="code" href="classv8_1_1internal_1_1_slots_buffer.html">SlotsBuffer</a>* next_;
<a name="l00382"></a>00382   <a class="code" href="classv8_1_1internal_1_1_object.html">ObjectSlot</a> slots_[<a class="code" href="classv8_1_1internal_1_1_slots_buffer.html#a3cfc5b07a7886b74d5c392e5f29b8805">kNumberOfElements</a>];
<a name="l00383"></a>00383 };
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 <span class="comment">// Defined in isolate.h.</span>
<a name="l00387"></a>00387 <span class="keyword">class </span>ThreadLocalTop;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 <span class="comment">// -------------------------------------------------------------------------</span>
<a name="l00391"></a>00391 <span class="comment">// Mark-Compact collector</span>
<a name="l00392"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html">00392</a> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html">MarkCompactCollector</a> {
<a name="l00393"></a>00393  <span class="keyword">public</span>:
<a name="l00394"></a>00394   <span class="comment">// Type of functions to compute forwarding addresses of objects in</span>
<a name="l00395"></a>00395   <span class="comment">// compacted spaces.  Given an object and its size, return a (non-failure)</span>
<a name="l00396"></a>00396   <span class="comment">// Object* that will be the object after forwarding.  There is a separate</span>
<a name="l00397"></a>00397   <span class="comment">// allocation function for each (compactable) space based on the location</span>
<a name="l00398"></a>00398   <span class="comment">// of the object before compaction.</span>
<a name="l00399"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a63ef6d9743bb2da86bad396144923303">00399</a>   <span class="keyword">typedef</span> MaybeObject* (*AllocationFunction)(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#aaa73def4a7ae4b9a7db82e5a32c0b33a">heap</a>,
<a name="l00400"></a>00400                                              <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* object,
<a name="l00401"></a>00401                                              <span class="keywordtype">int</span> object_size);
<a name="l00402"></a>00402 
<a name="l00403"></a>00403   <span class="comment">// Type of functions to encode the forwarding address for an object.</span>
<a name="l00404"></a>00404   <span class="comment">// Given the object, its size, and the new (non-failure) object it will be</span>
<a name="l00405"></a>00405   <span class="comment">// forwarded to, encode the forwarding address.  For paged spaces, the</span>
<a name="l00406"></a>00406   <span class="comment">// &#39;offset&#39; input/output parameter contains the offset of the forwarded</span>
<a name="l00407"></a>00407   <span class="comment">// object from the forwarding address of the previous live object in the</span>
<a name="l00408"></a>00408   <span class="comment">// page as input, and is updated to contain the offset to be used for the</span>
<a name="l00409"></a>00409   <span class="comment">// next live object in the same page.  For spaces using a different</span>
<a name="l00410"></a>00410   <span class="comment">// encoding (i.e., contiguous spaces), the offset parameter is ignored.</span>
<a name="l00411"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a7fd6377363836e666bfd69956cc158db">00411</a>   <span class="keyword">typedef</span> void (*<a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a7fd6377363836e666bfd69956cc158db">EncodingFunction</a>)(<a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#aaa73def4a7ae4b9a7db82e5a32c0b33a">heap</a>,
<a name="l00412"></a>00412                                    <a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* old_object,
<a name="l00413"></a>00413                                    <span class="keywordtype">int</span> object_size,
<a name="l00414"></a>00414                                    <a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>* new_object,
<a name="l00415"></a>00415                                    <span class="keywordtype">int</span>* offset);
<a name="l00416"></a>00416 
<a name="l00417"></a>00417   <span class="comment">// Type of functions to process non-live objects.</span>
<a name="l00418"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a98d6678afed12265b7fead023b0afc12">00418</a>   <span class="keyword">typedef</span> void (*<a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a98d6678afed12265b7fead023b0afc12">ProcessNonLiveFunction</a>)(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* object, <a class="code" href="classv8_1_1internal_1_1_isolate.html">Isolate</a>* isolate);
<a name="l00419"></a>00419 
<a name="l00420"></a>00420   <span class="comment">// Pointer to member function, used in IterateLiveObjects.</span>
<a name="l00421"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#abe99c07d42fb2de4b5e26c47d3a83ef6">00421</a>   <span class="keyword">typedef</span> int (<a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html">MarkCompactCollector</a>::*<a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#abe99c07d42fb2de4b5e26c47d3a83ef6">LiveObjectCallback</a>)(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* obj);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423   <span class="comment">// Set the global flags, it must be called before Prepare to take effect.</span>
<a name="l00424"></a>00424   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#af291e8de942e57021ad7b63b1226f855">SetFlags</a>(<span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#a9b4b1c68517c9a42918bc7079187ec70">flags</a>);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#ab188f2bac8de14eac502672e08f84313">Initialize</a>();
<a name="l00427"></a>00427 
<a name="l00428"></a>00428   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a3cf7f62c683dbc4b89a6f71b7d60cc37">CollectEvacuationCandidates</a>(<a class="code" href="classv8_1_1internal_1_1_paged_space.html">PagedSpace</a>* space);
<a name="l00429"></a>00429 
<a name="l00430"></a>00430   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a0859ca3d00c450bb2c5a354add25fff4">AddEvacuationCandidate</a>(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* p);
<a name="l00431"></a>00431 
<a name="l00432"></a>00432   <span class="comment">// Prepares for GC by resetting relocation info in old and map spaces and</span>
<a name="l00433"></a>00433   <span class="comment">// choosing spaces to compact.</span>
<a name="l00434"></a>00434   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a5196da90cc753eab5d73d64ed1a4441f">Prepare</a>(GCTracer* <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a22aacc43fa0a1121b2046fc2760715a4">tracer</a>);
<a name="l00435"></a>00435 
<a name="l00436"></a>00436   <span class="comment">// Performs a global garbage collection.</span>
<a name="l00437"></a>00437   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a82db441b928fc8abc959d3d4c7c18906">CollectGarbage</a>();
<a name="l00438"></a>00438 
<a name="l00439"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a7a79738350a55626346c35c63f5a135a">00439</a>   <span class="keyword">enum</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a7a79738350a55626346c35c63f5a135a">CompactionMode</a> {
<a name="l00440"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a7a79738350a55626346c35c63f5a135aae0c16a368a2d6f3e8b6e27ed7ac0a1e2">00440</a>     <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a7a79738350a55626346c35c63f5a135aae0c16a368a2d6f3e8b6e27ed7ac0a1e2">INCREMENTAL_COMPACTION</a>,
<a name="l00441"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a7a79738350a55626346c35c63f5a135aa021a9d0cb4a3ec816c19a6563f0d76cb">00441</a>     <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a7a79738350a55626346c35c63f5a135aa021a9d0cb4a3ec816c19a6563f0d76cb">NON_INCREMENTAL_COMPACTION</a>
<a name="l00442"></a>00442   };
<a name="l00443"></a>00443 
<a name="l00444"></a>00444   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#aab1645449be7dca6f0a6eff2be78ddc7">StartCompaction</a>(<a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a7a79738350a55626346c35c63f5a135a">CompactionMode</a> mode);
<a name="l00445"></a>00445 
<a name="l00446"></a>00446   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a4fdf8ab05e0f2a84df042b4197fcda89">AbortCompaction</a>();
<a name="l00447"></a>00447 
<a name="l00448"></a>00448   <span class="comment">// During a full GC, there is a stack-allocated GCTracer that is used for</span>
<a name="l00449"></a>00449   <span class="comment">// bookkeeping information.  Return a pointer to that tracer.</span>
<a name="l00450"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a22aacc43fa0a1121b2046fc2760715a4">00450</a>   GCTracer* <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a22aacc43fa0a1121b2046fc2760715a4">tracer</a>() { <span class="keywordflow">return</span> tracer_; }
<a name="l00451"></a>00451 
<a name="l00452"></a>00452 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00453"></a>00453 <span class="preprocessor"></span>  <span class="comment">// Checks whether performing mark-compact collection.</span>
<a name="l00454"></a>00454   <span class="keywordtype">bool</span> in_use() { <span class="keywordflow">return</span> state_ &gt; PREPARE_GC; }
<a name="l00455"></a>00455   <span class="keywordtype">bool</span> are_map_pointers_encoded() { <span class="keywordflow">return</span> state_ == UPDATE_POINTERS; }
<a name="l00456"></a>00456 <span class="preprocessor">#endif</span>
<a name="l00457"></a>00457 <span class="preprocessor"></span>
<a name="l00458"></a>00458   <span class="comment">// Determine type of object and emit deletion log event.</span>
<a name="l00459"></a>00459   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a5cb95beb29262d44dbfe555b77dd5680">ReportDeleteIfNeeded</a>(HeapObject* obj, Isolate* isolate);
<a name="l00460"></a>00460 
<a name="l00461"></a>00461   <span class="comment">// Distinguishable invalid map encodings (for single word and multiple words)</span>
<a name="l00462"></a>00462   <span class="comment">// that indicate free regions.</span>
<a name="l00463"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a989d906363b12dc6feede76fa0ca2f6e">00463</a>   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a989d906363b12dc6feede76fa0ca2f6e">kSingleFreeEncoding</a> = 0;
<a name="l00464"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a9540a3611cc50501fecfffa4f6f85e66">00464</a>   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a9540a3611cc50501fecfffa4f6f85e66">kMultiFreeEncoding</a> = 1;
<a name="l00465"></a>00465 
<a name="l00466"></a>00466   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a5270a5fd9f88e28b30ce5022c343ad79">IsMarked</a>(<a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>* obj);
<a name="l00467"></a>00467 
<a name="l00468"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#aaa73def4a7ae4b9a7db82e5a32c0b33a">00468</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#aaa73def4a7ae4b9a7db82e5a32c0b33a">heap</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> heap_; }
<a name="l00469"></a>00469 
<a name="l00470"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a203799662355152e55edf0e31cb9e93b">00470</a>   <a class="code" href="classv8_1_1internal_1_1_code_flusher.html">CodeFlusher</a>* <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a203799662355152e55edf0e31cb9e93b">code_flusher</a>() { <span class="keywordflow">return</span> code_flusher_; }
<a name="l00471"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#afcf4e7d0c281330a79337b0e85a657f1">00471</a>   <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#afcf4e7d0c281330a79337b0e85a657f1">is_code_flushing_enabled</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> code_flusher_ != <a class="code" href="namespacev8_1_1internal.html#a5c7edd76ae40d6f54c6a23a039b15551">NULL</a>; }
<a name="l00472"></a>00472   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a5b675c4ab77e929a3eac258acd4c6a88">EnableCodeFlushing</a>(<span class="keywordtype">bool</span> enable);
<a name="l00473"></a>00473 
<a name="l00474"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a4208440e0e3cf27dd077c1babf4e7d1e">00474</a>   <span class="keyword">enum</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a4208440e0e3cf27dd077c1babf4e7d1e">SweeperType</a> {
<a name="l00475"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a4208440e0e3cf27dd077c1babf4e7d1ea311b46a0a1c7a138da49dda89ab32b45">00475</a>     <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a4208440e0e3cf27dd077c1babf4e7d1ea311b46a0a1c7a138da49dda89ab32b45">CONSERVATIVE</a>,
<a name="l00476"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a4208440e0e3cf27dd077c1babf4e7d1ead20c16ebe44eb488e8d1994c8de20d6c">00476</a>     <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a4208440e0e3cf27dd077c1babf4e7d1ead20c16ebe44eb488e8d1994c8de20d6c">LAZY_CONSERVATIVE</a>,
<a name="l00477"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a4208440e0e3cf27dd077c1babf4e7d1ea17671a44fb16e41677afe0d95fddf9e4">00477</a>     <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a4208440e0e3cf27dd077c1babf4e7d1ea17671a44fb16e41677afe0d95fddf9e4">PRECISE</a>
<a name="l00478"></a>00478   };
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00481"></a>00481 <span class="preprocessor"></span>  <span class="keywordtype">void</span> VerifyMarkbitsAreClean();
<a name="l00482"></a>00482   <span class="keyword">static</span> <span class="keywordtype">void</span> VerifyMarkbitsAreClean(<a class="code" href="classv8_1_1internal_1_1_paged_space.html">PagedSpace</a>* space);
<a name="l00483"></a>00483   <span class="keyword">static</span> <span class="keywordtype">void</span> VerifyMarkbitsAreClean(<a class="code" href="classv8_1_1internal_1_1_new_space.html">NewSpace</a>* space);
<a name="l00484"></a>00484 <span class="preprocessor">#endif</span>
<a name="l00485"></a>00485 <span class="preprocessor"></span>
<a name="l00486"></a>00486   <span class="comment">// Sweep a single page from the given space conservatively.</span>
<a name="l00487"></a>00487   <span class="comment">// Return a number of reclaimed bytes.</span>
<a name="l00488"></a>00488   <span class="keyword">static</span> intptr_t <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#ae9bed569a1fcf61adac0af8f3a30866e">SweepConservatively</a>(<a class="code" href="classv8_1_1internal_1_1_paged_space.html">PagedSpace</a>* space, <a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* p);
<a name="l00489"></a>00489 
<a name="l00490"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#af24a0bd4ed6b047f07760ebe716c899f">00490</a>   <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#af24a0bd4ed6b047f07760ebe716c899f">INLINE</a>(<span class="keyword">static</span> <span class="keywordtype">bool</span> ShouldSkipEvacuationSlotRecording(<a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>** anchor)) {
<a name="l00491"></a>00491     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa085e1ca88c6b66f52e3f12dc4c89195">Page::FromAddress</a>(reinterpret_cast&lt;Address&gt;(anchor))-&gt;
<a name="l00492"></a>00492         ShouldSkipEvacuationSlotRecording();
<a name="l00493"></a>00493   }
<a name="l00494"></a>00494 
<a name="l00495"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#aa76e8cef7393277d9efeb6df20d77e44">00495</a>   <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#aa76e8cef7393277d9efeb6df20d77e44">INLINE</a>(<span class="keyword">static</span> <span class="keywordtype">bool</span> ShouldSkipEvacuationSlotRecording(<a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>* host)) {
<a name="l00496"></a>00496     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa085e1ca88c6b66f52e3f12dc4c89195">Page::FromAddress</a>(reinterpret_cast&lt;Address&gt;(host))-&gt;
<a name="l00497"></a>00497         ShouldSkipEvacuationSlotRecording();
<a name="l00498"></a>00498   }
<a name="l00499"></a>00499 
<a name="l00500"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a6f531de7acd29e99abfb8d177b847924">00500</a>   <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a6f531de7acd29e99abfb8d177b847924">INLINE</a>(<span class="keyword">static</span> <span class="keywordtype">bool</span> IsOnEvacuationCandidate(<a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>* obj)) {
<a name="l00501"></a>00501     <span class="keywordflow">return</span> <a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aa085e1ca88c6b66f52e3f12dc4c89195">Page::FromAddress</a>(reinterpret_cast&lt;Address&gt;(obj))-&gt;
<a name="l00502"></a>00502         IsEvacuationCandidate();
<a name="l00503"></a>00503   }
<a name="l00504"></a>00504 
<a name="l00505"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#ae1959504e50193ba37af7668ff8070bd">00505</a>   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#ae1959504e50193ba37af7668ff8070bd">EvictEvacuationCandidate</a>(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* page) {
<a name="l00506"></a>00506     <span class="keywordflow">if</span> (FLAG_trace_fragmentation) {
<a name="l00507"></a>00507       <a class="code" href="namespacev8_1_1internal.html#a983357dee691fc08ce75ee9b0c132ca7">PrintF</a>(<span class="stringliteral">&quot;Page %p is too popular. Disabling evacuation.\n&quot;</span>,
<a name="l00508"></a>00508              reinterpret_cast&lt;void*&gt;(page));
<a name="l00509"></a>00509     }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511     <span class="comment">// TODO(gc) If all evacuation candidates are too popular we</span>
<a name="l00512"></a>00512     <span class="comment">// should stop slots recording entirely.</span>
<a name="l00513"></a>00513     page-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#aeb98d8bef24dbe7562ac6e8ca9dee860">ClearEvacuationCandidate</a>();
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     <span class="comment">// We were not collecting slots on this page that point</span>
<a name="l00516"></a>00516     <span class="comment">// to other evacuation candidates thus we have to</span>
<a name="l00517"></a>00517     <span class="comment">// rescan the page after evacuation to discover and update all</span>
<a name="l00518"></a>00518     <span class="comment">// pointers to evacuated objects.</span>
<a name="l00519"></a>00519     <span class="keywordflow">if</span> (page-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a3e6f1fb7b24f1662eed90feefb5152ad">owner</a>()-&gt;<a class="code" href="classv8_1_1internal_1_1_space.html#a934a26e2755bc4f0d8060cfb3d051cdf">identity</a>() == <a class="code" href="namespacev8_1_1internal.html#aa131d4fd9972fd8dfbec01a9243d9fefa62073c29d159d7d4c6cc290f34d5ae0f">OLD_DATA_SPACE</a>) {
<a name="l00520"></a>00520       evacuation_candidates_.<a class="code" href="classv8_1_1internal_1_1_list.html#a301b954cd7954452fca522c542f2d69a">RemoveElement</a>(page);
<a name="l00521"></a>00521     } <span class="keywordflow">else</span> {
<a name="l00522"></a>00522       page-&gt;<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a79b86e423956219c0a048b3dbcff6abb">SetFlag</a>(<a class="code" href="classv8_1_1internal_1_1_memory_chunk.html#a7ec096f924ab4515fe8ae00e9e50af78a03d3c648f27f66bfc8c521871d04a443">Page::RESCAN_ON_EVACUATION</a>);
<a name="l00523"></a>00523     }
<a name="l00524"></a>00524   }
<a name="l00525"></a>00525 
<a name="l00526"></a>00526   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#ab6bff480bec48b0297e4947f5a123e9a">RecordRelocSlot</a>(RelocInfo* rinfo, <a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>* target);
<a name="l00527"></a>00527   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a602aebe4c374d33d26a5293260f75862">RecordCodeEntrySlot</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> slot, <a class="code" href="classv8_1_1internal_1_1_code.html">Code</a>* target);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529   <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#af24a0bd4ed6b047f07760ebe716c899f">INLINE</a>(<span class="keywordtype">void</span> RecordSlot(<a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>** anchor_slot, <a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>** slot, <a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>* <span class="keywordtype">object</span>));
<a name="l00530"></a>00530 
<a name="l00531"></a>00531   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#ad073c11492ccc90c8b9ed8a609acc6ba">MigrateObject</a>(<a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> dst,
<a name="l00532"></a>00532                      <a class="code" href="namespacev8_1_1internal.html#a91038d135bfd26927f854d52e3e54379">Address</a> src,
<a name="l00533"></a>00533                      <span class="keywordtype">int</span> <a class="code" href="namespacev8_1_1internal.html#abf135806b67fe9f9a823fbbbe25de86b">size</a>,
<a name="l00534"></a>00534                      <a class="code" href="namespacev8_1_1internal.html#aa131d4fd9972fd8dfbec01a9243d9fef">AllocationSpace</a> to_old_space);
<a name="l00535"></a>00535 
<a name="l00536"></a>00536   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a316fd91097b8a402abff80ccdaefe037">TryPromoteObject</a>(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <span class="keywordtype">object</span>, <span class="keywordtype">int</span> object_size);
<a name="l00537"></a>00537 
<a name="l00538"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#ace09e12d8da5fb6f3298db67f47e2a40">00538</a>   <span class="keyword">inline</span> <a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>* <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#ace09e12d8da5fb6f3298db67f47e2a40">encountered_weak_maps</a>() { <span class="keywordflow">return</span> encountered_weak_maps_; }
<a name="l00539"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a7e354f2ffcf84fff60aae6641ac6bd62">00539</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a7e354f2ffcf84fff60aae6641ac6bd62">set_encountered_weak_maps</a>(<a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>* weak_map) {
<a name="l00540"></a>00540     encountered_weak_maps_ = weak_map;
<a name="l00541"></a>00541   }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a4f40c177911ba479f9a77055eb2fb8d1">InvalidateCode</a>(<a class="code" href="classv8_1_1internal_1_1_code.html">Code</a>* <a class="code" href="namespacev8_1_1internal.html#a7500f5d92d93409e192a671bd4425496">code</a>);
<a name="l00544"></a>00544 
<a name="l00545"></a>00545   <span class="keywordtype">void</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a81ef3665225ecd159a7437f0299f58df">ClearMarkbits</a>();
<a name="l00546"></a>00546 
<a name="l00547"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a0b458d0ecfae6203659aed16207872c1">00547</a>   <span class="keywordtype">bool</span> <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a0b458d0ecfae6203659aed16207872c1">is_compacting</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> compacting_; }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549  <span class="keyword">private</span>:
<a name="l00550"></a>00550   <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html">MarkCompactCollector</a>();
<a name="l00551"></a>00551   ~<a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html">MarkCompactCollector</a>();
<a name="l00552"></a>00552 
<a name="l00553"></a>00553   <span class="keywordtype">bool</span> MarkInvalidatedCode();
<a name="l00554"></a>00554   <span class="keywordtype">void</span> RemoveDeadInvalidatedCode();
<a name="l00555"></a>00555   <span class="keywordtype">void</span> ProcessInvalidatedCode(ObjectVisitor* visitor);
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00559"></a>00559 <span class="preprocessor"></span>  <span class="keyword">enum</span> CollectorState {
<a name="l00560"></a>00560     IDLE,
<a name="l00561"></a>00561     PREPARE_GC,
<a name="l00562"></a>00562     MARK_LIVE_OBJECTS,
<a name="l00563"></a>00563     SWEEP_SPACES,
<a name="l00564"></a>00564     ENCODE_FORWARDING_ADDRESSES,
<a name="l00565"></a>00565     UPDATE_POINTERS,
<a name="l00566"></a>00566     RELOCATE_OBJECTS
<a name="l00567"></a>00567   };
<a name="l00568"></a>00568 
<a name="l00569"></a>00569   <span class="comment">// The current stage of the collector.</span>
<a name="l00570"></a>00570   CollectorState state_;
<a name="l00571"></a>00571 <span class="preprocessor">#endif</span>
<a name="l00572"></a>00572 <span class="preprocessor"></span>
<a name="l00573"></a>00573   <span class="comment">// Global flag that forces sweeping to be precise, so we can traverse the</span>
<a name="l00574"></a>00574   <span class="comment">// heap.</span>
<a name="l00575"></a>00575   <span class="keywordtype">bool</span> sweep_precisely_;
<a name="l00576"></a>00576 
<a name="l00577"></a>00577   <span class="keywordtype">bool</span> reduce_memory_footprint_;
<a name="l00578"></a>00578 
<a name="l00579"></a>00579   <span class="keywordtype">bool</span> abort_incremental_marking_;
<a name="l00580"></a>00580 
<a name="l00581"></a>00581   <span class="comment">// True if we are collecting slots to perform evacuation from evacuation</span>
<a name="l00582"></a>00582   <span class="comment">// candidates.</span>
<a name="l00583"></a>00583   <span class="keywordtype">bool</span> compacting_;
<a name="l00584"></a>00584 
<a name="l00585"></a>00585   <span class="keywordtype">bool</span> was_marked_incrementally_;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587   <span class="keywordtype">bool</span> collect_maps_;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589   <span class="keywordtype">bool</span> flush_monomorphic_ics_;
<a name="l00590"></a>00590 
<a name="l00591"></a>00591   <span class="comment">// A pointer to the current stack-allocated GC tracer object during a full</span>
<a name="l00592"></a>00592   <span class="comment">// collection (NULL before and after).</span>
<a name="l00593"></a>00593   GCTracer* tracer_;
<a name="l00594"></a>00594 
<a name="l00595"></a>00595   SlotsBufferAllocator slots_buffer_allocator_;
<a name="l00596"></a>00596 
<a name="l00597"></a>00597   SlotsBuffer* migration_slots_buffer_;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599   <span class="comment">// Finishes GC, performs heap verification if enabled.</span>
<a name="l00600"></a>00600   <span class="keywordtype">void</span> Finish();
<a name="l00601"></a>00601 
<a name="l00602"></a>00602   <span class="comment">// -----------------------------------------------------------------------</span>
<a name="l00603"></a>00603   <span class="comment">// Phase 1: Marking live objects.</span>
<a name="l00604"></a>00604   <span class="comment">//</span>
<a name="l00605"></a>00605   <span class="comment">//  Before: The heap has been prepared for garbage collection by</span>
<a name="l00606"></a>00606   <span class="comment">//          MarkCompactCollector::Prepare() and is otherwise in its</span>
<a name="l00607"></a>00607   <span class="comment">//          normal state.</span>
<a name="l00608"></a>00608   <span class="comment">//</span>
<a name="l00609"></a>00609   <span class="comment">//   After: Live objects are marked and non-live objects are unmarked.</span>
<a name="l00610"></a>00610 
<a name="l00611"></a>00611 
<a name="l00612"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a0a89e89941e2601a090655513f208c65">00612</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_root_marking_visitor.html">RootMarkingVisitor</a>;
<a name="l00613"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#aa5f956fda2410280ba71af311ce66f19">00613</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_marking_visitor.html">MarkingVisitor</a>;
<a name="l00614"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#ad42cef5e8ec0ae50c8206f6a850897b2">00614</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_static_marking_visitor.html">StaticMarkingVisitor</a>;
<a name="l00615"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#ae54d71dfeafa81873f1e1d749c21c21a">00615</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_code_marking_visitor.html">CodeMarkingVisitor</a>;
<a name="l00616"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a23f88014b71dfc97f4d6ae7d753f0bd0">00616</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_shared_function_info_marking_visitor.html">SharedFunctionInfoMarkingVisitor</a>;
<a name="l00617"></a>00617 
<a name="l00618"></a>00618   <span class="comment">// Mark non-optimize code for functions inlined into the given optimized</span>
<a name="l00619"></a>00619   <span class="comment">// code. This will prevent it from being flushed.</span>
<a name="l00620"></a>00620   <span class="keywordtype">void</span> MarkInlinedFunctionsCode(<a class="code" href="classv8_1_1internal_1_1_code.html">Code</a>* <a class="code" href="namespacev8_1_1internal.html#a7500f5d92d93409e192a671bd4425496">code</a>);
<a name="l00621"></a>00621 
<a name="l00622"></a>00622   <span class="comment">// Mark code objects that are active on the stack to prevent them</span>
<a name="l00623"></a>00623   <span class="comment">// from being flushed.</span>
<a name="l00624"></a>00624   <span class="keywordtype">void</span> PrepareThreadForCodeFlushing(<a class="code" href="classv8_1_1internal_1_1_isolate.html">Isolate</a>* isolate, ThreadLocalTop* top);
<a name="l00625"></a>00625 
<a name="l00626"></a>00626   <span class="keywordtype">void</span> PrepareForCodeFlushing();
<a name="l00627"></a>00627 
<a name="l00628"></a>00628   <span class="comment">// Marking operations for objects reachable from roots.</span>
<a name="l00629"></a>00629   <span class="keywordtype">void</span> MarkLiveObjects();
<a name="l00630"></a>00630 
<a name="l00631"></a>00631   <span class="keywordtype">void</span> AfterMarking();
<a name="l00632"></a>00632 
<a name="l00633"></a>00633   <span class="comment">// Marks the object black and pushes it on the marking stack.</span>
<a name="l00634"></a>00634   <span class="comment">// This is for non-incremental marking.</span>
<a name="l00635"></a>00635   <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#af24a0bd4ed6b047f07760ebe716c899f">INLINE</a>(<span class="keywordtype">void</span> MarkObject(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* obj, <a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> mark_bit));
<a name="l00636"></a>00636 
<a name="l00637"></a>00637   <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#af24a0bd4ed6b047f07760ebe716c899f">INLINE</a>(<span class="keywordtype">bool</span> MarkObjectWithoutPush(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* <span class="keywordtype">object</span>));
<a name="l00638"></a>00638   <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#af24a0bd4ed6b047f07760ebe716c899f">INLINE</a>(<span class="keywordtype">void</span> MarkObjectAndPush(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* value));
<a name="l00639"></a>00639 
<a name="l00640"></a>00640   <span class="comment">// Marks the object black.  This is for non-incremental marking.</span>
<a name="l00641"></a>00641   <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#af24a0bd4ed6b047f07760ebe716c899f">INLINE</a>(<span class="keywordtype">void</span> SetMark(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* obj, <a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> mark_bit));
<a name="l00642"></a>00642 
<a name="l00643"></a>00643   <span class="keywordtype">void</span> ProcessNewlyMarkedObject(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* obj);
<a name="l00644"></a>00644 
<a name="l00645"></a>00645   <span class="comment">// Creates back pointers for all map transitions, stores them in</span>
<a name="l00646"></a>00646   <span class="comment">// the prototype field.  The original prototype pointers are restored</span>
<a name="l00647"></a>00647   <span class="comment">// in ClearNonLiveTransitions().  All JSObject maps</span>
<a name="l00648"></a>00648   <span class="comment">// connected by map transitions have the same prototype object, which</span>
<a name="l00649"></a>00649   <span class="comment">// is why we can use this field temporarily for back pointers.</span>
<a name="l00650"></a>00650   <span class="keywordtype">void</span> CreateBackPointers();
<a name="l00651"></a>00651 
<a name="l00652"></a>00652   <span class="comment">// Mark a Map and its DescriptorArray together, skipping transitions.</span>
<a name="l00653"></a>00653   <span class="keywordtype">void</span> MarkMapContents(<a class="code" href="classv8_1_1internal_1_1_map.html">Map</a>* map);
<a name="l00654"></a>00654   <span class="keywordtype">void</span> MarkAccessorPairSlot(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* accessors, <span class="keywordtype">int</span> offset);
<a name="l00655"></a>00655   <span class="keywordtype">void</span> MarkDescriptorArray(<a class="code" href="classv8_1_1internal_1_1_descriptor_array.html">DescriptorArray</a>* descriptors);
<a name="l00656"></a>00656 
<a name="l00657"></a>00657   <span class="comment">// Mark the heap roots and all objects reachable from them.</span>
<a name="l00658"></a>00658   <span class="keywordtype">void</span> MarkRoots(<a class="code" href="classv8_1_1internal_1_1_root_marking_visitor.html">RootMarkingVisitor</a>* visitor);
<a name="l00659"></a>00659 
<a name="l00660"></a>00660   <span class="comment">// Mark the symbol table specially.  References to symbols from the</span>
<a name="l00661"></a>00661   <span class="comment">// symbol table are weak.</span>
<a name="l00662"></a>00662   <span class="keywordtype">void</span> MarkSymbolTable();
<a name="l00663"></a>00663 
<a name="l00664"></a>00664   <span class="comment">// Mark objects in object groups that have at least one object in the</span>
<a name="l00665"></a>00665   <span class="comment">// group marked.</span>
<a name="l00666"></a>00666   <span class="keywordtype">void</span> MarkObjectGroups();
<a name="l00667"></a>00667 
<a name="l00668"></a>00668   <span class="comment">// Mark objects in implicit references groups if their parent object</span>
<a name="l00669"></a>00669   <span class="comment">// is marked.</span>
<a name="l00670"></a>00670   <span class="keywordtype">void</span> MarkImplicitRefGroups();
<a name="l00671"></a>00671 
<a name="l00672"></a>00672   <span class="comment">// Mark all objects which are reachable due to host application</span>
<a name="l00673"></a>00673   <span class="comment">// logic like object groups or implicit references&#39; groups.</span>
<a name="l00674"></a>00674   <span class="keywordtype">void</span> ProcessExternalMarking();
<a name="l00675"></a>00675 
<a name="l00676"></a>00676   <span class="comment">// Mark objects reachable (transitively) from objects in the marking stack</span>
<a name="l00677"></a>00677   <span class="comment">// or overflowed in the heap.</span>
<a name="l00678"></a>00678   <span class="keywordtype">void</span> ProcessMarkingDeque();
<a name="l00679"></a>00679 
<a name="l00680"></a>00680   <span class="comment">// Mark objects reachable (transitively) from objects in the marking</span>
<a name="l00681"></a>00681   <span class="comment">// stack.  This function empties the marking stack, but may leave</span>
<a name="l00682"></a>00682   <span class="comment">// overflowed objects in the heap, in which case the marking stack&#39;s</span>
<a name="l00683"></a>00683   <span class="comment">// overflow flag will be set.</span>
<a name="l00684"></a>00684   <span class="keywordtype">void</span> EmptyMarkingDeque();
<a name="l00685"></a>00685 
<a name="l00686"></a>00686   <span class="comment">// Refill the marking stack with overflowed objects from the heap.  This</span>
<a name="l00687"></a>00687   <span class="comment">// function either leaves the marking stack full or clears the overflow</span>
<a name="l00688"></a>00688   <span class="comment">// flag on the marking stack.</span>
<a name="l00689"></a>00689   <span class="keywordtype">void</span> RefillMarkingDeque();
<a name="l00690"></a>00690 
<a name="l00691"></a>00691   <span class="comment">// After reachable maps have been marked process per context object</span>
<a name="l00692"></a>00692   <span class="comment">// literal map caches removing unmarked entries.</span>
<a name="l00693"></a>00693   <span class="keywordtype">void</span> ProcessMapCaches();
<a name="l00694"></a>00694 
<a name="l00695"></a>00695   <span class="comment">// Callback function for telling whether the object *p is an unmarked</span>
<a name="l00696"></a>00696   <span class="comment">// heap object.</span>
<a name="l00697"></a>00697   <span class="keyword">static</span> <span class="keywordtype">bool</span> IsUnmarkedHeapObject(<a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>** p);
<a name="l00698"></a>00698 
<a name="l00699"></a>00699   <span class="comment">// Map transitions from a live map to a dead map must be killed.</span>
<a name="l00700"></a>00700   <span class="comment">// We replace them with a null descriptor, with the same key.</span>
<a name="l00701"></a>00701   <span class="keywordtype">void</span> ClearNonLiveTransitions();
<a name="l00702"></a>00702   <span class="keywordtype">void</span> ClearNonLivePrototypeTransitions(<a class="code" href="classv8_1_1internal_1_1_map.html">Map</a>* map);
<a name="l00703"></a>00703   <span class="keywordtype">void</span> ClearNonLiveMapTransitions(<a class="code" href="classv8_1_1internal_1_1_map.html">Map</a>* map, <a class="code" href="classv8_1_1internal_1_1_mark_bit.html">MarkBit</a> map_mark);
<a name="l00704"></a>00704 
<a name="l00705"></a>00705   <span class="comment">// Marking detaches initial maps from SharedFunctionInfo objects</span>
<a name="l00706"></a>00706   <span class="comment">// to make this reference weak. We need to reattach initial maps</span>
<a name="l00707"></a>00707   <span class="comment">// back after collection. This is either done during</span>
<a name="l00708"></a>00708   <span class="comment">// ClearNonLiveTransitions pass or by calling this function.</span>
<a name="l00709"></a>00709   <span class="keywordtype">void</span> ReattachInitialMaps();
<a name="l00710"></a>00710 
<a name="l00711"></a>00711   <span class="comment">// Mark all values associated with reachable keys in weak maps encountered</span>
<a name="l00712"></a>00712   <span class="comment">// so far.  This might push new object or even new weak maps onto the</span>
<a name="l00713"></a>00713   <span class="comment">// marking stack.</span>
<a name="l00714"></a>00714   <span class="keywordtype">void</span> ProcessWeakMaps();
<a name="l00715"></a>00715 
<a name="l00716"></a>00716   <span class="comment">// After all reachable objects have been marked those weak map entries</span>
<a name="l00717"></a>00717   <span class="comment">// with an unreachable key are removed from all encountered weak maps.</span>
<a name="l00718"></a>00718   <span class="comment">// The linked list of all encountered weak maps is destroyed.</span>
<a name="l00719"></a>00719   <span class="keywordtype">void</span> ClearWeakMaps();
<a name="l00720"></a>00720 
<a name="l00721"></a>00721   <span class="comment">// -----------------------------------------------------------------------</span>
<a name="l00722"></a>00722   <span class="comment">// Phase 2: Sweeping to clear mark bits and free non-live objects for</span>
<a name="l00723"></a>00723   <span class="comment">// a non-compacting collection.</span>
<a name="l00724"></a>00724   <span class="comment">//</span>
<a name="l00725"></a>00725   <span class="comment">//  Before: Live objects are marked and non-live objects are unmarked.</span>
<a name="l00726"></a>00726   <span class="comment">//</span>
<a name="l00727"></a>00727   <span class="comment">//   After: Live objects are unmarked, non-live regions have been added to</span>
<a name="l00728"></a>00728   <span class="comment">//          their space&#39;s free list. Active eden semispace is compacted by</span>
<a name="l00729"></a>00729   <span class="comment">//          evacuation.</span>
<a name="l00730"></a>00730   <span class="comment">//</span>
<a name="l00731"></a>00731 
<a name="l00732"></a>00732   <span class="comment">// If we are not compacting the heap, we simply sweep the spaces except</span>
<a name="l00733"></a>00733   <span class="comment">// for the large object space, clearing mark bits and adding unmarked</span>
<a name="l00734"></a>00734   <span class="comment">// regions to each space&#39;s free list.</span>
<a name="l00735"></a>00735   <span class="keywordtype">void</span> SweepSpaces();
<a name="l00736"></a>00736 
<a name="l00737"></a>00737   <span class="keywordtype">void</span> EvacuateNewSpace();
<a name="l00738"></a>00738 
<a name="l00739"></a>00739   <span class="keywordtype">void</span> EvacuateLiveObjectsFromPage(<a class="code" href="classv8_1_1internal_1_1_page.html">Page</a>* p);
<a name="l00740"></a>00740 
<a name="l00741"></a>00741   <span class="keywordtype">void</span> EvacuatePages();
<a name="l00742"></a>00742 
<a name="l00743"></a>00743   <span class="keywordtype">void</span> EvacuateNewSpaceAndCandidates();
<a name="l00744"></a>00744 
<a name="l00745"></a>00745   <span class="keywordtype">void</span> SweepSpace(<a class="code" href="classv8_1_1internal_1_1_paged_space.html">PagedSpace</a>* space, <a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a4208440e0e3cf27dd077c1babf4e7d1e">SweeperType</a> sweeper);
<a name="l00746"></a>00746 
<a name="l00747"></a>00747 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00748"></a>00748 <span class="preprocessor"></span>  <span class="keyword">friend</span> <span class="keyword">class </span>MarkObjectVisitor;
<a name="l00749"></a>00749   <span class="keyword">static</span> <span class="keywordtype">void</span> VisitObject(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* obj);
<a name="l00750"></a>00750 
<a name="l00751"></a>00751   <span class="keyword">friend</span> <span class="keyword">class </span>UnmarkObjectVisitor;
<a name="l00752"></a>00752   <span class="keyword">static</span> <span class="keywordtype">void</span> UnmarkObject(<a class="code" href="classv8_1_1internal_1_1_heap_object.html">HeapObject</a>* obj);
<a name="l00753"></a>00753 <span class="preprocessor">#endif</span>
<a name="l00754"></a>00754 <span class="preprocessor"></span>
<a name="l00755"></a>00755   <a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>* heap_;
<a name="l00756"></a>00756   <a class="code" href="classv8_1_1internal_1_1_marking_deque.html">MarkingDeque</a> marking_deque_;
<a name="l00757"></a>00757   <a class="code" href="classv8_1_1internal_1_1_code_flusher.html">CodeFlusher</a>* code_flusher_;
<a name="l00758"></a>00758   <a class="code" href="classv8_1_1internal_1_1_object.html">Object</a>* encountered_weak_maps_;
<a name="l00759"></a>00759 
<a name="l00760"></a>00760   <a class="code" href="classv8_1_1internal_1_1_list.html">List&lt;Page*&gt;</a> evacuation_candidates_;
<a name="l00761"></a>00761   <a class="code" href="classv8_1_1internal_1_1_list.html">List&lt;Code*&gt;</a> invalidated_code_;
<a name="l00762"></a>00762 
<a name="l00763"></a><a class="code" href="classv8_1_1internal_1_1_mark_compact_collector.html#a3d69975be2e998e7bf2dcd1b1c8b4577">00763</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classv8_1_1internal_1_1_heap.html">Heap</a>;
<a name="l00764"></a>00764 };
<a name="l00765"></a>00765 
<a name="l00766"></a>00766 
<a name="l00767"></a>00767 <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="namespacev8_1_1internal.html#ae913d5c0f3c0045fe9b97c3a887b1e84">AllocationSpaceName</a>(<a class="code" href="namespacev8_1_1internal.html#aa131d4fd9972fd8dfbec01a9243d9fef">AllocationSpace</a> space);
<a name="l00768"></a>00768 
<a name="l00769"></a>00769 } }  <span class="comment">// namespace v8::internal</span>
<a name="l00770"></a>00770 
<a name="l00771"></a>00771 <span class="preprocessor">#endif  // V8_MARK_COMPACT_H_</span>
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="mark-compact_8h.html">mark-compact.h</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 13:06:11 for V8 API Reference Guide by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.0 </li>
   </ul>
 </div>


</body>
</html>
